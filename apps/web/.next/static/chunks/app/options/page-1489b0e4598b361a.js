(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[739],{65:(e,t,i)=>{Promise.resolve().then(i.bind(i,91)),Promise.resolve().then(i.bind(i,4508))},91:(e,t,i)=>{"use strict";i.d(t,{OptionsBootstrap:()=>w});var a=i(5155),r=i(2115),n=i(2307),s=i(598),l=i(6594),o=i(8070),c=i(9719),d=i(8839),m=i(2933),u=i(8604),h=i(3376);function x(e){let t=Number(e);return isNaN(t)||0===t?"0":t>=1e6?"".concat((t/1e6).toFixed(2),"M"):t>=1e3?"".concat((t/1e3).toFixed(2),"K"):t>=1?t.toFixed(4):t>=1e-4?t.toFixed(6):t.toExponential(2)}function g(e){return e?new Date(1e3*e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"—"}function p(e){let t=Math.floor(Date.now()/1e3);if(e<t)return"Expired";let i=e-t;return i<3600?"".concat(Math.ceil(i/60),"m"):i<86400?"".concat(Math.floor(i/3600),"h ").concat(Math.floor(i%3600/60),"m"):"".concat(Math.floor(i/86400),"d ").concat(Math.floor(i%86400/3600),"h")}function b(e){let t=Math.floor(Date.now()/1e3);return e<t?"lm-badge-red":e-t<86400?"lm-badge-orange":"lm-badge-green"}let v={};async function y(e){let t=e.toLowerCase();if(v[t])return v[t];let i=e.slice(0,6),a=18;try{i=await d.R.readContract({address:e,abi:h.Qi,functionName:"symbol"})}catch(e){}try{a=Number(await d.R.readContract({address:e,abi:h.Qi,functionName:"decimals"}))}catch(e){}return v[t]={sym:i,dec:a},v[t]}function f(){let{address:e,walletClient:t,requireCorrectChain:i}=(0,c.v)(),l=m.$.coveredCallVault,[o,u]=(0,r.useState)([]),[v,f]=(0,r.useState)([]),[N,w]=(0,r.useState)(""),[j,S]=(0,r.useState)(!1),[k,C]=(0,r.useState)({}),[_,E]=(0,r.useState)({}),[R,z]=(0,r.useState)("market");async function A(){if(!l)return void u([]);S(!0),w("");try{let e=await d.R.getBlockNumber(),t=await d.R.getLogs({address:l,event:(0,n.$)("event OfferCreated(uint256 indexed offerId,address indexed writer)"),fromBlock:e>50000n?e-50000n:0n,toBlock:e}),i=[...new Set(t.map(e=>e.args.offerId))].reverse().slice(0,50),a=[];for(let e of i)try{let t=await d.R.readContract({address:l,abi:h.I5,functionName:"offers",args:[e]});if(!t.active)continue;let i=await y(t.underlying),r=await y(t.quote);a.push({id:e,writer:t.writer,underlying:t.underlying,quote:t.quote,underlyingAmount:t.underlyingAmount,strikeQuoteAmount:t.strikeQuoteAmount,premiumQuoteAmount:t.premiumQuoteAmount,expiry:Number(t.expiry),active:!0,strikeTick:Number(t.strikeTick),uSym:i.sym,qSym:r.sym,uDec:i.dec,qDec:r.dec})}catch(e){}u(a),0===a.length&&w("No active offers available.")}catch(e){w(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e))}finally{S(!1)}}async function B(){if(!e||!l)return void f([]);try{let t=await d.R.readContract({address:l,abi:h.I5,functionName:"optionNft"}),i=Number(await d.R.readContract({address:t,abi:h.hL,functionName:"balanceOf",args:[e]})),a=[];for(let r=0;r<Math.min(i,30);r++){let i=await d.R.readContract({address:t,abi:h.hL,functionName:"tokenOfOwnerByIndex",args:[e,BigInt(r)]}),n=await d.R.readContract({address:t,abi:h.qm,functionName:"positions",args:[i]}),s=await y(n.underlying),l=await y(n.quote);a.push({tokenId:i,underlying:n.underlying,quote:n.quote,writer:n.writer,strikeTick:Number(n.strikeTick),underlyingAmount:n.underlyingAmount,strikeQuoteAmount:n.strikeQuoteAmount,premiumQuoteAmount:n.premiumQuoteAmount,expiry:Number(n.expiry),exercised:!!n.exercised,uSym:s.sym,qSym:l.sym,uDec:s.dec,qDec:l.dec})}f(a)}catch(e){}}async function P(a){let r=a.id.toString();if(!e||!t){C(e=>({...e,[r]:"Connect wallet first."})),E(e=>({...e,[r]:"error"}));return}C(e=>({...e,[r]:"Approving premium..."})),E(e=>({...e,[r]:"info"}));try{if(await i(),await d.R.readContract({address:a.quote,abi:[{type:"function",name:"allowance",stateMutability:"view",inputs:[{name:"",type:"address"},{name:"",type:"address"}],outputs:[{type:"uint256"}]}],functionName:"allowance",args:[e,l]})<a.premiumQuoteAmount){let i=await t.writeContract({address:a.quote,abi:[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],outputs:[{type:"bool"}]}],functionName:"approve",args:[l,a.premiumQuoteAmount],chain:d.A,account:e});await d.R.waitForTransactionReceipt({hash:i})}C(e=>({...e,[r]:"Purchasing option..."}));let n=await t.writeContract({address:l,abi:h.I5,functionName:"buyOption",args:[a.id],chain:d.A,account:e});C(e=>({...e,[r]:"Confirming..."})),await d.R.waitForTransactionReceipt({hash:n}),C(e=>({...e,[r]:"Option purchased! NFT minted."})),E(e=>({...e,[r]:"success"})),await A(),await B()}catch(e){C(t=>({...t,[r]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),E(e=>({...e,[r]:"error"}))}}async function O(a){let r="ex-".concat(a.tokenId);if(!e||!t){C(e=>({...e,[r]:"Connect wallet first."})),E(e=>({...e,[r]:"error"}));return}C(e=>({...e,[r]:"Approving strike..."})),E(e=>({...e,[r]:"info"}));try{if(await i(),await d.R.readContract({address:a.quote,abi:[{type:"function",name:"allowance",stateMutability:"view",inputs:[{name:"",type:"address"},{name:"",type:"address"}],outputs:[{type:"uint256"}]}],functionName:"allowance",args:[e,l]})<a.strikeQuoteAmount){let i=await t.writeContract({address:a.quote,abi:[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],outputs:[{type:"bool"}]}],functionName:"approve",args:[l,a.strikeQuoteAmount],chain:d.A,account:e});await d.R.waitForTransactionReceipt({hash:i})}C(e=>({...e,[r]:"Exercising..."}));let n=await t.writeContract({address:l,abi:h.I5,functionName:"exercise",args:[a.tokenId],chain:d.A,account:e});await d.R.waitForTransactionReceipt({hash:n}),C(e=>({...e,[r]:"Exercised!"})),E(e=>({...e,[r]:"success"})),await B()}catch(e){C(t=>({...t,[r]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),E(e=>({...e,[r]:"error"}))}}(0,r.useEffect)(()=>{A().catch(()=>{})},[]),(0,r.useEffect)(()=>{e&&B().catch(()=>{})},[e]);let I=o.reduce((e,t)=>e+Number((0,s.J)(t.premiumQuoteAmount,t.qDec)),0),T=o.reduce((e,t)=>e+Number((0,s.J)(t.underlyingAmount,t.uDec)),0);return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[(0,a.jsxs)("div",{className:"lm-stat",children:[(0,a.jsx)("div",{className:"lm-stat-value",children:o.length}),(0,a.jsx)("div",{className:"lm-stat-label",children:"Active Offers"})]}),(0,a.jsxs)("div",{className:"lm-stat",children:[(0,a.jsx)("div",{className:"lm-stat-value text-lm-orange",children:x(String(I))}),(0,a.jsx)("div",{className:"lm-stat-label",children:"Total Premium"})]}),(0,a.jsxs)("div",{className:"lm-stat",children:[(0,a.jsx)("div",{className:"lm-stat-value",children:x(String(T))}),(0,a.jsx)("div",{className:"lm-stat-label",children:"Total Collateral"})]}),(0,a.jsxs)("div",{className:"lm-stat",children:[(0,a.jsx)("div",{className:"lm-stat-value",children:v.length}),(0,a.jsx)("div",{className:"lm-stat-label",children:"Your Options"})]})]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>z("market"),className:"flex-1 text-xs py-2 border transition-colors font-bold ".concat("market"===R?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,a.jsx)("div",{children:"Available Options"}),(0,a.jsx)("div",{className:"text-[9px] opacity-60 font-normal",children:"Browse & buy from market"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>z("positions"),className:"flex-1 text-xs py-2 border transition-colors font-bold ".concat("positions"===R?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,a.jsxs)("div",{children:["My Positions ",v.length>0&&"(".concat(v.length,")")]}),(0,a.jsx)("div",{className:"text-[9px] opacity-60 font-normal",children:"Exercise & manage"})]})]}),"market"===R&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:j?"Scanning chain...":"".concat(o.length," Active Option").concat(1!==o.length?"s":"")}),(0,a.jsx)("button",{type:"button",onClick:()=>A(),disabled:j,className:"text-[10px] px-2 py-1 border border-lm-orange text-lm-orange hover:bg-lm-orange/5 transition-colors font-bold",children:j?"...":"Refresh"})]}),0!==o.length||j?(0,a.jsx)("div",{className:"space-y-2",children:o.map(t=>{var i,r;let n=t.id.toString(),l=k[n],o=_[n]||"info",c=(null==e?void 0:e.toLowerCase())===t.writer.toLowerCase(),d=p(t.expiry);return(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 lm-card-hover transition-all",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-white font-bold text-sm",children:[t.uSym,"/",t.qSym]}),(0,a.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono",children:["#",n]})]}),(0,a.jsx)("div",{className:"flex items-center gap-1",children:(0,a.jsx)("span",{className:"lm-badge ".concat(b(t.expiry)),children:d})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-[10px] mb-3",children:[(0,a.jsxs)("div",{className:"bg-lm-black p-2 border border-lm-terminal-gray",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Collateral"}),(0,a.jsx)("div",{className:"text-white lm-mono text-xs font-bold mt-0.5",children:x((0,s.J)(t.underlyingAmount,t.uDec))}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:t.uSym})]}),(0,a.jsxs)("div",{className:"bg-lm-black p-2 border border-lm-terminal-gray",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Strike"}),(0,a.jsx)("div",{className:"text-white lm-mono text-xs font-bold mt-0.5",children:x((0,s.J)(t.strikeQuoteAmount,t.qDec))}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:t.qSym})]}),(0,a.jsxs)("div",{className:"bg-lm-black p-2 border border-lm-orange/20",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Premium"}),(0,a.jsx)("div",{className:"text-lm-orange lm-mono text-xs font-bold mt-0.5",children:x((0,s.J)(t.premiumQuoteAmount,t.qDec))}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:t.qSym})]}),(0,a.jsxs)("div",{className:"bg-lm-black p-2 border border-lm-terminal-gray",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Expires"}),(0,a.jsx)("div",{className:"text-white text-xs font-bold mt-0.5",children:g(t.expiry)}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:d})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[(0,a.jsxs)("div",{className:"text-[10px] text-lm-terminal-lightgray",children:["Writer: ",(0,a.jsx)("a",{href:(i=t.writer,"".concat(m.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/address/").concat(i)),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono",children:(r=t.writer).slice(0,6)+"..."+r.slice(-4)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[l&&(0,a.jsx)("span",{className:"text-[10px] ".concat("success"===o?"text-lm-green":"error"===o?"text-lm-red":"text-lm-gray"),children:l}),e&&!c?(0,a.jsx)("button",{type:"button",onClick:()=>P(t),disabled:"info"===_[t.id.toString()],className:"text-xs px-4 py-1.5 bg-lm-orange text-black font-bold hover:bg-lm-orange/80 transition-colors disabled:opacity-40 disabled:pointer-events-none",children:"info"===_[t.id.toString()]?"Processing...":"Buy for ".concat(x((0,s.J)(t.premiumQuoteAmount,t.qDec))," ").concat(t.qSym)}):c?(0,a.jsx)("span",{className:"text-[10px] text-lm-terminal-lightgray",children:"Your offer — manage in Earn tab"}):(0,a.jsx)("span",{className:"text-[10px] text-lm-terminal-lightgray",children:"Connect wallet to buy"})]})]})]},n)})}):(0,a.jsxs)("div",{className:"text-center py-10 space-y-2",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:"No Options Available"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:N||"Writers can create offers in the Earn tab."})]})]}),"positions"===R&&(0,a.jsx)("div",{className:"space-y-2",children:e?0===v.length?(0,a.jsxs)("div",{className:"text-center py-10 space-y-2",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:"No Options Owned"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:"Buy an option from the market to start trading."})]}):v.map(e=>{let t="ex-".concat(e.tokenId),i=e.expiry<Math.floor(Date.now()/1e3),r=!e.exercised&&!i,n=k[t],l=_[t]||"info";return(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border p-3 transition-colors ".concat(e.exercised?"border-lm-green/20":i?"border-lm-red/20 opacity-60":"border-lm-orange/20"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono",children:["NFT #",e.tokenId.toString()]}),(0,a.jsxs)("span",{className:"text-white font-bold text-sm",children:[e.uSym,"/",e.qSym]})]}),(0,a.jsx)("span",{className:"lm-badge ".concat(e.exercised?"lm-badge-green":i?"lm-badge-red":b(e.expiry)),children:e.exercised?"EXERCISED":i?"EXPIRED":p(e.expiry)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-[10px] mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Collateral"}),(0,a.jsxs)("div",{className:"text-white lm-mono text-xs font-bold",children:[x((0,s.J)(e.underlyingAmount,e.uDec))," ",e.uSym]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Exercise Cost"}),(0,a.jsxs)("div",{className:"text-white lm-mono text-xs font-bold",children:[x((0,s.J)(e.strikeQuoteAmount,e.qDec))," ",e.qSym]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Premium Paid"}),(0,a.jsxs)("div",{className:"text-lm-terminal-lightgray lm-mono text-xs",children:[x((0,s.J)(e.premiumQuoteAmount,e.qDec))," ",e.qSym]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Expires"}),(0,a.jsx)("div",{className:"text-white text-xs",children:g(e.expiry)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[r&&(0,a.jsx)("button",{type:"button",onClick:()=>O(e),disabled:"info"===_["ex-".concat(e.tokenId)],className:"text-xs px-4 py-1.5 bg-lm-green/90 text-black font-bold hover:bg-lm-green transition-colors disabled:opacity-40 disabled:pointer-events-none",children:"info"===_["ex-".concat(e.tokenId)]?"Processing...":"Exercise — Pay ".concat(x((0,s.J)(e.strikeQuoteAmount,e.qDec))," ").concat(e.qSym,", Receive ").concat(x((0,s.J)(e.underlyingAmount,e.uDec))," ").concat(e.uSym)}),n&&(0,a.jsx)("span",{className:"text-[10px] ".concat("success"===l?"text-lm-green":"error"===l?"text-lm-red":"text-lm-gray"),children:n})]})]},e.tokenId.toString())}):(0,a.jsxs)("div",{className:"text-center py-10 space-y-2",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:"No Wallet Connected"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:"Connect your wallet to view purchased options."})]})})]})}function N(){let{address:e,walletClient:t,requireCorrectChain:i}=(0,c.v)(),l=m.$.coveredCallVault,[o,u]=(0,r.useState)([]),[v,f]=(0,r.useState)(""),[N,w]=(0,r.useState)(!1),[j,S]=(0,r.useState)({}),[k,C]=(0,r.useState)({});async function _(){if(!e||!l)return void u([]);w(!0),f("");try{let t=await d.R.getBlockNumber(),i=await d.R.getLogs({address:l,event:(0,n.$)("event OfferCreated(uint256 indexed offerId,address indexed writer)"),args:{writer:e},fromBlock:t>50000n?t-50000n:0n,toBlock:t}),a=[...new Set(i.map(e=>e.args.offerId))].reverse().slice(0,30),r=[];for(let e of a)try{let t=await d.R.readContract({address:l,abi:h.I5,functionName:"offers",args:[e]}),i=await y(t.underlying),a=await y(t.quote);r.push({id:e,writer:t.writer,underlying:t.underlying,quote:t.quote,underlyingAmount:t.underlyingAmount,strikeQuoteAmount:t.strikeQuoteAmount,premiumQuoteAmount:t.premiumQuoteAmount,expiry:Number(t.expiry),active:!!t.active,strikeTick:Number(t.strikeTick),uSym:i.sym,qSym:a.sym,uDec:i.dec,qDec:a.dec})}catch(e){}u(r),0===r.length&&f("No offers found. Write your first covered call below.")}catch(e){f(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e))}finally{w(!1)}}async function E(a){let r=a.toString();if(!e||!t){S(e=>({...e,[r]:"Connect wallet first."})),C(e=>({...e,[r]:"error"}));return}S(e=>({...e,[r]:"Cancelling..."})),C(e=>({...e,[r]:"info"}));try{await i();let n=await t.writeContract({address:l,abi:h.I5,functionName:"cancelOffer",args:[a],chain:d.A,account:e});await d.R.waitForTransactionReceipt({hash:n}),S(e=>({...e,[r]:"Cancelled! Collateral returned."})),C(e=>({...e,[r]:"success"})),await _()}catch(e){S(t=>({...t,[r]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),C(e=>({...e,[r]:"error"}))}}(0,r.useEffect)(()=>{e&&_().catch(()=>{})},[e]);let R=o.filter(e=>e.active),z=o.filter(e=>!e.active),A=R.reduce((e,t)=>e+Number((0,s.J)(t.premiumQuoteAmount,t.qDec)),0),B=R.reduce((e,t)=>e+Number((0,s.J)(t.underlyingAmount,t.uDec)),0);return e?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-green/20 p-3 space-y-2",children:[(0,a.jsx)("div",{className:"text-lm-green font-bold text-xs lm-upper",children:"How You Earn"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-[10px] text-lm-terminal-lightgray",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border border-lm-green flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-lm-green font-bold text-[9px]",children:"1"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-white font-bold",children:"Deposit collateral"})," — lock tokens as backing for the option"]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border border-lm-green flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-lm-green font-bold text-[9px]",children:"2"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-white font-bold",children:"Earn premium"})," — a buyer pays you upfront to purchase the option"]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border border-lm-green flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-lm-green font-bold text-[9px]",children:"3"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-white font-bold",children:"Reclaim or settle"})," — if the option expires unused, reclaim your collateral"]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[(0,a.jsxs)("div",{className:"lm-stat",children:[(0,a.jsx)("div",{className:"lm-stat-value text-lm-green",children:R.length}),(0,a.jsx)("div",{className:"lm-stat-label",children:"Active Offers"})]}),(0,a.jsxs)("div",{className:"lm-stat",children:[(0,a.jsx)("div",{className:"lm-stat-value",children:z.length}),(0,a.jsx)("div",{className:"lm-stat-label",children:"Filled / Cancelled"})]}),(0,a.jsxs)("div",{className:"lm-stat",children:[(0,a.jsx)("div",{className:"lm-stat-value text-lm-orange",children:x(String(A))}),(0,a.jsx)("div",{className:"lm-stat-label",children:"Premium Earnable"})]}),(0,a.jsxs)("div",{className:"lm-stat",children:[(0,a.jsx)("div",{className:"lm-stat-value",children:x(String(B))}),(0,a.jsx)("div",{className:"lm-stat-label",children:"Collateral Locked"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Your Offers"}),(0,a.jsx)("button",{type:"button",onClick:()=>_(),disabled:N,className:"text-[10px] px-2 py-1 border border-lm-orange text-lm-orange hover:bg-lm-orange/5 transition-colors font-bold",children:N?"...":"Refresh"})]}),0===o.length?(0,a.jsx)("div",{className:"text-center py-6 text-lm-terminal-lightgray text-xs opacity-60",children:v||"No offers yet. Create one using the Write/Trade tab."}):(0,a.jsx)("div",{className:"space-y-2",children:o.map(e=>{let t=e.id.toString(),i=e.expiry<Math.floor(Date.now()/1e3),r=j[t],n=k[t]||"info";return(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border p-3 transition-colors ".concat(e.active?"border-lm-green/20":"border-lm-terminal-gray opacity-60"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono",children:["#",t]}),(0,a.jsxs)("span",{className:"text-white font-bold text-sm",children:[e.uSym,"/",e.qSym]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"lm-badge ".concat(e.active?"lm-badge-green":"lm-badge-gray"),children:e.active?"ACTIVE":"CLOSED"}),e.active&&(0,a.jsx)("span",{className:"lm-badge ".concat(b(e.expiry)),children:p(e.expiry)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-[10px] mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Collateral Locked"}),(0,a.jsxs)("div",{className:"text-white lm-mono font-bold",children:[x((0,s.J)(e.underlyingAmount,e.uDec))," ",e.uSym]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike Price"}),(0,a.jsxs)("div",{className:"text-white lm-mono font-bold",children:[x((0,s.J)(e.strikeQuoteAmount,e.qDec))," ",e.qSym]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Your Premium"}),(0,a.jsxs)("div",{className:"text-lm-green lm-mono font-bold",children:[x((0,s.J)(e.premiumQuoteAmount,e.qDec))," ",e.qSym]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Expires"}),(0,a.jsx)("div",{className:"text-white",children:g(e.expiry)})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[e.active&&!i&&(0,a.jsx)("button",{type:"button",onClick:()=>E(e.id),disabled:"info"===k[e.id.toString()],className:"text-[10px] px-3 py-1 bg-lm-red/10 text-lm-red border border-lm-red/30 hover:bg-lm-red/20 transition-colors disabled:opacity-40 disabled:pointer-events-none",children:"info"===k[e.id.toString()]?"Cancelling...":"Cancel & Return Collateral"}),!e.active&&i&&(0,a.jsx)("span",{className:"text-[10px] text-lm-terminal-lightgray",children:"Filled & expired — use Write/Chart tab to reclaim with the option NFT ID"}),r&&(0,a.jsx)("span",{className:"text-[10px] ".concat("success"===n?"text-lm-green":"error"===n?"text-lm-red":"text-lm-gray"),children:r})]})]},t)})})]}):(0,a.jsxs)("div",{className:"text-center py-10 space-y-2",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:"No Wallet Connected"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:"Connect your wallet to write covered calls and earn premiums."})]})}function w(e){let{OptionsPanel:t}=e,i=(0,r.useMemo)(()=>[{id:"trade",label:"Trade",hint:"Buy options from available liquidity"},{id:"earn",label:"Earn",hint:"Write covered calls, earn premiums"},{id:"write",label:"Write/Chart",hint:"Create offers + price chart"}],[]),[n,s]=(0,r.useState)("trade"),c=(0,r.useCallback)(e=>{["buy_option","preview_offer"].includes(e.type)?s("trade"):["cancel_option"].includes(e.type)?s("earn"):["write_call","exercise","reclaim","preview_position","load_chart"].includes(e.type)?s("write"):"switch_tab"===e.type&&["trade","earn","write"].includes(e.tab)&&s(e.tab)},[]);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(u.jc,{context:"options",onIntent:c,placeholder:"write call TSLA 100 strike 0.5 premium 0.01 7d \xb7 buy option #5 \xb7 exercise #3 \xb7 help"}),(0,a.jsxs)(l.Z,{title:"Options",hint:"Covered calls backed by escrowed collateral. Each position is a tradeable ERC-721 NFT.",right:(0,a.jsx)(o.Z,{tabs:i,active:n,onChange:s}),children:["trade"===n?(0,a.jsx)(f,{}):null,"earn"===n?(0,a.jsx)(N,{}):null,"write"===n?(0,a.jsx)(t,{}):null]})]})}},4508:(e,t,i)=>{"use strict";i.d(t,{OptionsPanel:()=>_});var a=i(5155),r=i(2115),n=i(2307),s=i(5028),l=i(8245),o=i(598),c=i(6630),d=i(8590),m=i(9719),u=i(8839),h=i(2933),x=i(3376),g=i(9998);let p="rgba(207,255,4,0.3)",b="rgba(207,255,4,0.85)",v="rgba(255,255,255,0.04)";function y(e){let{title:t,subtitle:i,data:n}=e,s=(0,r.useRef)(null),l=(0,r.useRef)(null),o=(0,r.useRef)(null),c=(0,r.useMemo)(()=>n.length?n[n.length-1]:void 0,[n]),d=(0,r.useMemo)(()=>{if(n.length<2)return null;let e=n[0].value,t=n[n.length-1].value;if(!e||0===e)return null;let i=(t-e)/e*100;return{pct:i,up:i>=0}},[n]);return(0,r.useEffect)(()=>{if(!s.current)return;let e=(0,g.R9)(s.current,{autoSize:!0,layout:{background:{color:"rgba(0,0,0,0)"},textColor:"#9e9e9e",fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",fontSize:10},grid:{vertLines:{color:v},horzLines:{color:v}},rightPriceScale:{borderColor:p,scaleMargins:{top:.08,bottom:.08}},timeScale:{borderColor:p,timeVisible:!0,secondsVisible:!1},crosshair:{mode:g._q.Normal,vertLine:{color:p,labelBackgroundColor:b},horzLine:{color:p,labelBackgroundColor:b}}}),t=e.addSeries(g.Im,{color:"#cfff04",lineWidth:2,priceLineVisible:!0,priceLineColor:p,lastValueVisible:!0});l.current=e,o.current=t;let i=new ResizeObserver(()=>e.timeScale().fitContent());return i.observe(s.current),()=>{i.disconnect(),e.remove(),l.current=null,o.current=null}},[]),(0,r.useEffect)(()=>{var e;o.current&&(o.current.setData(n),null==(e=l.current)||e.timeScale().fitContent())},[n]),(0,a.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-3 py-2 border-b border-lm-terminal-gray flex items-center justify-between gap-3 flex-wrap",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("div",{className:"text-white font-bold text-sm",children:t}),i&&(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-mono break-all",children:i})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs",children:[null!==d&&(0,a.jsxs)("span",{className:"font-bold ".concat(d.up?"text-lm-green":"text-lm-red"),children:[d.up?"▲":"▼"," ",d.up?"+":"",d.pct.toFixed(2),"%"]}),c&&(0,a.jsxs)("span",{className:"text-lm-terminal-lightgray",children:["Last: ",(0,a.jsx)("span",{className:"text-lm-orange lm-mono font-bold",children:Number(c.value).toPrecision(6)})]})]})]}),(0,a.jsx)("div",{ref:s,className:"h-[320px] w-full"}),0===n.length&&(0,a.jsxs)("div",{className:"text-center text-lm-terminal-lightgray text-xs py-8 -mt-[320px] relative z-10 space-y-1",children:[(0,a.jsx)("div",{className:"text-lg opacity-30",children:"\uD83D\uDCCA"}),(0,a.jsx)("div",{children:"No chart data yet"}),(0,a.jsx)("div",{className:"text-[10px] opacity-50",children:"Select a pool and click Load to view price history"})]})]})}var f=i(8604);function N(e){if(!/^0x[0-9a-fA-F]{40}$/.test(e))throw Error("Invalid address");return e}function w(e){return e.slice(0,6)+"..."+e.slice(-4)}function j(e){return"".concat(h.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/address/").concat(e)}let S=[{label:"5K",blocks:5000n},{label:"20K",blocks:20000n},{label:"80K",blocks:80000n}];function k(e){return e?new Date(1e3*e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function C(e){return String(Math.floor(Date.now()/1e3)+86400*e)}function _(){var e,t;let{address:i,walletClient:g,requireCorrectChain:p,connect:b}=(0,m.v)(),[v,_]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{if(h.$.tokenRegistry)try{let e=Number(await u.R.readContract({address:h.$.tokenRegistry,abi:x.wn,functionName:"tokenCount"})),t=[];for(let i=0;i<Math.min(e,30);i++){let e=await u.R.readContract({address:h.$.tokenRegistry,abi:x.wn,functionName:"tokenAt",args:[BigInt(i)]}),a="???",r=18;try{a=await u.R.readContract({address:e,abi:x.Qi,functionName:"symbol"})}catch(e){}try{r=Number(await u.R.readContract({address:e,abi:x.Qi,functionName:"decimals"}))}catch(e){}t.push({addr:e,symbol:a,decimals:r})}_(t)}catch(e){}})()},[]);let E=h.$.coveredCallVault,[R,z]=(0,r.useState)(""),[A,B]=(0,r.useState)(null),P=h.$.weth,[O,I]=(0,r.useState)(null),[T,L]=(0,r.useState)(""),[M,D]=(0,r.useState)("3600"),[q,Q]=(0,r.useState)(""),[F,W]=(0,r.useState)(""),[V,J]=(0,r.useState)(""),[$,U]=(0,r.useState)(""),[H,X]=(0,r.useState)("7"),[Y,K]=(0,r.useState)(""),[Z,G]=(0,r.useState)(""),[ee,et]=(0,r.useState)(null),[ei,ea]=(0,r.useState)(null),[er,en]=(0,r.useState)(""),[es,el]=(0,r.useState)("info"),[eo,ec]=(0,r.useState)(!1),[ed,em]=(0,r.useState)(""),[eu,eh]=(0,r.useState)(!1),[ex,eg]=(0,r.useState)(""),[ep,eb]=(0,r.useState)([]),[ev,ey]=(0,r.useState)(20000n),ef=(0,r.useRef)(()=>{}),eN=(0,r.useRef)(()=>{}),ew=(0,r.useRef)(v);ew.current=v,(0,f.SL)((0,r.useCallback)(e=>{if("write_call"===e.type){let t=ew.current;if(e.underlying){let i=e.underlying.toUpperCase(),a=t.find(e=>e.symbol.toUpperCase()===i);a&&z(a.addr)}e.amount&&W(e.amount),e.strike&&J(e.strike),e.premium&&U(e.premium),e.expiry&&X(e.expiry),e.twap&&D(e.twap)}else"buy_option"===e.type&&e.offerId?K(e.offerId):"preview_offer"===e.type&&e.offerId?(K(e.offerId),setTimeout(()=>ef.current(),0)):"exercise"===e.type&&e.tokenId||"reclaim"===e.type&&e.tokenId?G(e.tokenId):"preview_position"===e.type&&e.tokenId?(G(e.tokenId),setTimeout(()=>eN.current(),0)):"cancel_option"===e.type&&e.offerId?K(e.offerId):"load_chart"===e.type&&e.blocks&&ey(BigInt(e.blocks))},[]));let ej=(0,r.useRef)({}),eS=(0,r.useCallback)(async e=>{let t=e.toLowerCase();if("number"==typeof ej.current[t])return ej.current[t];let i=Number(await u.R.readContract({address:e,abi:x.Qi,functionName:"decimals"}));return ej.current[t]=i,i},[]);(0,r.useEffect)(()=>{if(!R||!/^0x[0-9a-fA-F]{40}$/.test(R))return void B(null);(async()=>{try{let e="???",t=18;try{e=await u.R.readContract({address:R,abi:x.Qi,functionName:"symbol"})}catch(e){}try{t=Number(await u.R.readContract({address:R,abi:x.Qi,functionName:"decimals"}))}catch(e){}B({addr:R,symbol:e,decimals:t})}catch(e){B(null)}})()},[R]),(0,r.useEffect)(()=>{if(!P)return void I(null);(async()=>{try{let e="WETH",t=18;try{e=await u.R.readContract({address:P,abi:x.Qi,functionName:"symbol"})}catch(e){}try{t=Number(await u.R.readContract({address:P,abi:x.Qi,functionName:"decimals"}))}catch(e){}I({addr:P,symbol:e,decimals:t})}catch(e){I(null)}})()},[P]);let ek=(0,r.useCallback)(e=>{let t=Math.exp(e*Math.log(1.0001));return Number.isFinite(t)&&t>0?t:null},[]),eC=(0,r.useCallback)(async(e,t,i,a)=>{let r=[{type:"function",name:"token0",stateMutability:"view",inputs:[],outputs:[{type:"address"}]},{type:"function",name:"token1",stateMutability:"view",inputs:[],outputs:[{type:"address"}]}],[n,s]=await Promise.all([u.R.readContract({address:e,abi:r,functionName:"token0"}),u.R.readContract({address:e,abi:r,functionName:"token1"})]),l=ek(a);if(null===l)return null;let o=l*Math.pow(10,await eS(n)-await eS(s)),c=t.toLowerCase(),d=i.toLowerCase();return c===s.toLowerCase()&&d===n.toLowerCase()?o:c===n.toLowerCase()&&d===s.toLowerCase()?0===o?null:1/o:null},[eS,ek]),e_=(0,r.useCallback)(async()=>{eh(!0),eg("Loading swap data...");try{let e=N(T),t=N(R),i=await u.R.getBlockNumber(),a=(0,n.$)("event Swap(address indexed sender,address indexed recipient,int256 amount0,int256 amount1,uint160 sqrtPriceX96,uint128 liquidity,int24 tick)"),r=await u.R.getLogs({address:e,event:a,fromBlock:i>ev?i-ev:0n,toBlock:i});if(!r.length){eb([]),eg("No swaps found.");return}let s=Array.from(new Set(r.map(e=>e.blockNumber))),l=await Promise.all(s.map(e=>u.R.getBlock({blockNumber:e}))),o=new Map;for(let e of l)o.set(e.number,Number(e.timestamp));let c=Math.max(1,Math.floor(r.length/600)),d=[];for(let i=0;i<r.length;i+=c){let a=r[i],n=o.get(a.blockNumber);if(!n)continue;let s=Number(a.args.tick),l=await eC(e,t,P,s);null!==l&&Number.isFinite(l)&&!(l<=0)&&d.push({time:n,value:Number(l.toPrecision(10))})}d.sort((e,t)=>Number(e.time)-Number(t.time)),eb(d),eg(0===d.length?"Could not resolve prices from swaps.":"")}catch(e){eb([]),eg(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e))}finally{eh(!1)}},[ev,T,R,P,eC]),eE=(0,r.useMemo)(()=>{let e=Number(M||"0");return!Number.isFinite(e)||e<=0?"":e<900?"Min TWAP is 900s (15 min).":""},[M]);async function eR(e,t,i,a){if(await u.R.readContract({address:i,abi:x.bx,functionName:"allowance",args:[e,t]})>=a)return;if(!g)throw Error("No wallet client");en("Approving token...");let r=await g.writeContract({address:i,abi:x.bx,functionName:"approve",args:[t,a],chain:u.A,account:e});await u.R.waitForTransactionReceipt({hash:r})}async function ez(){if(!i||!g){en("Connect wallet."),el("error");return}let e=(null==A?void 0:A.symbol)||"tokens";ec(!0),em("");try{var t,a;en("Preparing ".concat(e," covered call offer...")),el("info"),await p();let r=N(R),n=N(T);if(!E)throw Error("Missing vault address in config.");let l=null!=(t=null==A?void 0:A.decimals)?t:await eS(r),o=null!=(a=null==O?void 0:O.decimals)?a:18,c=(0,s.X)(F||"0",l),d=(0,s.X)(V||"0",o),m=(0,s.X)($||"0",o),h=BigInt(C(Number(H||"7")));if(c<=0n)throw Error("Underlying amount must be > 0");if(d<=0n)throw Error("Strike must be > 0");if(m<=0n)throw Error("Premium must be > 0");await eR(i,E,r,c),en("Writing ".concat(F," ").concat(e," call (").concat(H,"d expiry)..."));let b=await g.writeContract({address:E,abi:x.I5,functionName:"createOffer",args:[r,P,n,Number(M||"0"),Number(q||"0"),c,d,m,h],chain:u.A,account:i});em(b),en("Confirming on-chain...");let v=await u.R.waitForTransactionReceipt({hash:b});"success"===v.status?(en("Offer created! ".concat(F," ").concat(e," escrowed. Premium: ").concat($," ETH. Expires in ").concat(H,"d.")),el("success")):(en("Transaction reverted. Check that you have enough tokens and try again."),el("error"))}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?en("Transaction cancelled by user."):en("Create offer failed: ".concat(e)),el("error")}finally{ec(!1)}}async function eA(){ec(!0);try{en("");let e=BigInt(Y||"0"),t=await u.R.readContract({address:E,abi:x.I5,functionName:"offers",args:[e]});et(t),en("")}catch(e){et(null),en(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)),el("error")}finally{ec(!1)}}async function eB(){if(!i||!g){en("Connect wallet."),el("error");return}ec(!0),em("");try{en("Loading offer #".concat(Y,"...")),el("info"),await p();let e=BigInt(Y||"0"),t=await u.R.readContract({address:E,abi:x.I5,functionName:"offers",args:[e]});if(!t.active)throw Error("Offer #"+Y+" is no longer active (may be expired, sold, or cancelled).");let a=(0,l.c)(t.premiumQuoteAmount);en("Buying option #".concat(Y," for ").concat(a," ETH premium...")),await eR(i,E,t.quote,t.premiumQuoteAmount),en("Awaiting signature...");let r=await g.writeContract({address:E,abi:x.I5,functionName:"buyOption",args:[e],chain:u.A,account:i});em(r),en("Confirming on-chain..."),await u.R.waitForTransactionReceipt({hash:r}),en("Option purchased! You paid ".concat(a," ETH premium. Your option NFT has been minted.")),el("success")}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?en("Transaction cancelled by user."):en("Buy failed: ".concat(e)),el("error")}finally{ec(!1)}}async function eP(){if(!i||!g){en("Connect wallet."),el("error");return}ec(!0),em("");try{await p(),en("Cancelling..."),el("info");let e=BigInt(Y||"0"),t=await g.writeContract({address:E,abi:x.I5,functionName:"cancelOffer",args:[e],chain:u.A,account:i});em(t),await u.R.waitForTransactionReceipt({hash:t}),en("Offer cancelled."),el("success"),await eA()}catch(e){en(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)),el("error")}finally{ec(!1)}}async function eO(){ec(!0);try{en("");let e=await u.R.readContract({address:E,abi:x.I5,functionName:"optionNft"}),t=BigInt(Z||"0"),i=await u.R.readContract({address:e,abi:x.qm,functionName:"positions",args:[t]}),a=await u.R.readContract({address:E,abi:x.I5,functionName:"underlyingReclaimed",args:[t]}),r="???",n="???",s=18,l=18;try{r=await u.R.readContract({address:i.underlying,abi:x.Qi,functionName:"symbol"})}catch(e){}try{n=await u.R.readContract({address:i.quote,abi:x.Qi,functionName:"symbol"})}catch(e){}try{s=Number(await u.R.readContract({address:i.underlying,abi:x.Qi,functionName:"decimals"}))}catch(e){}try{l=Number(await u.R.readContract({address:i.quote,abi:x.Qi,functionName:"decimals"}))}catch(e){}ea({...i,optionNft:e,reclaimed:a,uSym:r,qSym:n,uDec:s,qDec:l})}catch(e){ea(null),en(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)),el("error")}finally{ec(!1)}}async function eI(){if(!i||!g){en("Connect wallet."),el("error");return}ec(!0),em("");try{await p(),en("Loading option NFT #".concat(Z,"...")),el("info");let e=await u.R.readContract({address:E,abi:x.I5,functionName:"optionNft"}),t=await u.R.readContract({address:e,abi:x.qm,functionName:"positions",args:[BigInt(Z||"0")]}),a=(0,l.c)(t.strikeQuoteAmount);en("Exercising option #".concat(Z," — paying ").concat(a," ETH strike...")),await eR(i,E,t.quote,t.strikeQuoteAmount),en("Awaiting signature...");let r=await g.writeContract({address:E,abi:x.I5,functionName:"exercise",args:[BigInt(Z||"0")],chain:u.A,account:i});em(r),en("Confirming on-chain..."),await u.R.waitForTransactionReceipt({hash:r}),en("Option #".concat(Z," exercised! You paid ").concat(a," ETH and received the underlying tokens.")),el("success"),await eO()}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?en("Transaction cancelled by user."):e.includes("NOT_ITM")?en("Option is not in-the-money. TWAP price must exceed the strike price to exercise."):e.includes("EXPIRED")?en("Option has expired. Use 'Reclaim' if you are the writer."):en("Exercise failed: ".concat(e)),el("error")}finally{ec(!1)}}async function eT(){if(!i||!g){en("Connect wallet."),el("error");return}ec(!0),em("");try{await p(),en("Reclaiming..."),el("info");let e=await g.writeContract({address:E,abi:x.I5,functionName:"reclaimExpired",args:[BigInt(Z||"0")],chain:u.A,account:i});em(e),await u.R.waitForTransactionReceipt({hash:e}),en("Expired underlying reclaimed!"),el("success"),await eO()}catch(e){en(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)),el("error")}finally{ec(!1)}}ef.current=eA,eN.current=eO;let eL=Number(C(Number(H||"7")));return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-3 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[(0,a.jsx)("div",{className:"text-white font-bold text-sm lm-upper",children:"Price Chart"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[S.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>ey(e.blocks),className:"text-[10px] px-2 py-1 border transition-colors ".concat(ev===e.blocks?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.label)),(0,a.jsx)("button",{type:"button",disabled:eu||!T||!R,onClick:()=>e_(),className:"text-[10px] px-3 py-1 bg-lm-orange text-black font-bold hover:bg-lm-orange/80 disabled:opacity-40 transition-colors",children:eu?"...":"Load"})]})]}),(0,a.jsx)(y,{title:A?"".concat(A.symbol," / ").concat((null==O?void 0:O.symbol)||"WETH"):"Select underlying token",subtitle:T?"Pool: ".concat(w(T)):"Enter pool address to load chart",data:ep}),ex&&(0,a.jsx)("div",{className:"text-lm-red text-xs",children:ex})]}),(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-7 h-7 border border-lm-orange flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lm-orange font-bold text-xs",children:"1"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-bold text-sm lm-upper",children:"Write Covered Call"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Deposit tokens as collateral. Earn premium when someone buys your option."})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Collateral Token"}),v.length>0?(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"flex gap-1 flex-wrap",children:v.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>z(e.addr),className:"text-[10px] px-2 py-1 border transition-colors ".concat(R.toLowerCase()===e.addr.toLowerCase()?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.symbol},e.addr))}),(0,a.jsx)(d.p,{value:R,onValueChange:z,numeric:!1,placeholder:"Or paste token address..."})]}):(0,a.jsx)(d.p,{value:R,onValueChange:z,numeric:!1,placeholder:"0x..."}),A&&(0,a.jsxs)("div",{className:"text-[10px] text-lm-terminal-lightgray",children:["Selected: ",(0,a.jsx)("span",{className:"text-white font-bold",children:A.symbol})]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Settlement Token"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 h-9 px-3 bg-lm-black border border-lm-terminal-gray text-white text-xs font-bold",children:[(null==O?void 0:O.symbol)||"WETH",(0,a.jsx)("span",{className:"text-lm-terminal-lightgray lm-mono text-[10px]",children:P?w(P):""})]}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Strike and premium paid in this token"})]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Price Oracle Pool"}),(0,a.jsx)(d.p,{value:T,onValueChange:L,numeric:!1,placeholder:"Uniswap V3 pool address for this pair"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Used for TWAP price verification when exercising"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Collateral Amount"}),(0,a.jsx)(d.p,{value:F,onValueChange:W,placeholder:"100"}),A&&(0,a.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:[A.symbol," tokens to lock"]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Expiry"}),(0,a.jsx)("div",{className:"flex gap-1",children:[{label:"1d",val:"1"},{label:"7d",val:"7"},{label:"14d",val:"14"},{label:"30d",val:"30"}].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>X(e.val),className:"flex-1 text-[10px] py-1.5 border transition-colors ".concat(H===e.val?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.val))}),(0,a.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:["Expires: ",k(eL)]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:["Strike Price (",(null==O?void 0:O.symbol)||"WETH",")"]}),(0,a.jsx)(d.p,{value:V,onValueChange:J,placeholder:"0.5"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Buyer pays this amount to exercise the option"})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:["Premium (",(null==O?void 0:O.symbol)||"WETH",")"]}),(0,a.jsx)(d.p,{value:$,onValueChange:U,placeholder:"0.01"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"You earn this when someone buys your option"})]})]}),(0,a.jsxs)("details",{className:"text-[10px]",children:[(0,a.jsx)("summary",{className:"text-lm-terminal-lightgray hover:text-lm-orange cursor-pointer transition-colors",children:"Advanced settings (oracle TWAP, strike tick)"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-2 p-2 bg-lm-black border border-lm-terminal-gray",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"TWAP Window"}),(0,a.jsx)("div",{className:"flex gap-1",children:[{label:"15m",val:"900"},{label:"1h",val:"3600"},{label:"4h",val:"14400"},{label:"24h",val:"86400"}].map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>D(e.val),className:"flex-1 text-[9px] py-1 border transition-colors ".concat(M===e.val?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.val))}),(0,a.jsx)(d.p,{value:M,onValueChange:D,placeholder:"3600"}),eE&&(0,a.jsx)("div",{className:"text-lm-red text-[10px]",children:eE}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Price average window for exercise validation"})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Strike Tick (raw)"}),(0,a.jsx)(d.p,{value:q,onValueChange:Q,placeholder:"e.g. -23000"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Uniswap V3 tick for in-the-money check"})]})]})]}),(0,a.jsx)(c.$,{onClick:i?ez:b,loading:eo,disabled:eo||!!i&&(!R||!T||Number(M)>0&&900>Number(M)),variant:"primary",size:"lg",className:"w-full",children:eo?"Writing Call...":i?"Write Covered Call".concat(A?" (".concat(A.symbol,")"):""):"Connect Wallet"})]}),(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-7 h-7 border border-lm-orange flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lm-orange font-bold text-xs",children:"2"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-bold text-sm lm-upper",children:"Buy Option"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Purchase an active offer to receive a tradeable option NFT."})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Offer ID"}),(0,a.jsx)(d.p,{value:Y,onValueChange:K,placeholder:"Enter offer number"})]}),(0,a.jsx)("button",{type:"button",onClick:eA,disabled:eo||!Y,className:"text-xs px-3 py-1.5 border border-lm-terminal-gray text-lm-terminal-lightgray hover:border-lm-orange hover:text-lm-orange disabled:opacity-40 transition-colors",children:"Preview"}),(0,a.jsx)(c.$,{onClick:eB,loading:eo,disabled:eo||!Y,variant:"primary",className:"px-5",children:eo?"Buying...":"Buy Option"})]}),ee&&(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-2 space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-white font-bold",children:["Offer #",null==(e=ee.id)?void 0:e.toString()]}),(0,a.jsx)("span",{className:"px-1.5 py-0.5 border text-[10px] ".concat(ee.active?"border-lm-green text-lm-green":"border-lm-red text-lm-red"),children:ee.active?"ACTIVE":"INACTIVE"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Writer"}),(0,a.jsx)("a",{href:j(String(ee.writer)),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono",children:w(String(ee.writer))}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Underlying"}),(0,a.jsx)("a",{href:j(String(ee.underlying)),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono",children:w(String(ee.underlying))}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Amount"}),(0,a.jsx)("div",{className:"text-white lm-mono",children:null==(t=ee.underlyingAmount)?void 0:t.toString()}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Premium"}),(0,a.jsxs)("div",{className:"text-white lm-mono",children:[(0,l.c)(ee.premiumQuoteAmount||0n)," ETH"]}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike"}),(0,a.jsxs)("div",{className:"text-white lm-mono",children:[(0,l.c)(ee.strikeQuoteAmount||0n)," ETH"]}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike Tick"}),(0,a.jsx)("div",{className:"text-white lm-mono",children:Number(ee.strikeTick)}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Expiry"}),(0,a.jsx)("div",{className:"text-white",children:k(Number(ee.expiry))})]}),ee.active&&(null==i?void 0:i.toLowerCase())===String(ee.writer).toLowerCase()&&(0,a.jsx)("button",{type:"button",onClick:eP,disabled:eo,className:"text-[10px] px-2 py-1 border border-lm-red text-lm-red hover:bg-lm-red/5 transition-colors mt-1",children:"Cancel Offer (Writer Only)"})]})]}),(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-7 h-7 border border-lm-orange flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-lm-orange font-bold text-xs",children:"3"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-bold text-sm lm-upper",children:"Exercise / Reclaim"}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Exercise an in-the-money option, or reclaim expired collateral (writer only)."})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Option NFT ID"}),(0,a.jsx)(d.p,{value:Z,onValueChange:G,placeholder:"Enter NFT token ID"})]}),(0,a.jsx)("button",{type:"button",onClick:eO,disabled:eo||!Z,className:"text-xs px-3 py-1.5 border border-lm-terminal-gray text-lm-terminal-lightgray hover:border-lm-orange hover:text-lm-orange disabled:opacity-40 transition-colors",children:"Preview"})]}),ei&&(0,a.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-2 space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,a.jsxs)("span",{className:"text-white font-bold",children:["Position #",Z]}),(0,a.jsx)("span",{className:"px-1.5 py-0.5 border text-[10px] ".concat(ei.exercised?"border-lm-green text-lm-green":ei.reclaimed?"border-lm-gray text-lm-gray":BigInt(ei.expiry)<BigInt(Math.floor(Date.now()/1e3))?"border-lm-red text-lm-red":"border-lm-orange text-lm-orange"),children:ei.exercised?"EXERCISED":ei.reclaimed?"RECLAIMED":BigInt(ei.expiry)<BigInt(Math.floor(Date.now()/1e3))?"EXPIRED":"ACTIVE"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Writer"}),(0,a.jsx)("a",{href:j(String(ei.writer)),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono",children:w(String(ei.writer))}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Underlying"}),(0,a.jsxs)("div",{className:"text-white",children:[ei.uSym," ",(0,a.jsxs)("span",{className:"lm-mono text-lm-gray",children:["(",w(String(ei.underlying)),")"]})]}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Amount"}),(0,a.jsxs)("div",{className:"text-white lm-mono",children:[(0,o.J)(ei.underlyingAmount||0n,ei.uDec||18)," ",ei.uSym]}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike"}),(0,a.jsxs)("div",{className:"text-white lm-mono",children:[(0,o.J)(ei.strikeQuoteAmount||0n,ei.qDec||18)," ",ei.qSym]}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Premium Paid"}),(0,a.jsxs)("div",{className:"text-white lm-mono",children:[(0,o.J)(ei.premiumQuoteAmount||0n,ei.qDec||18)," ",ei.qSym]}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike Tick"}),(0,a.jsx)("div",{className:"text-white lm-mono",children:Number(ei.strikeTick)}),(0,a.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Expiry"}),(0,a.jsx)("div",{className:"text-white",children:k(Number(ei.expiry))})]}),!ei.exercised&&!ei.reclaimed&&(0,a.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,a.jsx)(c.$,{onClick:eI,loading:eo,disabled:eo,variant:"primary",size:"sm",className:"px-4",children:"Exercise"}),(0,a.jsx)(c.$,{onClick:eT,disabled:eo,size:"sm",className:"px-4",children:"Reclaim Expired"})]})]})]}),er&&(0,a.jsxs)("div",{className:"text-xs p-2.5 border bg-lm-black flex items-center justify-between gap-2 ".concat("success"===es?"text-lm-green":"error"===es?"text-lm-red":"text-lm-gray"," ").concat("success"===es?"border-lm-green/20":"error"===es?"border-lm-red/20":"border-lm-terminal-gray"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:["info"===es&&(0,a.jsx)("span",{className:"lm-spinner flex-shrink-0",style:{width:12,height:12,borderWidth:1.5}}),"success"===es&&(0,a.jsx)("span",{className:"lm-dot lm-dot-green flex-shrink-0"}),"error"===es&&(0,a.jsx)("span",{className:"lm-dot lm-dot-red flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate",children:er})]}),ed&&(0,a.jsx)("a",{href:"".concat(h.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/tx/").concat(ed),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline flex-shrink-0",children:"View Tx →"})]})]})}},6927:(e,t,i)=>{"use strict";function a(e){var t=e.width,i=e.height;if(t<0)throw Error("Negative width is not allowed for Size");if(i<0)throw Error("Negative height is not allowed for Size");return{width:t,height:i}}function r(e,t){return e.width===t.width&&e.height===t.height}i.d(t,{Dv:()=>l,zE:()=>r,Ej:()=>a,vb:()=>d});var n=function(){function e(e){var t=this;this._resolutionListener=function(){return t._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=e,this._installResolutionListener()}return e.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(e.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(e){var t=this,i={next:e};return this._observers.push(i),{unsubscribe:function(){t._observers=t._observers.filter(function(e){return e!==i})}}},e.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw Error("Resolution listener is already installed");var e=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(e,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},e.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},e.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},e.prototype._onResolutionChanged=function(){var e=this;this._observers.forEach(function(t){return t.next(e._window.devicePixelRatio)}),this._reinstallResolutionListener()},e}(),s=function(){function e(e,t,i){var r;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=e,this._canvasElementClientSize=a({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=null!=t?t:function(e){return e},this._allowResizeObserver=null==(r=null==i?void 0:i.allowResizeObserver)||r,this._chooseAndInitObserver()}return e.prototype.dispose=function(){var e,t;if(null===this._canvasElement)throw Error("Object is disposed");null==(e=this._canvasElementResizeObserver)||e.disconnect(),this._canvasElementResizeObserver=null,null==(t=this._devicePixelRatioObservable)||t.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(e.prototype,"canvasElement",{get:function(){if(null===this._canvasElement)throw Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bitmapSize",{get:function(){return a({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),e.prototype.resizeCanvasElement=function(e){this._canvasElementClientSize=a(e),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},e.prototype.subscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners.push(e)},e.prototype.unsubscribeBitmapSizeChanged=function(e){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(t){return t!==e})},Object.defineProperty(e.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),e.prototype.subscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners.push(e)},e.prototype.unsubscribeSuggestedBitmapSizeChanged=function(e){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(t){return t!==e})},e.prototype.applySuggestedBitmapSize=function(){if(null!==this._suggestedBitmapSize){var e=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(e),this._emitSuggestedBitmapSizeChanged(e,this._suggestedBitmapSize)}},e.prototype._resizeBitmap=function(e){var t=this.bitmapSize;r(t,e)||(this.canvasElement.width=e.width,this.canvasElement.height=e.height,this._emitBitmapSizeChanged(t,e))},e.prototype._emitBitmapSizeChanged=function(e,t){var i=this;this._bitmapSizeChangedListeners.forEach(function(a){return a.call(i,e,t)})},e.prototype._suggestNewBitmapSize=function(e){var t=this._suggestedBitmapSize,i=a(this._transformBitmapSize(e,this._canvasElementClientSize)),n=r(this.bitmapSize,i)?null:i;(null!==t||null!==n)&&(null!==t&&null!==n&&r(t,n)||(this._suggestedBitmapSize=n,this._emitSuggestedBitmapSizeChanged(t,n)))},e.prototype._emitSuggestedBitmapSizeChanged=function(e,t){var i=this;this._suggestedBitmapSizeChangedListeners.forEach(function(a){return a.call(i,e,t)})},e.prototype._chooseAndInitObserver=function(){var e=this;if(!this._allowResizeObserver)return void this._initDevicePixelRatioObservable();new Promise(function(e){var t=new ResizeObserver(function(i){e(i.every(function(e){return"devicePixelContentBoxSize"in e})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1}).then(function(t){return t?e._initResizeObserver():e._initDevicePixelRatioObservable()})},e.prototype._initDevicePixelRatioObservable=function(){var e=this;if(null!==this._canvasElement){var t=o(this._canvasElement);if(null===t)throw Error("No window is associated with the canvas");this._devicePixelRatioObservable=new n(t),this._devicePixelRatioObservable.subscribe(function(){return e._invalidateBitmapSize()}),this._invalidateBitmapSize()}},e.prototype._invalidateBitmapSize=function(){if(null!==this._canvasElement){var e,t,i=o(this._canvasElement);if(null!==i){var r,n,s=null!=(t=null==(e=this._devicePixelRatioObservable)?void 0:e.value)?t:i.devicePixelRatio,l=this._canvasElement.getClientRects(),c=void 0!==l[0]?(r=l[0],n=s,a({width:Math.round(r.left*n+r.width*n)-Math.round(r.left*n),height:Math.round(r.top*n+r.height*n)-Math.round(r.top*n)})):a({width:this._canvasElementClientSize.width*s,height:this._canvasElementClientSize.height*s});this._suggestNewBitmapSize(c)}}},e.prototype._initResizeObserver=function(){var e=this;null!==this._canvasElement&&(this._canvasElementResizeObserver=new ResizeObserver(function(t){var i=t.find(function(t){return t.target===e._canvasElement});if(i&&i.devicePixelContentBoxSize&&i.devicePixelContentBoxSize[0]){var r=i.devicePixelContentBoxSize[0],n=a({width:r.inlineSize,height:r.blockSize});e._suggestNewBitmapSize(n)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},e}();function l(e,t){if("device-pixel-content-box"===t.type)return new s(e,t.transform,t.options);throw Error("Unsupported binding target")}function o(e){return e.ownerDocument.defaultView}var c=function(){function e(e,t,i){if(0===t.width||0===t.height)throw TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=t,0===i.width||0===i.height)throw TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=i,this._context=e}return e.prototype.useMediaCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),e({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},e.prototype.useBitmapCoordinateSpace=function(e){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),e({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(e.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),e}();function d(e,t){var i=e.canvasElementClientSize;if(0===i.width||0===i.height)return null;var a=e.bitmapSize;if(0===a.width||0===a.height)return null;var r=e.canvasElement.getContext("2d",t);return null===r?null:new c(r,i,a)}}},e=>{e.O(0,[426,462,476,668,918,441,255,358],()=>e(e.s=65)),_N_E=e.O()}]);