(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[739],{65:(e,t,a)=>{Promise.resolve().then(a.bind(a,91)),Promise.resolve().then(a.bind(a,4508))},91:(e,t,a)=>{"use strict";a.d(t,{OptionsBootstrap:()=>j});var r=a(5155),i=a(2115),l=a(2307),s=a(598),n=a(6594),c=a(8070),o=a(9719),d=a(8839),m=a(2933),x=a(8604),u=a(3376);function h(e){let t=Number(e);return isNaN(t)||0===t?"0":t>=1e6?"".concat((t/1e6).toFixed(2),"M"):t>=1e3?"".concat((t/1e3).toFixed(2),"K"):t>=1?t.toFixed(4):t>=1e-4?t.toFixed(6):t.toExponential(2)}function g(e){return e?new Date(1e3*e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"—"}function p(e){let t=Math.floor(Date.now()/1e3);if(e<t)return"Expired";let a=e-t;return a<3600?"".concat(Math.ceil(a/60),"m"):a<86400?"".concat(Math.floor(a/3600),"h ").concat(Math.floor(a%3600/60),"m"):"".concat(Math.floor(a/86400),"d ").concat(Math.floor(a%86400/3600),"h")}function y(e){let t=Math.floor(Date.now()/1e3);return e<t?"lm-badge-red":e-t<86400?"lm-badge-orange":"lm-badge-green"}let b={};async function f(e){let t=e.toLowerCase();if(b[t])return b[t];let a=e.slice(0,6),r=18;try{a=await d.R.readContract({address:e,abi:u.Qi,functionName:"symbol"})}catch(e){}try{r=Number(await d.R.readContract({address:e,abi:u.Qi,functionName:"decimals"}))}catch(e){}return b[t]={sym:a,dec:r},b[t]}function v(){let{address:e,walletClient:t,requireCorrectChain:a}=(0,o.v)(),n=m.$.coveredCallVault,[c,x]=(0,i.useState)([]),[b,v]=(0,i.useState)([]),[N,j]=(0,i.useState)(""),[w,k]=(0,i.useState)(!1),[C,S]=(0,i.useState)({}),[R,A]=(0,i.useState)({}),[E,I]=(0,i.useState)("market");async function T(){if(!n)return void x([]);k(!0),j("");try{let e=await d.R.getBlockNumber(),t=await d.R.getLogs({address:n,event:(0,l.$)("event OfferCreated(uint256 indexed offerId,address indexed writer)"),fromBlock:e>50000n?e-50000n:0n,toBlock:e}),a=[...new Set(t.map(e=>e.args.offerId))].reverse().slice(0,50),r=[];for(let e of a)try{let t=await d.R.readContract({address:n,abi:u.I5,functionName:"offers",args:[e]});if(!t.active)continue;let a=await f(t.underlying),i=await f(t.quote);r.push({id:e,writer:t.writer,underlying:t.underlying,quote:t.quote,underlyingAmount:t.underlyingAmount,strikeQuoteAmount:t.strikeQuoteAmount,premiumQuoteAmount:t.premiumQuoteAmount,expiry:Number(t.expiry),active:!0,strikeTick:Number(t.strikeTick),uSym:a.sym,qSym:i.sym,uDec:a.dec,qDec:i.dec})}catch(e){}x(r),0===r.length&&j("No active offers available.")}catch(e){j(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e))}finally{k(!1)}}async function q(){if(!e||!n)return void v([]);try{let t=await d.R.readContract({address:n,abi:u.I5,functionName:"optionNft"}),a=Number(await d.R.readContract({address:t,abi:u.hL,functionName:"balanceOf",args:[e]})),r=[];for(let i=0;i<Math.min(a,30);i++){let a=await d.R.readContract({address:t,abi:u.hL,functionName:"tokenOfOwnerByIndex",args:[e,BigInt(i)]}),l=await d.R.readContract({address:t,abi:u.qm,functionName:"positions",args:[a]}),s=await f(l.underlying),n=await f(l.quote);r.push({tokenId:a,underlying:l.underlying,quote:l.quote,writer:l.writer,strikeTick:Number(l.strikeTick),underlyingAmount:l.underlyingAmount,strikeQuoteAmount:l.strikeQuoteAmount,premiumQuoteAmount:l.premiumQuoteAmount,expiry:Number(l.expiry),exercised:!!l.exercised,uSym:s.sym,qSym:n.sym,uDec:s.dec,qDec:n.dec})}v(r)}catch(e){}}async function D(r){let i=r.id.toString();if(!e||!t){S(e=>({...e,[i]:"Connect wallet first."})),A(e=>({...e,[i]:"error"}));return}S(e=>({...e,[i]:"Approving premium..."})),A(e=>({...e,[i]:"info"}));try{if(await a(),await d.R.readContract({address:r.quote,abi:[{type:"function",name:"allowance",stateMutability:"view",inputs:[{name:"",type:"address"},{name:"",type:"address"}],outputs:[{type:"uint256"}]}],functionName:"allowance",args:[e,n]})<r.premiumQuoteAmount){let a=await t.writeContract({address:r.quote,abi:[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],outputs:[{type:"bool"}]}],functionName:"approve",args:[n,r.premiumQuoteAmount],chain:d.A,account:e});await d.R.waitForTransactionReceipt({hash:a})}S(e=>({...e,[i]:"Purchasing option..."}));let l=await t.writeContract({address:n,abi:u.I5,functionName:"buyOption",args:[r.id],chain:d.A,account:e});S(e=>({...e,[i]:"Confirming..."})),await d.R.waitForTransactionReceipt({hash:l}),S(e=>({...e,[i]:"Option purchased! NFT minted."})),A(e=>({...e,[i]:"success"})),await T(),await q()}catch(e){S(t=>({...t,[i]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),A(e=>({...e,[i]:"error"}))}}async function M(r){let i="ex-".concat(r.tokenId);if(!e||!t){S(e=>({...e,[i]:"Connect wallet first."})),A(e=>({...e,[i]:"error"}));return}S(e=>({...e,[i]:"Approving strike..."})),A(e=>({...e,[i]:"info"}));try{if(await a(),await d.R.readContract({address:r.quote,abi:[{type:"function",name:"allowance",stateMutability:"view",inputs:[{name:"",type:"address"},{name:"",type:"address"}],outputs:[{type:"uint256"}]}],functionName:"allowance",args:[e,n]})<r.strikeQuoteAmount){let a=await t.writeContract({address:r.quote,abi:[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"",type:"address"},{name:"",type:"uint256"}],outputs:[{type:"bool"}]}],functionName:"approve",args:[n,r.strikeQuoteAmount],chain:d.A,account:e});await d.R.waitForTransactionReceipt({hash:a})}S(e=>({...e,[i]:"Exercising..."}));let l=await t.writeContract({address:n,abi:u.I5,functionName:"exercise",args:[r.tokenId],chain:d.A,account:e});await d.R.waitForTransactionReceipt({hash:l}),S(e=>({...e,[i]:"Exercised!"})),A(e=>({...e,[i]:"success"})),await q()}catch(e){S(t=>({...t,[i]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),A(e=>({...e,[i]:"error"}))}}(0,i.useEffect)(()=>{T().catch(()=>{})},[]),(0,i.useEffect)(()=>{e&&q().catch(()=>{})},[e]);let Q=c.reduce((e,t)=>e+Number((0,s.J)(t.premiumQuoteAmount,t.qDec)),0),P=c.reduce((e,t)=>e+Number((0,s.J)(t.underlyingAmount,t.uDec)),0);return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[(0,r.jsxs)("div",{className:"lm-stat",children:[(0,r.jsx)("div",{className:"lm-stat-value",children:c.length}),(0,r.jsx)("div",{className:"lm-stat-label",children:"Active Offers"})]}),(0,r.jsxs)("div",{className:"lm-stat",children:[(0,r.jsx)("div",{className:"lm-stat-value text-lm-orange",children:h(String(Q))}),(0,r.jsx)("div",{className:"lm-stat-label",children:"Total Premium"})]}),(0,r.jsxs)("div",{className:"lm-stat",children:[(0,r.jsx)("div",{className:"lm-stat-value",children:h(String(P))}),(0,r.jsx)("div",{className:"lm-stat-label",children:"Total Collateral"})]}),(0,r.jsxs)("div",{className:"lm-stat",children:[(0,r.jsx)("div",{className:"lm-stat-value",children:b.length}),(0,r.jsx)("div",{className:"lm-stat-label",children:"Your Options"})]})]}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>I("market"),className:"flex-1 text-xs py-2 border transition-colors font-bold ".concat("market"===E?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{children:"Available Options"}),(0,r.jsx)("div",{className:"text-[9px] opacity-60 font-normal",children:"Browse & buy from market"})]}),(0,r.jsxs)("button",{type:"button",onClick:()=>I("positions"),className:"flex-1 text-xs py-2 border transition-colors font-bold ".concat("positions"===E?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsxs)("div",{children:["My Positions ",b.length>0&&"(".concat(b.length,")")]}),(0,r.jsx)("div",{className:"text-[9px] opacity-60 font-normal",children:"Exercise & manage"})]})]}),"market"===E&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:w?"Scanning chain...":"".concat(c.length," Active Option").concat(1!==c.length?"s":"")}),(0,r.jsx)("button",{type:"button",onClick:()=>T(),disabled:w,className:"text-[10px] px-2 py-1 border border-lm-orange text-lm-orange hover:bg-lm-orange/5 transition-colors font-bold",children:w?"...":"Refresh"})]}),0!==c.length||w?(0,r.jsx)("div",{className:"space-y-2",children:c.map(t=>{var a,i;let l=t.id.toString(),n=C[l],c=R[l]||"info",o=(null==e?void 0:e.toLowerCase())===t.writer.toLowerCase(),d=p(t.expiry);return(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 lm-card-hover transition-all",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-white font-bold text-sm",children:[t.uSym,"/",t.qSym]}),(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono",children:["#",l]})]}),(0,r.jsx)("div",{className:"flex items-center gap-1",children:(0,r.jsx)("span",{className:"lm-badge ".concat(y(t.expiry)),children:d})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-2 text-[10px] mb-3",children:[(0,r.jsxs)("div",{className:"bg-lm-black p-2 border border-lm-terminal-gray",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Collateral"}),(0,r.jsx)("div",{className:"text-white lm-mono text-xs font-bold mt-0.5",children:h((0,s.J)(t.underlyingAmount,t.uDec))}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:t.uSym})]}),(0,r.jsxs)("div",{className:"bg-lm-black p-2 border border-lm-terminal-gray",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Strike"}),(0,r.jsx)("div",{className:"text-white lm-mono text-xs font-bold mt-0.5",children:h((0,s.J)(t.strikeQuoteAmount,t.qDec))}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:t.qSym})]}),(0,r.jsxs)("div",{className:"bg-lm-black p-2 border border-lm-orange/20",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Premium"}),(0,r.jsx)("div",{className:"text-lm-orange lm-mono text-xs font-bold mt-0.5",children:h((0,s.J)(t.premiumQuoteAmount,t.qDec))}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:t.qSym})]}),(0,r.jsxs)("div",{className:"bg-lm-black p-2 border border-lm-terminal-gray",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Expires"}),(0,r.jsx)("div",{className:"text-white text-xs font-bold mt-0.5",children:g(t.expiry)}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:d})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[(0,r.jsxs)("div",{className:"text-[10px] text-lm-terminal-lightgray",children:["Writer: ",(0,r.jsx)("a",{href:(a=t.writer,"".concat(m.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/address/").concat(a)),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono",children:(i=t.writer).slice(0,6)+"..."+i.slice(-4)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[n&&(0,r.jsx)("span",{className:"text-[10px] ".concat("success"===c?"text-lm-green":"error"===c?"text-lm-red":"text-lm-gray"),children:n}),e&&!o?(0,r.jsx)("button",{type:"button",onClick:()=>D(t),disabled:"info"===R[t.id.toString()],className:"text-xs px-4 py-1.5 bg-lm-orange text-black font-bold hover:bg-lm-orange/80 transition-colors disabled:opacity-40 disabled:pointer-events-none",children:"info"===R[t.id.toString()]?"Processing...":"Buy for ".concat(h((0,s.J)(t.premiumQuoteAmount,t.qDec))," ").concat(t.qSym)}):o?(0,r.jsx)("span",{className:"text-[10px] text-lm-terminal-lightgray",children:"Your offer — manage in Earn tab"}):(0,r.jsx)("span",{className:"text-[10px] text-lm-terminal-lightgray",children:"Connect wallet to buy"})]})]})]},l)})}):(0,r.jsxs)("div",{className:"text-center py-10 space-y-2",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:"No Options Available"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:N||"Writers can create offers in the Earn tab."})]})]}),"positions"===E&&(0,r.jsx)("div",{className:"space-y-2",children:e?0===b.length?(0,r.jsxs)("div",{className:"text-center py-10 space-y-2",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:"No Options Owned"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:"Buy an option from the market to start trading."})]}):b.map(e=>{let t="ex-".concat(e.tokenId),a=e.expiry<Math.floor(Date.now()/1e3),i=!e.exercised&&!a,l=C[t],n=R[t]||"info";return(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border p-3 transition-colors ".concat(e.exercised?"border-lm-green/20":a?"border-lm-red/20 opacity-60":"border-lm-orange/20"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono",children:["NFT #",e.tokenId.toString()]}),(0,r.jsxs)("span",{className:"text-white font-bold text-sm",children:[e.uSym,"/",e.qSym]})]}),(0,r.jsx)("span",{className:"lm-badge ".concat(e.exercised?"lm-badge-green":a?"lm-badge-red":y(e.expiry)),children:e.exercised?"EXERCISED":a?"EXPIRED":p(e.expiry)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-[10px] mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Collateral"}),(0,r.jsxs)("div",{className:"text-white lm-mono text-xs font-bold",children:[h((0,s.J)(e.underlyingAmount,e.uDec))," ",e.uSym]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Exercise Cost"}),(0,r.jsxs)("div",{className:"text-white lm-mono text-xs font-bold",children:[h((0,s.J)(e.strikeQuoteAmount,e.qDec))," ",e.qSym]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Premium Paid"}),(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray lm-mono text-xs",children:[h((0,s.J)(e.premiumQuoteAmount,e.qDec))," ",e.qSym]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Expires"}),(0,r.jsx)("div",{className:"text-white text-xs",children:g(e.expiry)})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[i&&(0,r.jsx)("button",{type:"button",onClick:()=>M(e),disabled:"info"===R["ex-".concat(e.tokenId)],className:"text-xs px-4 py-1.5 bg-lm-green/90 text-black font-bold hover:bg-lm-green transition-colors disabled:opacity-40 disabled:pointer-events-none",children:"info"===R["ex-".concat(e.tokenId)]?"Processing...":"Exercise — Pay ".concat(h((0,s.J)(e.strikeQuoteAmount,e.qDec))," ").concat(e.qSym,", Receive ").concat(h((0,s.J)(e.underlyingAmount,e.uDec))," ").concat(e.uSym)}),l&&(0,r.jsx)("span",{className:"text-[10px] ".concat("success"===n?"text-lm-green":"error"===n?"text-lm-red":"text-lm-gray"),children:l})]})]},e.tokenId.toString())}):(0,r.jsxs)("div",{className:"text-center py-10 space-y-2",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:"No Wallet Connected"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:"Connect your wallet to view purchased options."})]})})]})}function N(){let{address:e,walletClient:t,requireCorrectChain:a}=(0,o.v)(),n=m.$.coveredCallVault,[c,x]=(0,i.useState)([]),[b,v]=(0,i.useState)(""),[N,j]=(0,i.useState)(!1),[w,k]=(0,i.useState)({}),[C,S]=(0,i.useState)({});async function R(){if(!e||!n)return void x([]);j(!0),v("");try{let t=await d.R.getBlockNumber(),a=await d.R.getLogs({address:n,event:(0,l.$)("event OfferCreated(uint256 indexed offerId,address indexed writer)"),args:{writer:e},fromBlock:t>50000n?t-50000n:0n,toBlock:t}),r=[...new Set(a.map(e=>e.args.offerId))].reverse().slice(0,30),i=[];for(let e of r)try{let t=await d.R.readContract({address:n,abi:u.I5,functionName:"offers",args:[e]}),a=await f(t.underlying),r=await f(t.quote);i.push({id:e,writer:t.writer,underlying:t.underlying,quote:t.quote,underlyingAmount:t.underlyingAmount,strikeQuoteAmount:t.strikeQuoteAmount,premiumQuoteAmount:t.premiumQuoteAmount,expiry:Number(t.expiry),active:!!t.active,strikeTick:Number(t.strikeTick),uSym:a.sym,qSym:r.sym,uDec:a.dec,qDec:r.dec})}catch(e){}x(i),0===i.length&&v("No offers found. Write your first covered call below.")}catch(e){v(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e))}finally{j(!1)}}async function A(r){let i=r.toString();if(!e||!t){k(e=>({...e,[i]:"Connect wallet first."})),S(e=>({...e,[i]:"error"}));return}k(e=>({...e,[i]:"Cancelling..."})),S(e=>({...e,[i]:"info"}));try{await a();let l=await t.writeContract({address:n,abi:u.I5,functionName:"cancelOffer",args:[r],chain:d.A,account:e});await d.R.waitForTransactionReceipt({hash:l}),k(e=>({...e,[i]:"Cancelled! Collateral returned."})),S(e=>({...e,[i]:"success"})),await R()}catch(e){k(t=>({...t,[i]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),S(e=>({...e,[i]:"error"}))}}(0,i.useEffect)(()=>{e&&R().catch(()=>{})},[e]);let E=c.filter(e=>e.active),I=c.filter(e=>!e.active),T=E.reduce((e,t)=>e+Number((0,s.J)(t.premiumQuoteAmount,t.qDec)),0),q=E.reduce((e,t)=>e+Number((0,s.J)(t.underlyingAmount,t.uDec)),0);return e?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-green/20 p-3 space-y-2",children:[(0,r.jsx)("div",{className:"text-lm-green font-bold text-xs lm-upper",children:"How You Earn"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-[10px] text-lm-terminal-lightgray",children:[(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("div",{className:"w-5 h-5 border border-lm-green flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("span",{className:"text-lm-green font-bold text-[9px]",children:"1"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-white font-bold",children:"Deposit collateral"})," — lock tokens as backing for the option"]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("div",{className:"w-5 h-5 border border-lm-green flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("span",{className:"text-lm-green font-bold text-[9px]",children:"2"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-white font-bold",children:"Earn premium"})," — a buyer pays you upfront to purchase the option"]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2",children:[(0,r.jsx)("div",{className:"w-5 h-5 border border-lm-green flex items-center justify-center flex-shrink-0",children:(0,r.jsx)("span",{className:"text-lm-green font-bold text-[9px]",children:"3"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-white font-bold",children:"Reclaim or settle"})," — if the option expires unused, reclaim your collateral"]})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[(0,r.jsxs)("div",{className:"lm-stat",children:[(0,r.jsx)("div",{className:"lm-stat-value text-lm-green",children:E.length}),(0,r.jsx)("div",{className:"lm-stat-label",children:"Active Offers"})]}),(0,r.jsxs)("div",{className:"lm-stat",children:[(0,r.jsx)("div",{className:"lm-stat-value",children:I.length}),(0,r.jsx)("div",{className:"lm-stat-label",children:"Filled / Cancelled"})]}),(0,r.jsxs)("div",{className:"lm-stat",children:[(0,r.jsx)("div",{className:"lm-stat-value text-lm-orange",children:h(String(T))}),(0,r.jsx)("div",{className:"lm-stat-label",children:"Premium Earnable"})]}),(0,r.jsxs)("div",{className:"lm-stat",children:[(0,r.jsx)("div",{className:"lm-stat-value",children:h(String(q))}),(0,r.jsx)("div",{className:"lm-stat-label",children:"Collateral Locked"})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Your Offers"}),(0,r.jsx)("button",{type:"button",onClick:()=>R(),disabled:N,className:"text-[10px] px-2 py-1 border border-lm-orange text-lm-orange hover:bg-lm-orange/5 transition-colors font-bold",children:N?"...":"Refresh"})]}),0===c.length?(0,r.jsx)("div",{className:"text-center py-6 text-lm-terminal-lightgray text-xs opacity-60",children:b||"No offers yet. Create one using the Write/Trade tab."}):(0,r.jsx)("div",{className:"space-y-2",children:c.map(e=>{let t=e.id.toString(),a=e.expiry<Math.floor(Date.now()/1e3),i=w[t],l=C[t]||"info";return(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border p-3 transition-colors ".concat(e.active?"border-lm-green/20":"border-lm-terminal-gray opacity-60"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono",children:["#",t]}),(0,r.jsxs)("span",{className:"text-white font-bold text-sm",children:[e.uSym,"/",e.qSym]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"lm-badge ".concat(e.active?"lm-badge-green":"lm-badge-gray"),children:e.active?"ACTIVE":"CLOSED"}),e.active&&(0,r.jsx)("span",{className:"lm-badge ".concat(y(e.expiry)),children:p(e.expiry)})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-[10px] mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Collateral Locked"}),(0,r.jsxs)("div",{className:"text-white lm-mono font-bold",children:[h((0,s.J)(e.underlyingAmount,e.uDec))," ",e.uSym]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike Price"}),(0,r.jsxs)("div",{className:"text-white lm-mono font-bold",children:[h((0,s.J)(e.strikeQuoteAmount,e.qDec))," ",e.qSym]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Your Premium"}),(0,r.jsxs)("div",{className:"text-lm-green lm-mono font-bold",children:[h((0,s.J)(e.premiumQuoteAmount,e.qDec))," ",e.qSym]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Expires"}),(0,r.jsx)("div",{className:"text-white",children:g(e.expiry)})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[e.active&&!a&&(0,r.jsx)("button",{type:"button",onClick:()=>A(e.id),disabled:"info"===C[e.id.toString()],className:"text-[10px] px-3 py-1 bg-lm-red/10 text-lm-red border border-lm-red/30 hover:bg-lm-red/20 transition-colors disabled:opacity-40 disabled:pointer-events-none",children:"info"===C[e.id.toString()]?"Cancelling...":"Cancel & Return Collateral"}),!e.active&&a&&(0,r.jsx)("span",{className:"text-[10px] text-lm-terminal-lightgray",children:"Filled & expired — use Write/Chart tab to reclaim with the option NFT ID"}),i&&(0,r.jsx)("span",{className:"text-[10px] ".concat("success"===l?"text-lm-green":"error"===l?"text-lm-red":"text-lm-gray"),children:i})]})]},t)})})]}):(0,r.jsxs)("div",{className:"text-center py-10 space-y-2",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:"No Wallet Connected"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:"Connect your wallet to write covered calls and earn premiums."})]})}function j(e){let{OptionsPanel:t}=e,a=(0,i.useMemo)(()=>[{id:"trade",label:"Trade",hint:"Buy options from available liquidity"},{id:"earn",label:"Earn",hint:"Write covered calls, earn premiums"},{id:"write",label:"Write/Chart",hint:"Create offers + price chart"}],[]),[l,s]=(0,i.useState)("trade"),o=(0,i.useCallback)(e=>{["buy_option","preview_offer"].includes(e.type)?s("trade"):["cancel_option"].includes(e.type)?s("earn"):["write_call","exercise","reclaim","preview_position","load_chart"].includes(e.type)?s("write"):"switch_tab"===e.type&&["trade","earn","write"].includes(e.tab)&&s(e.tab)},[]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(x.jc,{context:"options",onIntent:o,placeholder:"write call TSLA 100 strike 0.5 premium 0.01 7d \xb7 buy option #5 \xb7 exercise #3 \xb7 help"}),(0,r.jsxs)(n.Z,{title:"Options",hint:"Covered calls backed by escrowed collateral. Each position is a tradeable ERC-721 NFT.",right:(0,r.jsx)(c.Z,{tabs:a,active:l,onChange:s}),children:["trade"===l?(0,r.jsx)(v,{}):null,"earn"===l?(0,r.jsx)(N,{}):null,"write"===l?(0,r.jsx)(t,{}):null]})]})}},4508:(e,t,a)=>{"use strict";a.d(t,{OptionsPanel:()=>R});var r=a(5155),i=a(2115),l=a(2307),s=a(5028),n=a(8245),c=a(598),o=a(6630),d=a(8590),m=a(9719),x=a(8839),u=a(2933),h=a(3376),g=a(9998);let p="rgba(207,255,4,0.3)",y="rgba(207,255,4,0.85)",b="rgba(255,255,255,0.04)";function f(e){let{title:t,subtitle:a,data:l}=e,s=(0,i.useRef)(null),n=(0,i.useRef)(null),c=(0,i.useRef)(null),o=(0,i.useMemo)(()=>l.length?l[l.length-1]:void 0,[l]),d=(0,i.useMemo)(()=>{if(l.length<2)return null;let e=l[0].value,t=l[l.length-1].value;if(!e||0===e)return null;let a=(t-e)/e*100;return{pct:a,up:a>=0}},[l]);return(0,i.useEffect)(()=>{if(!s.current)return;let e=(0,g.R9)(s.current,{autoSize:!0,layout:{background:{color:"rgba(0,0,0,0)"},textColor:"#9e9e9e",fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace",fontSize:10},grid:{vertLines:{color:b},horzLines:{color:b}},rightPriceScale:{borderColor:p,scaleMargins:{top:.08,bottom:.08}},timeScale:{borderColor:p,timeVisible:!0,secondsVisible:!1},crosshair:{mode:g._q.Normal,vertLine:{color:p,labelBackgroundColor:y},horzLine:{color:p,labelBackgroundColor:y}}}),t=e.addSeries(g.Im,{color:"#cfff04",lineWidth:2,priceLineVisible:!0,priceLineColor:p,lastValueVisible:!0});n.current=e,c.current=t;let a=new ResizeObserver(()=>e.timeScale().fitContent());return a.observe(s.current),()=>{a.disconnect(),e.remove(),n.current=null,c.current=null}},[]),(0,i.useEffect)(()=>{var e;c.current&&(c.current.setData(l),null==(e=n.current)||e.timeScale().fitContent())},[l]),(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-3 py-2 border-b border-lm-terminal-gray flex items-center justify-between gap-3 flex-wrap",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsx)("div",{className:"text-white font-bold text-sm",children:t}),a&&(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-mono break-all",children:a})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-xs",children:[null!==d&&(0,r.jsxs)("span",{className:"font-bold ".concat(d.up?"text-lm-green":"text-lm-red"),children:[d.up?"▲":"▼"," ",d.up?"+":"",d.pct.toFixed(2),"%"]}),o&&(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray",children:["Last: ",(0,r.jsx)("span",{className:"text-lm-orange lm-mono font-bold",children:Number(o.value).toPrecision(6)})]})]})]}),(0,r.jsx)("div",{ref:s,className:"h-[320px] w-full"}),0===l.length&&(0,r.jsxs)("div",{className:"text-center text-lm-terminal-lightgray text-xs py-8 -mt-[320px] relative z-10 space-y-1",children:[(0,r.jsx)("div",{className:"text-lg opacity-30",children:"\uD83D\uDCCA"}),(0,r.jsx)("div",{children:"No chart data yet"}),(0,r.jsx)("div",{className:"text-[10px] opacity-50",children:"Select a pool and click Load to view price history"})]})]})}var v=a(8604);function N(e){if(!/^0x[0-9a-fA-F]{40}$/.test(e))throw Error("Invalid address");return e}function j(e){return e.slice(0,6)+"..."+e.slice(-4)}function w(e){return"".concat(u.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/address/").concat(e)}let k=[{label:"5K",blocks:5000n},{label:"20K",blocks:20000n},{label:"80K",blocks:80000n}];function C(e){return e?new Date(1e3*e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}function S(e){return String(Math.floor(Date.now()/1e3)+86400*e)}function R(){var e,t;let{address:a,walletClient:g,requireCorrectChain:p,connect:y}=(0,m.v)(),[b,R]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{if(u.$.tokenRegistry)try{let e=Number(await x.R.readContract({address:u.$.tokenRegistry,abi:h.wn,functionName:"tokenCount"})),t=[];for(let a=0;a<Math.min(e,30);a++){let e=await x.R.readContract({address:u.$.tokenRegistry,abi:h.wn,functionName:"tokenAt",args:[BigInt(a)]}),r="???",i=18;try{r=await x.R.readContract({address:e,abi:h.Qi,functionName:"symbol"})}catch(e){}try{i=Number(await x.R.readContract({address:e,abi:h.Qi,functionName:"decimals"}))}catch(e){}t.push({addr:e,symbol:r,decimals:i})}R(t)}catch(e){}})()},[]);let A=u.$.coveredCallVault,[E,I]=(0,i.useState)(""),[T,q]=(0,i.useState)(null),D=u.$.weth,[M,Q]=(0,i.useState)(null),[P,O]=(0,i.useState)(""),[B,L]=(0,i.useState)("3600"),[F,W]=(0,i.useState)(""),[_,V]=(0,i.useState)(""),[J,$]=(0,i.useState)(""),[U,H]=(0,i.useState)(""),[z,X]=(0,i.useState)("7"),[Y,K]=(0,i.useState)(""),[Z,G]=(0,i.useState)(""),[ee,et]=(0,i.useState)(null),[ea,er]=(0,i.useState)(null),[ei,el]=(0,i.useState)(""),[es,en]=(0,i.useState)("info"),[ec,eo]=(0,i.useState)(!1),[ed,em]=(0,i.useState)(""),[ex,eu]=(0,i.useState)(!1),[eh,eg]=(0,i.useState)(""),[ep,ey]=(0,i.useState)([]),[eb,ef]=(0,i.useState)(20000n),ev=(0,i.useRef)(()=>{}),eN=(0,i.useRef)(()=>{}),ej=(0,i.useRef)(b);ej.current=b,(0,v.SL)((0,i.useCallback)(e=>{if("write_call"===e.type){let t=ej.current;if(e.underlying){let a=e.underlying.toUpperCase(),r=t.find(e=>e.symbol.toUpperCase()===a);r&&I(r.addr)}e.amount&&V(e.amount),e.strike&&$(e.strike),e.premium&&H(e.premium),e.expiry&&X(e.expiry),e.twap&&L(e.twap)}else"buy_option"===e.type&&e.offerId?K(e.offerId):"preview_offer"===e.type&&e.offerId?(K(e.offerId),setTimeout(()=>ev.current(),0)):"exercise"===e.type&&e.tokenId||"reclaim"===e.type&&e.tokenId?G(e.tokenId):"preview_position"===e.type&&e.tokenId?(G(e.tokenId),setTimeout(()=>eN.current(),0)):"cancel_option"===e.type&&e.offerId?K(e.offerId):"load_chart"===e.type&&e.blocks&&ef(BigInt(e.blocks))},[]));let ew=(0,i.useRef)({}),ek=(0,i.useCallback)(async e=>{let t=e.toLowerCase();if("number"==typeof ew.current[t])return ew.current[t];let a=Number(await x.R.readContract({address:e,abi:h.Qi,functionName:"decimals"}));return ew.current[t]=a,a},[]);(0,i.useEffect)(()=>{if(!E||!/^0x[0-9a-fA-F]{40}$/.test(E))return void q(null);(async()=>{try{let e="???",t=18;try{e=await x.R.readContract({address:E,abi:h.Qi,functionName:"symbol"})}catch(e){}try{t=Number(await x.R.readContract({address:E,abi:h.Qi,functionName:"decimals"}))}catch(e){}q({addr:E,symbol:e,decimals:t})}catch(e){q(null)}})()},[E]),(0,i.useEffect)(()=>{if(!D)return void Q(null);(async()=>{try{let e="WETH",t=18;try{e=await x.R.readContract({address:D,abi:h.Qi,functionName:"symbol"})}catch(e){}try{t=Number(await x.R.readContract({address:D,abi:h.Qi,functionName:"decimals"}))}catch(e){}Q({addr:D,symbol:e,decimals:t})}catch(e){Q(null)}})()},[D]);let eC=(0,i.useCallback)(e=>{let t=Math.exp(e*Math.log(1.0001));return Number.isFinite(t)&&t>0?t:null},[]),eS=(0,i.useCallback)(async(e,t,a,r)=>{let i=[{type:"function",name:"token0",stateMutability:"view",inputs:[],outputs:[{type:"address"}]},{type:"function",name:"token1",stateMutability:"view",inputs:[],outputs:[{type:"address"}]}],[l,s]=await Promise.all([x.R.readContract({address:e,abi:i,functionName:"token0"}),x.R.readContract({address:e,abi:i,functionName:"token1"})]),n=eC(r);if(null===n)return null;let c=n*Math.pow(10,await ek(l)-await ek(s)),o=t.toLowerCase(),d=a.toLowerCase();return o===s.toLowerCase()&&d===l.toLowerCase()?c:o===l.toLowerCase()&&d===s.toLowerCase()?0===c?null:1/c:null},[ek,eC]),eR=(0,i.useCallback)(async()=>{eu(!0),eg("Loading swap data...");try{let e=N(P),t=N(E),a=await x.R.getBlockNumber(),r=(0,l.$)("event Swap(address indexed sender,address indexed recipient,int256 amount0,int256 amount1,uint160 sqrtPriceX96,uint128 liquidity,int24 tick)"),i=await x.R.getLogs({address:e,event:r,fromBlock:a>eb?a-eb:0n,toBlock:a});if(!i.length){ey([]),eg("No swaps found.");return}let s=Array.from(new Set(i.map(e=>e.blockNumber))),n=await Promise.all(s.map(e=>x.R.getBlock({blockNumber:e}))),c=new Map;for(let e of n)c.set(e.number,Number(e.timestamp));let o=Math.max(1,Math.floor(i.length/600)),d=[];for(let a=0;a<i.length;a+=o){let r=i[a],l=c.get(r.blockNumber);if(!l)continue;let s=Number(r.args.tick),n=await eS(e,t,D,s);null!==n&&Number.isFinite(n)&&!(n<=0)&&d.push({time:l,value:Number(n.toPrecision(10))})}d.sort((e,t)=>Number(e.time)-Number(t.time)),ey(d),eg(0===d.length?"Could not resolve prices from swaps.":"")}catch(e){ey([]),eg(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e))}finally{eu(!1)}},[eb,P,E,D,eS]),eA=(0,i.useMemo)(()=>{let e=Number(B||"0");return!Number.isFinite(e)||e<=0?"":e<900?"Min TWAP is 900s (15 min).":""},[B]);async function eE(e,t,a,r){if(await x.R.readContract({address:a,abi:h.bx,functionName:"allowance",args:[e,t]})>=r)return;if(!g)throw Error("No wallet client");el("Approving token...");let i=await g.writeContract({address:a,abi:h.bx,functionName:"approve",args:[t,r],chain:x.A,account:e});await x.R.waitForTransactionReceipt({hash:i})}async function eI(){if(!a||!g){el("Connect wallet."),en("error");return}let e=(null==T?void 0:T.symbol)||"tokens";eo(!0),em("");try{var t,r;el("Preparing ".concat(e," covered call offer...")),en("info"),await p();let i=N(E),l=N(P);if(!A)throw Error("Missing vault address in config.");let n=null!=(t=null==T?void 0:T.decimals)?t:await ek(i),c=null!=(r=null==M?void 0:M.decimals)?r:18,o=(0,s.X)(_||"0",n),d=(0,s.X)(J||"0",c),m=(0,s.X)(U||"0",c),u=BigInt(S(Number(z||"7")));if(o<=0n)throw Error("Underlying amount must be > 0");if(d<=0n)throw Error("Strike must be > 0");if(m<=0n)throw Error("Premium must be > 0");await eE(a,A,i,o),el("Writing ".concat(_," ").concat(e," call (").concat(z,"d expiry)..."));let y=await g.writeContract({address:A,abi:h.I5,functionName:"createOffer",args:[i,D,l,Number(B||"0"),Number(F||"0"),o,d,m,u],chain:x.A,account:a});em(y),el("Confirming on-chain...");let b=await x.R.waitForTransactionReceipt({hash:y});"success"===b.status?(el("Offer created! ".concat(_," ").concat(e," escrowed. Premium: ").concat(U," ETH. Expires in ").concat(z,"d.")),en("success")):(el("Transaction reverted. Check that you have enough tokens and try again."),en("error"))}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?el("Transaction cancelled by user."):el("Create offer failed: ".concat(e)),en("error")}finally{eo(!1)}}async function eT(){eo(!0);try{el("");let e=BigInt(Y||"0"),t=await x.R.readContract({address:A,abi:h.I5,functionName:"offers",args:[e]});et(t),el("")}catch(e){et(null),el(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)),en("error")}finally{eo(!1)}}async function eq(){if(!a||!g){el("Connect wallet."),en("error");return}eo(!0),em("");try{el("Loading offer #".concat(Y,"...")),en("info"),await p();let e=BigInt(Y||"0"),t=await x.R.readContract({address:A,abi:h.I5,functionName:"offers",args:[e]});if(!t.active)throw Error("Offer #"+Y+" is no longer active (may be expired, sold, or cancelled).");let r=(0,n.c)(t.premiumQuoteAmount);el("Buying option #".concat(Y," for ").concat(r," ETH premium...")),await eE(a,A,t.quote,t.premiumQuoteAmount),el("Awaiting signature...");let i=await g.writeContract({address:A,abi:h.I5,functionName:"buyOption",args:[e],chain:x.A,account:a});em(i),el("Confirming on-chain..."),await x.R.waitForTransactionReceipt({hash:i}),el("Option purchased! You paid ".concat(r," ETH premium. Your option NFT has been minted.")),en("success")}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?el("Transaction cancelled by user."):el("Buy failed: ".concat(e)),en("error")}finally{eo(!1)}}async function eD(){if(!a||!g){el("Connect wallet."),en("error");return}eo(!0),em("");try{await p(),el("Cancelling..."),en("info");let e=BigInt(Y||"0"),t=await g.writeContract({address:A,abi:h.I5,functionName:"cancelOffer",args:[e],chain:x.A,account:a});em(t),await x.R.waitForTransactionReceipt({hash:t}),el("Offer cancelled."),en("success"),await eT()}catch(e){el(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)),en("error")}finally{eo(!1)}}async function eM(){eo(!0);try{el("");let e=await x.R.readContract({address:A,abi:h.I5,functionName:"optionNft"}),t=BigInt(Z||"0"),a=await x.R.readContract({address:e,abi:h.qm,functionName:"positions",args:[t]}),r=await x.R.readContract({address:A,abi:h.I5,functionName:"underlyingReclaimed",args:[t]}),i="???",l="???",s=18,n=18;try{i=await x.R.readContract({address:a.underlying,abi:h.Qi,functionName:"symbol"})}catch(e){}try{l=await x.R.readContract({address:a.quote,abi:h.Qi,functionName:"symbol"})}catch(e){}try{s=Number(await x.R.readContract({address:a.underlying,abi:h.Qi,functionName:"decimals"}))}catch(e){}try{n=Number(await x.R.readContract({address:a.quote,abi:h.Qi,functionName:"decimals"}))}catch(e){}er({...a,optionNft:e,reclaimed:r,uSym:i,qSym:l,uDec:s,qDec:n})}catch(e){er(null),el(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)),en("error")}finally{eo(!1)}}async function eQ(){if(!a||!g){el("Connect wallet."),en("error");return}eo(!0),em("");try{await p(),el("Loading option NFT #".concat(Z,"...")),en("info");let e=await x.R.readContract({address:A,abi:h.I5,functionName:"optionNft"}),t=await x.R.readContract({address:e,abi:h.qm,functionName:"positions",args:[BigInt(Z||"0")]}),r=(0,n.c)(t.strikeQuoteAmount);el("Exercising option #".concat(Z," — paying ").concat(r," ETH strike...")),await eE(a,A,t.quote,t.strikeQuoteAmount),el("Awaiting signature...");let i=await g.writeContract({address:A,abi:h.I5,functionName:"exercise",args:[BigInt(Z||"0")],chain:x.A,account:a});em(i),el("Confirming on-chain..."),await x.R.waitForTransactionReceipt({hash:i}),el("Option #".concat(Z," exercised! You paid ").concat(r," ETH and received the underlying tokens.")),en("success"),await eM()}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?el("Transaction cancelled by user."):e.includes("NOT_ITM")?el("Option is not in-the-money. TWAP price must exceed the strike price to exercise."):e.includes("EXPIRED")?el("Option has expired. Use 'Reclaim' if you are the writer."):el("Exercise failed: ".concat(e)),en("error")}finally{eo(!1)}}async function eP(){if(!a||!g){el("Connect wallet."),en("error");return}eo(!0),em("");try{await p(),el("Reclaiming..."),en("info");let e=await g.writeContract({address:A,abi:h.I5,functionName:"reclaimExpired",args:[BigInt(Z||"0")],chain:x.A,account:a});em(e),await x.R.waitForTransactionReceipt({hash:e}),el("Expired underlying reclaimed!"),en("success"),await eM()}catch(e){el(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)),en("error")}finally{eo(!1)}}ev.current=eT,eN.current=eM;let eO=Number(S(Number(z||"7")));return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-3 space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[(0,r.jsx)("div",{className:"text-white font-bold text-sm lm-upper",children:"Price Chart"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[k.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>ef(e.blocks),className:"text-[10px] px-2 py-1 border transition-colors ".concat(eb===e.blocks?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.label)),(0,r.jsx)("button",{type:"button",disabled:ex||!P||!E,onClick:()=>eR(),className:"text-[10px] px-3 py-1 bg-lm-orange text-black font-bold hover:bg-lm-orange/80 disabled:opacity-40 transition-colors",children:ex?"...":"Load"})]})]}),(0,r.jsx)(f,{title:T?"".concat(T.symbol," / ").concat((null==M?void 0:M.symbol)||"WETH"):"Select underlying token",subtitle:P?"Pool: ".concat(j(P)):"Enter pool address to load chart",data:ep}),eh&&(0,r.jsx)("div",{className:"text-lm-red text-xs",children:eh})]}),(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-4 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-7 h-7 border border-lm-orange flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-lm-orange font-bold text-xs",children:"1"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-white font-bold text-sm lm-upper",children:"Write Covered Call"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Deposit tokens as collateral. Earn premium when someone buys your option."})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Collateral Token"}),b.length>0?(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"flex gap-1 flex-wrap",children:b.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>I(e.addr),className:"text-[10px] px-2 py-1 border transition-colors ".concat(E.toLowerCase()===e.addr.toLowerCase()?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.symbol},e.addr))}),(0,r.jsx)(d.p,{value:E,onValueChange:I,numeric:!1,placeholder:"Or paste token address..."})]}):(0,r.jsx)(d.p,{value:E,onValueChange:I,numeric:!1,placeholder:"0x..."}),T&&(0,r.jsxs)("div",{className:"text-[10px] text-lm-terminal-lightgray",children:["Selected: ",(0,r.jsx)("span",{className:"text-white font-bold",children:T.symbol})]})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Settlement Token"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 h-9 px-3 bg-lm-black border border-lm-terminal-gray text-white text-xs font-bold",children:[(null==M?void 0:M.symbol)||"WETH",(0,r.jsx)("span",{className:"text-lm-terminal-lightgray lm-mono text-[10px]",children:D?j(D):""})]}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Strike and premium paid in this token"})]})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Price Oracle Pool"}),(0,r.jsx)(d.p,{value:P,onValueChange:O,numeric:!1,placeholder:"Uniswap V3 pool address for this pair"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Used for TWAP price verification when exercising"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Collateral Amount"}),(0,r.jsx)(d.p,{value:_,onValueChange:V,placeholder:"100"}),T&&(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:[T.symbol," tokens to lock"]})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Expiry"}),(0,r.jsx)("div",{className:"flex gap-1",children:[{label:"1d",val:"1"},{label:"7d",val:"7"},{label:"14d",val:"14"},{label:"30d",val:"30"}].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>X(e.val),className:"flex-1 text-[10px] py-1.5 border transition-colors ".concat(z===e.val?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.val))}),(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:["Expires: ",C(eO)]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:["Strike Price (",(null==M?void 0:M.symbol)||"WETH",")"]}),(0,r.jsx)(d.p,{value:J,onValueChange:$,placeholder:"0.5"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Buyer pays this amount to exercise the option"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:["Premium (",(null==M?void 0:M.symbol)||"WETH",")"]}),(0,r.jsx)(d.p,{value:U,onValueChange:H,placeholder:"0.01"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"You earn this when someone buys your option"})]})]}),(0,r.jsxs)("details",{className:"text-[10px]",children:[(0,r.jsx)("summary",{className:"text-lm-terminal-lightgray hover:text-lm-orange cursor-pointer transition-colors",children:"Advanced settings (oracle TWAP, strike tick)"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 mt-2 p-2 bg-lm-black border border-lm-terminal-gray",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"TWAP Window"}),(0,r.jsx)("div",{className:"flex gap-1",children:[{label:"15m",val:"900"},{label:"1h",val:"3600"},{label:"4h",val:"14400"},{label:"24h",val:"86400"}].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>L(e.val),className:"flex-1 text-[9px] py-1 border transition-colors ".concat(B===e.val?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.val))}),(0,r.jsx)(d.p,{value:B,onValueChange:L,placeholder:"3600"}),eA&&(0,r.jsx)("div",{className:"text-lm-red text-[10px]",children:eA}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Price average window for exercise validation"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Strike Tick (raw)"}),(0,r.jsx)(d.p,{value:F,onValueChange:W,placeholder:"e.g. -23000"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Uniswap V3 tick for in-the-money check"})]})]})]}),(0,r.jsx)(o.$,{onClick:a?eI:y,loading:ec,disabled:ec||!!a&&(!E||!P||Number(B)>0&&900>Number(B)),variant:"primary",size:"lg",className:"w-full",children:ec?"Writing Call...":a?"Write Covered Call".concat(T?" (".concat(T.symbol,")"):""):"Connect Wallet"})]}),(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-4 space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-7 h-7 border border-lm-orange flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-lm-orange font-bold text-xs",children:"2"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-white font-bold text-sm lm-upper",children:"Buy Option"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Purchase an active offer to receive a tradeable option NFT."})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,r.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Offer ID"}),(0,r.jsx)(d.p,{value:Y,onValueChange:K,placeholder:"Enter offer number"})]}),(0,r.jsx)("button",{type:"button",onClick:eT,disabled:ec||!Y,className:"text-xs px-3 py-1.5 border border-lm-terminal-gray text-lm-terminal-lightgray hover:border-lm-orange hover:text-lm-orange disabled:opacity-40 transition-colors",children:"Preview"}),(0,r.jsx)(o.$,{onClick:eq,loading:ec,disabled:ec||!Y,variant:"primary",className:"px-5",children:ec?"Buying...":"Buy Option"})]}),ee&&(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-2 space-y-1 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-white font-bold",children:["Offer #",null==(e=ee.id)?void 0:e.toString()]}),(0,r.jsx)("span",{className:"px-1.5 py-0.5 border text-[10px] ".concat(ee.active?"border-lm-green text-lm-green":"border-lm-red text-lm-red"),children:ee.active?"ACTIVE":"INACTIVE"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Writer"}),(0,r.jsx)("a",{href:w(String(ee.writer)),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono",children:j(String(ee.writer))}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Underlying"}),(0,r.jsx)("a",{href:w(String(ee.underlying)),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono",children:j(String(ee.underlying))}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Amount"}),(0,r.jsx)("div",{className:"text-white lm-mono",children:null==(t=ee.underlyingAmount)?void 0:t.toString()}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Premium"}),(0,r.jsxs)("div",{className:"text-white lm-mono",children:[(0,n.c)(ee.premiumQuoteAmount||0n)," ETH"]}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike"}),(0,r.jsxs)("div",{className:"text-white lm-mono",children:[(0,n.c)(ee.strikeQuoteAmount||0n)," ETH"]}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike Tick"}),(0,r.jsx)("div",{className:"text-white lm-mono",children:Number(ee.strikeTick)}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Expiry"}),(0,r.jsx)("div",{className:"text-white",children:C(Number(ee.expiry))})]}),ee.active&&(null==a?void 0:a.toLowerCase())===String(ee.writer).toLowerCase()&&(0,r.jsx)("button",{type:"button",onClick:eD,disabled:ec,className:"text-[10px] px-2 py-1 border border-lm-red text-lm-red hover:bg-lm-red/5 transition-colors mt-1",children:"Cancel Offer (Writer Only)"})]})]}),(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-4 space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-7 h-7 border border-lm-orange flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-lm-orange font-bold text-xs",children:"3"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-white font-bold text-sm lm-upper",children:"Exercise / Reclaim"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"Exercise an in-the-money option, or reclaim expired collateral (writer only)."})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,r.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Option NFT ID"}),(0,r.jsx)(d.p,{value:Z,onValueChange:G,placeholder:"Enter NFT token ID"})]}),(0,r.jsx)("button",{type:"button",onClick:eM,disabled:ec||!Z,className:"text-xs px-3 py-1.5 border border-lm-terminal-gray text-lm-terminal-lightgray hover:border-lm-orange hover:text-lm-orange disabled:opacity-40 transition-colors",children:"Preview"})]}),ea&&(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-2 space-y-1 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,r.jsxs)("span",{className:"text-white font-bold",children:["Position #",Z]}),(0,r.jsx)("span",{className:"px-1.5 py-0.5 border text-[10px] ".concat(ea.exercised?"border-lm-green text-lm-green":ea.reclaimed?"border-lm-gray text-lm-gray":BigInt(ea.expiry)<BigInt(Math.floor(Date.now()/1e3))?"border-lm-red text-lm-red":"border-lm-orange text-lm-orange"),children:ea.exercised?"EXERCISED":ea.reclaimed?"RECLAIMED":BigInt(ea.expiry)<BigInt(Math.floor(Date.now()/1e3))?"EXPIRED":"ACTIVE"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Writer"}),(0,r.jsx)("a",{href:w(String(ea.writer)),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono",children:j(String(ea.writer))}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Underlying"}),(0,r.jsxs)("div",{className:"text-white",children:[ea.uSym," ",(0,r.jsxs)("span",{className:"lm-mono text-lm-gray",children:["(",j(String(ea.underlying)),")"]})]}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Amount"}),(0,r.jsxs)("div",{className:"text-white lm-mono",children:[(0,c.J)(ea.underlyingAmount||0n,ea.uDec||18)," ",ea.uSym]}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike"}),(0,r.jsxs)("div",{className:"text-white lm-mono",children:[(0,c.J)(ea.strikeQuoteAmount||0n,ea.qDec||18)," ",ea.qSym]}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Premium Paid"}),(0,r.jsxs)("div",{className:"text-white lm-mono",children:[(0,c.J)(ea.premiumQuoteAmount||0n,ea.qDec||18)," ",ea.qSym]}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Strike Tick"}),(0,r.jsx)("div",{className:"text-white lm-mono",children:Number(ea.strikeTick)}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:"Expiry"}),(0,r.jsx)("div",{className:"text-white",children:C(Number(ea.expiry))})]}),!ea.exercised&&!ea.reclaimed&&(0,r.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,r.jsx)(o.$,{onClick:eQ,loading:ec,disabled:ec,variant:"primary",size:"sm",className:"px-4",children:"Exercise"}),(0,r.jsx)(o.$,{onClick:eP,disabled:ec,size:"sm",className:"px-4",children:"Reclaim Expired"})]})]})]}),ei&&(0,r.jsxs)("div",{className:"text-xs p-2.5 border bg-lm-black flex items-center justify-between gap-2 ".concat("success"===es?"text-lm-green":"error"===es?"text-lm-red":"text-lm-gray"," ").concat("success"===es?"border-lm-green/20":"error"===es?"border-lm-red/20":"border-lm-terminal-gray"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:["info"===es&&(0,r.jsx)("span",{className:"lm-spinner flex-shrink-0",style:{width:12,height:12,borderWidth:1.5}}),"success"===es&&(0,r.jsx)("span",{className:"lm-dot lm-dot-green flex-shrink-0"}),"error"===es&&(0,r.jsx)("span",{className:"lm-dot lm-dot-red flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:ei})]}),ed&&(0,r.jsx)("a",{href:"".concat(u.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/tx/").concat(ed),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline flex-shrink-0",children:"View Tx →"})]})]})}}},e=>{e.O(0,[426,462,889,239,653,799,441,255,358],()=>e(e.s=65)),_N_E=e.O()}]);