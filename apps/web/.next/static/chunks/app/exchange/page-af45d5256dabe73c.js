(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[806],{330:(e,t,a)=>{"use strict";a.d(t,{PoolsPanel:()=>L});var r=a(5155),n=a(2115),l=a(598),s=a(5028),i=a(931),o=a(6630),c=a(8590),d=a(7280),m=a(2933),x=a(3376),u=a(8839),h=a(9719),g=a(8604);let p=[{label:"0.05%",fee:500,tickSpacing:10,hint:"Stables"},{label:"0.30%",fee:3e3,tickSpacing:60,hint:"Standard"},{label:"1.00%",fee:1e4,tickSpacing:200,hint:"Volatile"}],f=[{label:"0.5%",bps:50},{label:"1%",bps:100},{label:"3%",bps:300}],b=2n**160n-1n;function y(e,t){return Math.max(Math.ceil(-887272/t)*t,Math.min(Math.floor(887272/t)*t,e))}function v(e,t,a){return Math.pow(1.0001,e)*Math.pow(10,t-a)}function N(e){return 0!==e&&Number.isFinite(e)?e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e>=1?e.toFixed(4):e>=1e-4?e.toFixed(6):e>=1e-7?e.toFixed(10):e.toExponential(2):"—"}function w(e){return e<=0?1n:10n**BigInt(e)}function j(e){if(e<-887272||e>887272)throw Error("tick out of range");let t=e<0?-e:e,a=(1&t)!=0?0xfffcb933bd6fad37aa2d162d1a594001n:0x100000000000000000000000000000000n;(2&t)!=0&&(a=0xfff97272373d413259a46990580e213an*a>>128n),(4&t)!=0&&(a=0xfff2e50f5f656932ef12357cf3c7fdccn*a>>128n),(8&t)!=0&&(a=0xffe5caca7e10e4e61c3624eaa0941cd0n*a>>128n),(16&t)!=0&&(a=0xffcb9843d60f6159c9db58835c926644n*a>>128n),(32&t)!=0&&(a=0xff973b41fa98c081472e6896dfb254c0n*a>>128n),(64&t)!=0&&(a=0xff2ea16466c96a3843ec78b326b52861n*a>>128n),(128&t)!=0&&(a=0xfe5dee046a99a2a811c461f1969c3053n*a>>128n),(256&t)!=0&&(a=0xfcbe86c7900a88aedcffc83b479aa3a4n*a>>128n),(512&t)!=0&&(a=0xf987a7253ac413176f2b074cf7815e54n*a>>128n),(1024&t)!=0&&(a=0xf3392b0822b70005940c7a398e4b70f3n*a>>128n),(2048&t)!=0&&(a=0xe7159475a2c29b7443b29c7fa6e889d9n*a>>128n),(4096&t)!=0&&(a=0xd097f3bdfd2022b8845ad8f792aa5825n*a>>128n),(8192&t)!=0&&(a=0xa9f746462d870fdf8a65dc1f90e061e5n*a>>128n),(16384&t)!=0&&(a=0x70d869a156d2a1b890bb3df62baf32f7n*a>>128n),(32768&t)!=0&&(a=0x31be135f97d08fd981231505542fcfa6n*a>>128n),(65536&t)!=0&&(a=0x9aa508b5b7a84e1c677de54f3e99bc9n*a>>128n),(131072&t)!=0&&(a=0x5d6af8dedb81196699c329225ee604n*a>>128n),(262144&t)!=0&&(a=0x2216e584f5fa1ea926041bedfe98n*a>>128n),(524288&t)!=0&&(a=0x48a170391f7dc42444e8fa2n*a>>128n),e>0&&(a=((1n<<256n)-1n)/a);let r=(a&(1n<<32n)-1n)!==0n;return(a>>32n)+(r?1n:0n)}function k(e,t,a){if(0n===a)throw Error("div by zero");return e*t/a}function C(e,t,a){return e>t&&([e,t]=[t,e]),k(a,k(e,t,2n**96n),t-e)}function E(e,t,a){return e>t&&([e,t]=[t,e]),k(a,2n**96n,t-e)}function S(e,t,a,r){let n=2n**96n;return(t>a&&([t,a]=[a,t]),e<=t)?{amount0:k(r,(a-t)*n,t*a),amount1:0n}:e<a?{amount0:k(r,(a-e)*n,e*a),amount1:k(r,e-t,n)}:{amount0:0n,amount1:k(r,a-t,n)}}function M(e){let{mode:t,lower:a,upper:n,current:l,quoteLabel:s}=e;if(!l||!Number.isFinite(l)||l<=0)return null;let i=106;if("full"===t||!a||!n||!Number.isFinite(a)||!Number.isFinite(n)||a<=0||n<=0||a>=n)return(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-2 space-y-1 text-[10px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray lm-upper font-bold tracking-wider",children:"Range"}),(0,r.jsx)("span",{className:"lm-badge lm-badge-gray",children:"Full Range"})]}),(0,r.jsxs)("svg",{viewBox:"0 0 ".concat(520," ").concat(140),className:"w-full h-[140px] border border-lm-terminal-gray bg-lm-terminal-darkgray",children:[(0,r.jsx)("rect",{x:"0",y:"0",width:520,height:140,fill:"transparent"}),(0,r.jsx)("line",{x1:44,y1:i,x2:504,y2:i,stroke:"rgba(255,255,255,0.12)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:44,y1:16,x2:504,y2:16,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:44,y1:61,x2:504,y2:61,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:159,y1:16,x2:159,y2:i,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:274,y1:16,x2:274,y2:i,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:389,y1:16,x2:389,y2:i,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("path",{d:"M ".concat(44," ").concat(i," C ").concat(159," ").concat(25,", ").concat(389," ").concat(25,", ").concat(504," ").concat(i),fill:"rgba(207,255,4,0.10)",stroke:"rgba(207,255,4,0.35)",strokeWidth:"2"}),(0,r.jsx)("line",{x1:274,y1:16,x2:274,y2:i+2,stroke:"rgba(255,255,255,0.9)",strokeWidth:"2"}),(0,r.jsx)("text",{x:44,y:128,fill:"rgba(255,255,255,0.6)",fontSize:"11",children:"0"}),(0,r.jsxs)("text",{x:274,y:128,fill:"rgba(255,255,255,0.9)",fontSize:"11",textAnchor:"middle",className:"lm-mono",children:[N(l)," ",s]}),(0,r.jsx)("text",{x:504,y:128,fill:"rgba(255,255,255,0.6)",fontSize:"11",textAnchor:"end",children:"∞"})]})]});let o=l>=a&&l<=n,c=Math.log(a),d=Math.log(n),m=Math.log(l),x=e=>Math.max(0,Math.min(1,(e-c)/(d-c))),u=44+460*x(m),h=x(m),g=[];for(let e=0;e<=60;e++){let t=e/60,a=i-76.5*Math.exp(-Math.pow((t-h)/.18,2));g.push([44+460*t,a])}let p=["M ".concat(44," ").concat(i),"L ".concat(g.map(e=>{let[t,a]=e;return"".concat(t.toFixed(2)," ").concat(a.toFixed(2))}).join(" L ")),"L ".concat(504," ").concat(i),"Z"].join(" ");return(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-2 space-y-1 text-[10px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray lm-upper font-bold tracking-wider",children:"Range"}),(0,r.jsx)("span",{className:o?"lm-badge lm-badge-green":"lm-badge lm-badge-orange",children:o?"In Range":"Out of Range"})]}),(0,r.jsxs)("svg",{viewBox:"0 0 ".concat(520," ").concat(140),className:"w-full h-[140px] border border-lm-terminal-gray bg-lm-terminal-darkgray",children:[(0,r.jsx)("rect",{x:"0",y:"0",width:520,height:140,fill:"transparent"}),(0,r.jsx)("line",{x1:44,y1:i,x2:504,y2:i,stroke:"rgba(255,255,255,0.12)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:44,y1:16,x2:504,y2:16,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:44,y1:61,x2:504,y2:61,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:159,y1:16,x2:159,y2:i,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:274,y1:16,x2:274,y2:i,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:389,y1:16,x2:389,y2:i,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("rect",{x:44,y:16,width:460,height:90,fill:"rgba(0,0,0,0.15)"}),(0,r.jsx)("rect",{x:44,y:16,width:460,height:90,fill:o?"rgba(0,255,0,0.10)":"rgba(207,255,4,0.08)"}),(0,r.jsx)("path",{d:p,fill:"rgba(255,255,255,0.06)"}),(0,r.jsx)("path",{d:p.replace("Z",""),fill:"none",stroke:"rgba(255,255,255,0.28)",strokeWidth:"2"}),(0,r.jsx)("line",{x1:u,y1:16,x2:u,y2:i+2,stroke:"rgba(255,255,255,0.9)",strokeWidth:"2"}),(0,r.jsx)("text",{x:44,y:128,fill:"rgba(255,255,255,0.65)",fontSize:"11",className:"lm-mono",children:N(a)}),(0,r.jsx)("text",{x:u,y:128,fill:"rgba(255,255,255,0.95)",fontSize:"11",textAnchor:"middle",className:"lm-mono",children:N(l)}),(0,r.jsx)("text",{x:504,y:128,fill:"rgba(255,255,255,0.65)",fontSize:"11",textAnchor:"end",className:"lm-mono",children:N(n)}),(0,r.jsx)("text",{x:504,y:14,fill:"rgba(255,255,255,0.45)",fontSize:"10",textAnchor:"end",children:s})]})]})}function R(e){let t=Number(e);return isNaN(t)||0===t?"0":t>=1e6?"".concat((t/1e6).toFixed(2),"M"):t>=1e3?"".concat((t/1e3).toFixed(2),"K"):t>=1?t.toFixed(4):t>=1e-4?t.toFixed(6):t.toExponential(2)}function L(){let{address:e,walletClient:t,requireCorrectChain:a,connect:k}=(0,h.v)(),[L,F]=(0,n.useState)([]),[P,I]=(0,n.useState)(""),[T,A]=(0,n.useState)(""),[_,q]=(0,n.useState)(3e3),[$,B]=(0,n.useState)(""),[z,O]=(0,n.useState)(!1),[U,W]=(0,n.useState)(""),[V,H]=(0,n.useState)(""),[X,J]=(0,n.useState)(""),[D,Q]=(0,n.useState)(!0),[K,Y]=(0,n.useState)("amt0"),[Z,G]=(0,n.useState)(""),[ee,et]=(0,n.useState)(100),[ea,er]=(0,n.useState)("full"),[en,el]=(0,n.useState)(""),[es,ei]=(0,n.useState)(""),[eo,ec]=(0,n.useState)(""),[ed,em]=(0,n.useState)("info"),[ex,eu]=(0,n.useState)(!1),[eh,eg]=(0,n.useState)(""),[ep,ef]=(0,n.useState)(""),eb=(0,n.useMemo)(()=>L.find(e=>e.address===P),[L,P]),ey=(0,n.useMemo)(()=>L.find(e=>e.address===T),[L,T]),ev=(0,n.useMemo)(()=>p.find(e=>e.fee===_),[_]),eN=(0,n.useMemo)(()=>P&&T&&P.toLowerCase()!==T.toLowerCase()?{token0:P.toLowerCase()<T.toLowerCase()?P:T,token1:P.toLowerCase()<T.toLowerCase()?T:P}:null,[P,T]),ew=(0,n.useMemo)(()=>eN?L.find(e=>e.address===eN.token0):void 0,[eN,L]),ej=(0,n.useMemo)(()=>eN?L.find(e=>e.address===eN.token1):void 0,[eN,L]),ek=(0,n.useMemo)(()=>{try{var e,t;if(!eN||!ew||!ej)return"";let a=($||"").trim();if(!a||"0"===a)return"";let r=(0,s.X)(a,18);if(r<=0n)return"";let n=(e=ew.decimals,(t=ej.decimals)>e?r*w(t-e):e>t?r/w(e-t):r);if(n<=0n)return"";let l=2n**96n,i=l*l*n/10n**18n;if(i<=0n)return"";let o=function(e){if(e<0n)throw Error("sqrt of negative");if(e<2n)return e;let t=e,a=t+1n>>1n;for(;a<t;)t=a,a=a+e/a>>1n;return t}(i);if(o<=0n||o>b)return"";return o.toString()}catch(e){return""}},[$,ew,ej,eN]),eC=(0,n.useMemo)(()=>U.trim()?U.trim():ek,[ek,U]),[eE,eS]=(0,n.useState)(""),[eM,eR]=(0,n.useState)(null),[eL,eF]=(0,n.useState)(null),[eP,eI]=(0,n.useState)(""),eT=(0,n.useCallback)(async()=>{if(!m.$.uniFactory||!eN||!ev||!ew||!ej){eS(""),eR(null),eF(null),eI("");return}try{let e=await u.R.readContract({address:m.$.uniFactory,abi:x.HB,functionName:"getPool",args:[eN.token0,eN.token1,_]});if(!e||"0x0000000000000000000000000000000000000000"===e){eS(""),eR(null),eF(null),eI("");return}eS(e);let t=await u.R.readContract({address:e,abi:x.ld,functionName:"slot0"}),a=t[0],r=t[1];eF(a),eR(r);let n={num:a*a,den:2n**192n},l=BigInt(ew.decimals),s=BigInt(ej.decimals),i=n.num,o=n.den;l>s&&(i*=10n**(l-s)),s>l&&(o*=10n**(s-l)),eI(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;if(0n===t)return"0";let r=10n**BigInt(a),n=(e*r/t).toString().padStart(a+1,"0"),l=n.slice(0,-a),s=n.slice(-a);return"".concat(l,".").concat(s).replace(/\.?0+$/,e=>"")}(i,o,8))}catch(e){eS(""),eR(null),eF(null),eI("")}},[_,ev,ew,ej,eN]);(0,n.useEffect)(()=>{eT().catch(()=>{})},[eT]),(0,n.useEffect)(()=>{if(!e){eg(""),ef("");return}(async()=>{if(P&&eb)try{let t=await u.R.readContract({address:P,abi:x.bx,functionName:"balanceOf",args:[e]});eg((0,l.J)(t,eb.decimals))}catch(e){eg("?")}else eg("");if(T&&ey)try{let t=await u.R.readContract({address:T,abi:x.bx,functionName:"balanceOf",args:[e]});ef((0,l.J)(t,ey.decimals))}catch(e){ef("?")}else ef("")})()},[e,P,T,eb,ey]);let eA=(0,n.useMemo)(()=>{var e,t,a;if(!ev)return{ticks:null,error:""};if("full"===ea){return{ticks:{tickLower:Math.ceil(-887272/(a=ev.tickSpacing))*a,tickUpper:Math.floor(887272/a)*a},error:""}}if(!ew||!ej)return{ticks:null,error:"Select tokens first."};let r=(en||"").trim(),n=(es||"").trim();if(!r||!n)return{ticks:null,error:""};let l=Number(r),s=Number(n);if(!Number.isFinite(l)||!Number.isFinite(s))return{ticks:null,error:"Enter valid numbers for min/max price."};if(l<=0||s<=0)return{ticks:null,error:"Min/max price must be greater than 0."};if(l>=s)return{ticks:null,error:"Min price must be lower than max price."};let i=Math.pow(10,ej.decimals-ew.decimals);if(!Number.isFinite(i)||i<=0)return{ticks:null,error:"Price scaling overflow. Try a smaller range."};let o=l*i,c=s*i;if(!Number.isFinite(o)||!Number.isFinite(c)||o<=0||c<=0)return{ticks:null,error:"Price range is too large/small to compute ticks."};let d=Math.log(1.0001),m=Math.log(o)/d,x=Math.log(c)/d;if(!Number.isFinite(m)||!Number.isFinite(x))return{ticks:null,error:"Price range is out of tick bounds."};let u=Math.floor(x),h=y(Math.floor(Math.floor(m)/(e=ev.tickSpacing))*e,e),g=y(Math.ceil(u/(t=ev.tickSpacing))*t,t);return Number.isFinite(h)&&Number.isFinite(g)?h>=g?{ticks:null,error:"Range too narrow for this fee tier. Widen the range."}:{ticks:{tickLower:h,tickUpper:g},error:""}:{ticks:null,error:"Invalid tick calculation."}},[ev,es,en,ea,ew,ej]),e_=eA.ticks,eq=eA.error,e$=(0,n.useMemo)(()=>e_&&ew&&ej?{lower:v(e_.tickLower,ew.decimals,ej.decimals),upper:v(e_.tickUpper,ew.decimals,ej.decimals)}:null,[e_,ew,ej]),eB=(0,n.useMemo)(()=>{try{if(null!==eM&&ew&&ej){let e=v(eM,ew.decimals,ej.decimals);return Number.isFinite(e)&&e>0?e:null}let e=Number(($||"").trim());return Number.isFinite(e)&&e>0?e:null}catch(e){return null}},[eM,$,ew,ej]),ez=(0,n.useMemo)(()=>{if(eE&&eL)return eL;try{let e=BigInt((eC||"").trim()||"0");if(e<=0n||e>b)return null;return e}catch(e){return null}},[eL,eE,eC]),eO=(0,n.useMemo)(()=>{if(!e_||!eb||!ey||!ew||!ej||!ez)return null;try{let e,t,a=j(e_.tickLower),r=j(e_.tickUpper),n=(0,s.X)(V||"0",eb.decimals),l=(0,s.X)(X||"0",ey.decimals);if(0n===n&&0n===l)return{used0:0n,used1:0n,desired0:0n,desired1:0n,leftover0:0n,leftover1:0n,mode:"unknown",note:"Enter amounts to see preview."};if(!eN)return null;let i=eN.token0.toLowerCase()===P.toLowerCase()?n:l,o=eN.token0.toLowerCase()===P.toLowerCase()?l:n,c=a<r?a:r,d=a>r?a:r;if(ez<=c)t="below",e=C(a,r,i);else if(ez>=d)t="above",e=E(a,r,o);else{t="in";let n=C(ez,r,i),l=E(a,ez,o);e=n<l?n:l}let{amount0:m,amount1:x}=S(ez,a,r,e),u=i>m?i-m:0n,h=o>x?o-x:0n;return{used0:m,used1:x,desired0:i,desired1:o,leftover0:u,leftover1:h,mode:t,note:""}}catch(e){return{used0:0n,used1:0n,desired0:0n,desired1:0n,leftover0:0n,leftover1:0n,mode:"unknown",note:String((null==e?void 0:e.message)||e)}}},[V,X,ez,e_,ew,ej,eN,eb,ey,P]);(0,n.useEffect)(()=>{let e,t;if(!D||!eN||!eb||!ey||!e_||!ez)return;let a="amt0"===K?(V||"").trim():(X||"").trim(),r="amt0"===K?(X||"").trim():(V||"").trim(),n="amt0"===K?P:T,i="amt0"===K?T:P,o="amt0"===K?eb:ey,c="amt0"===K?ey:eb;if(!n||!i)return;if(!a){Z&&G(""),r&&("amt0"===K?J(""):H(""));return}try{e=(0,s.X)(a,o.decimals)}catch(e){return}let d=j(e_.tickLower),m=j(e_.tickUpper),x=eN.token0.toLowerCase()===n.toLowerCase(),u=eN.token1.toLowerCase()===n.toLowerCase();if(!x&&!u)return;let h=d<m?d:m,g=d>m?d:m,p=ez<=h?"token0":ez>=g?"token1":"";if("token0"===p&&u){Z||G("Current price is below range: deposit uses token0 only. Enter token0 amount.");return}if("token1"===p&&x){Z||G("Current price is above range: deposit uses token1 only. Enter token1 amount.");return}Z&&G(""),t=x?ez<=h?C(d,m,e):C(ez,m,e):ez>=g?E(d,m,e):E(d,ez,e);let f=S(ez,d,m,t),b=function(e,t){let a=(0,l.J)(e,t);return a.includes(".")?a.replace(/(\.\d*?[1-9])0+$/,"$1").replace(/\.0+$/,""):a}(eN.token0.toLowerCase()===i.toLowerCase()?f.amount0:f.amount1,c.decimals);"amt0"===K?b!==(X||"")&&J(b):b!==(V||"")&&H(b)},[D,K,V,X,eN,eb,ey,e_,ez]),(0,n.useEffect)(()=>{(0,d.V)().then(e=>{F(e),!P&&e[0]&&I(e[0].address),!T&&e[1]&&A(e[1].address)}).catch(e=>{ec(String((null==e?void 0:e.message)||e)),em("error")})},[]);let eU=(0,n.useRef)(L);async function eW(e,a,r,n){var l;if(await u.R.readContract({address:r,abi:x.bx,functionName:"allowance",args:[e,a]})>=n)return;if(ec("Approving ".concat((null==(l=L.find(e=>e.address===r))?void 0:l.symbol)||"token","...")),em("info"),!t)throw Error("No wallet client");let s=await t.writeContract({address:r,abi:x.bx,functionName:"approve",args:[a,n],chain:u.A,account:e});await u.R.waitForTransactionReceipt({hash:s})}async function eV(){if(!e){ec("Connect wallet."),em("error");return}if(!m.$.positionManager||!eN)return;let r=(null==eb?void 0:eb.symbol)||"Token0",n=(null==ey?void 0:ey.symbol)||"Token1";eu(!0);try{let l;await a();try{l=BigInt((eC||"").trim()||"0")}catch(e){throw Error("Initial price is invalid. Enter a valid number.")}if(l<=0n)throw Error("Set an initial price first (enter a price in the field above).");if(l>b)throw Error("Initial price is out of range. Try a smaller price.");if(!t)throw Error("No wallet client");ec("Creating ".concat(r,"/").concat(n," pool (").concat(null==ev?void 0:ev.label," fee)...")),em("info");let s=await t.writeContract({address:m.$.positionManager,abi:x.g4,functionName:"createAndInitializePoolIfNecessary",args:[eN.token0,eN.token1,_,l],value:0n,chain:u.A,account:e});ec("Confirming pool creation on-chain...");let i=await u.R.waitForTransactionReceipt({hash:s});"success"===i.status?(ec("Pool created! ".concat(r,"/").concat(n," (").concat(null==ev?void 0:ev.label,") is now live.")),em("success")):(ec("Pool creation reverted. The pool may already exist for this pair + fee tier."),em("error"))}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?ec("Transaction cancelled."):ec("Create pool failed: ".concat(e)),em("error")}finally{eu(!1)}}async function eH(){if(!e){ec("Connect wallet."),em("error");return}if(m.$.positionManager&&P&&T&&eb&&ey&&ev&&eN){if(!e_){ec("Invalid price range."),em("error");return}eu(!0);try{let r;await a();let n=(0,s.X)(V||"0",eb.decimals),l=(0,s.X)(X||"0",ey.decimals);if(0n===n&&0n===l)throw Error("Enter amount for at least one token");if(!t)throw Error("No wallet client");let{tickLower:o,tickUpper:c}=e_,d=eN.token0.toLowerCase()===P.toLowerCase()?n:l,h=eN.token0.toLowerCase()===P.toLowerCase()?l:n;if(!ez){if(!eE)throw Error("No pool found. Set an initial price and create the pool first.");throw Error("Loading pool price. Try again in a moment.")}let g=j(o),p=j(c);if(ez<=(g<p?g:p))r=C(g,p,d);else if(ez>=(g>p?g:p))r=E(g,p,h);else{let e=C(ez,p,d),t=E(g,ez,h);r=e<t?e:t}let f=S(ez,g,p,r);await eW(e,m.$.positionManager,P,n),await eW(e,m.$.positionManager,T,l);let y=BigInt(Math.max(0,Math.min(3e3,ee))),v=f.amount0*(10000n-y)/10000n,N=f.amount1*(10000n-y)/10000n,w=BigInt(Math.floor(Date.now()/1e3)+600);if(eE){ec("Minting LP: ".concat(V||"0"," ").concat(eb.symbol," + ").concat(X||"0"," ").concat(ey.symbol,"...")),em("info");let a=await t.writeContract({address:m.$.positionManager,abi:x.g4,functionName:"mint",args:[{token0:eN.token0,token1:eN.token1,fee:_,tickLower:o,tickUpper:c,amount0Desired:d,amount1Desired:h,amount0Min:v,amount1Min:N,recipient:e,deadline:w}],value:0n,chain:u.A,account:e});ec("Confirming on-chain...");let r=await u.R.waitForTransactionReceipt({hash:a});"success"===r.status?(ec("LP position minted! ".concat(eb.symbol,"/").concat(ey.symbol," liquidity added. Check the Positions tab.")),em("success")):(ec("Mint transaction reverted. Check your balances and price range."),em("error"))}else{let a;try{a=BigInt((eC||"").trim()||"0")}catch(e){throw Error("Set an initial price to create the pool first.")}if(a<=0n||a>b)throw Error("Initial price is invalid (sqrtPriceX96 out of range).");ec("Creating pool + minting LP..."),em("info");let r=(0,i.p)({abi:x.g4,functionName:"createAndInitializePoolIfNecessary",args:[eN.token0,eN.token1,_,a]}),n=(0,i.p)({abi:x.g4,functionName:"mint",args:[{token0:eN.token0,token1:eN.token1,fee:_,tickLower:o,tickUpper:c,amount0Desired:d,amount1Desired:h,amount0Min:v,amount1Min:N,recipient:e,deadline:w}]}),l=await t.writeContract({address:m.$.positionManager,abi:x.g4,functionName:"multicall",args:[[r,n]],value:0n,chain:u.A,account:e});ec("Confirming on-chain...");let s=await u.R.waitForTransactionReceipt({hash:l});"success"===s.status?(ec("Pool created and LP position minted! Check the Positions tab."),em("success"),await eT()):(ec("Transaction reverted. Check your balances, range, and initial price."),em("error"))}}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?ec("Transaction cancelled."):ec("Add liquidity failed: ".concat(e)),em("error")}finally{eu(!1)}}}eU.current=L,(0,g.SL)((0,n.useCallback)(e=>{if("add_liquidity"!==e.type&&"create_pool"!==e.type)return;let t=eU.current,a=e=>{if(!e)return"";let a=e.toUpperCase(),r=t.find(e=>e.symbol.toUpperCase()===a);return(null==r?void 0:r.address)||""},r=a(e.token0),n=a(e.token1);r&&I(r),n&&A(n),e.fee&&q(Number(e.fee)),"create_pool"===e.type&&e.price&&B(e.price),"add_liquidity"===e.type&&("full"===e.range?er("full"):"custom"===e.range&&(er("custom"),e.minPrice&&el(e.minPrice),e.maxPrice&&ei(e.maxPrice)),e.amount0&&H(e.amount0),e.amount1&&J(e.amount1))},[]));let eX=P&&T&&P.toLowerCase()===T.toLowerCase();return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 space-y-3",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Select Token Pair"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:"Token A"}),(0,r.jsxs)("select",{className:"w-full bg-lm-black border border-lm-terminal-gray hover:border-lm-orange p-2 text-sm h-9 text-white font-bold transition-colors disabled:opacity-40",value:P,onChange:e=>I(e.target.value),disabled:ex,children:[0===L.length&&(0,r.jsx)("option",{value:"",disabled:!0,children:"Loading tokens..."}),L.map(e=>(0,r.jsx)("option",{value:e.address,children:e.symbol},e.address))]}),eh&&(0,r.jsxs)("div",{className:"text-[10px] text-lm-terminal-lightgray lm-mono",children:["Balance: ",(0,r.jsx)("span",{className:"text-white",children:R(eh)})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:"Token B"}),(0,r.jsxs)("select",{className:"w-full bg-lm-black border border-lm-terminal-gray hover:border-lm-orange p-2 text-sm h-9 text-white font-bold transition-colors disabled:opacity-40",value:T,onChange:e=>A(e.target.value),disabled:ex,children:[0===L.length&&(0,r.jsx)("option",{value:"",disabled:!0,children:"Loading tokens..."}),L.map(e=>(0,r.jsx)("option",{value:e.address,children:e.symbol},e.address))]}),ep&&(0,r.jsxs)("div",{className:"text-[10px] text-lm-terminal-lightgray lm-mono",children:["Balance: ",(0,r.jsx)("span",{className:"text-white",children:R(ep)})]})]})]}),eX&&(0,r.jsx)("div",{className:"text-lm-red text-xs",children:"Tokens must be different."}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Trading Fee"}),(0,r.jsx)("div",{className:"flex gap-1",children:p.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>q(e.fee),className:"flex-1 py-2 border transition-colors text-center ".concat(_===e.fee?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{className:"text-xs font-bold",children:e.label}),(0,r.jsx)("div",{className:"text-[9px] opacity-60",children:e.hint})]},e.fee))})]}),eN&&(0,r.jsxs)("div",{className:"text-xs bg-lm-black border p-3 space-y-1 ".concat(eE?"border-lm-green/20":"border-lm-red/20"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"lm-dot ".concat(eE?"lm-dot-green lm-dot-pulse":"lm-dot-red")}),(0,r.jsx)("span",{className:eE?"text-lm-green font-bold":"text-lm-red",children:eE?"Pool Active":"No Pool Found"})]}),eE&&(0,r.jsxs)("a",{href:"".concat(m.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/address/").concat(eE),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono text-[10px]",children:[eE.slice(0,6)+"..."+eE.slice(-4)," →"]})]}),eP&&ew&&ej&&(0,r.jsxs)("div",{className:"text-[10px] lm-mono flex items-center gap-1.5 pt-0.5",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Current Price:"}),(0,r.jsx)("span",{className:"text-white font-bold",children:eP}),(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray",children:[ej.symbol,"/",ew.symbol]})]})]})]}),eN&&!eE&&(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 space-y-3",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Initialize New Pool"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"This pair has no pool yet. Set an initial price to create one."}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-xs",children:["Initial Price (",(null==ej?void 0:ej.symbol)||"B"," per ",(null==ew?void 0:ew.symbol)||"A",")"]}),(0,r.jsx)(c.p,{value:$,onValueChange:B,placeholder:"e.g. 0.001"}),($||"").trim()&&!eC?(0,r.jsx)("div",{className:"text-lm-red text-[10px]",children:"Invalid initial price. Enter a positive number."}):null]}),(0,r.jsx)("button",{type:"button",onClick:()=>O(!z),className:"text-lm-terminal-lightgray text-[10px] hover:text-lm-orange transition-colors",children:z?"▾ Hide developer settings":"▸ Developer settings"}),z&&(0,r.jsxs)("div",{className:"space-y-1 text-[10px]",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray",children:["sqrtPriceX96 (auto: ",(0,r.jsx)("span",{className:"lm-mono text-lm-gray",children:ek||"—"}),")"]}),(0,r.jsx)(c.p,{value:U,onValueChange:W,placeholder:"Leave blank for auto",className:"text-left text-xs",numeric:!1})]}),(0,r.jsx)(o.$,{onClick:e?eV:k,loading:ex,disabled:ex||!!e&&!eC,variant:"primary",size:"lg",className:"w-full",children:ex?"Creating Pool...":e?"Create Pool":"Connect Wallet"})]}),(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 space-y-3",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Add Liquidity"}),eE?null:(0,r.jsx)("div",{className:"text-[10px] text-lm-terminal-lightgray",children:"No pool found for this pair + fee. Set an initial price above and we'll create + initialize + mint in one transaction."}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:"Price Range"}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>er("full"),className:"flex-1 text-xs py-2 border transition-colors ".concat("full"===ea?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{className:"font-bold",children:"Full Range"}),(0,r.jsx)("div",{className:"text-[9px] opacity-60",children:"Earn fees at any price"})]}),(0,r.jsxs)("button",{type:"button",onClick:()=>er("custom"),className:"flex-1 text-xs py-2 border transition-colors ".concat("custom"===ea?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{className:"font-bold",children:"Custom Range"}),(0,r.jsx)("div",{className:"text-[9px] opacity-60",children:"Concentrated liquidity"})]})]})]}),"custom"===ea&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-xs",children:["Min Price (",(null==ej?void 0:ej.symbol)||"B","/",(null==ew?void 0:ew.symbol)||"A",")"]}),(0,r.jsx)(c.p,{value:en,onValueChange:el,placeholder:"0.0005"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-xs",children:["Max Price (",(null==ej?void 0:ej.symbol)||"B","/",(null==ew?void 0:ew.symbol)||"A",")"]}),(0,r.jsx)(c.p,{value:es,onValueChange:ei,placeholder:"0.0020"})]})]}),eq?(0,r.jsx)("div",{className:"text-lm-red text-[10px]",children:eq}):null]}),e$&&ew&&ej&&(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-2 flex items-center justify-between text-[10px]",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Low: "}),(0,r.jsx)("span",{className:"text-white lm-mono font-bold",children:"full"===ea?"0":N(e$.lower)})]}),(0,r.jsx)("span",{className:"text-lm-terminal-gray",children:"←→"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"High: "}),(0,r.jsx)("span",{className:"text-white lm-mono font-bold",children:"full"===ea?"∞":N(e$.upper)})]}),(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray",children:[ej.symbol,"/",ew.symbol]})]}),ew&&ej?(0,r.jsx)(M,{mode:ea,lower:"custom"===ea&&e$?e$.lower:null,upper:"custom"===ea&&e$?e$.upper:null,current:eB,quoteLabel:"".concat(ej.symbol,"/").concat(ew.symbol)}):null,(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:(null==eb?void 0:eb.symbol)||"Token A"}),eh&&Number(eh)>0&&(0,r.jsx)("button",{type:"button",onClick:()=>{Y("amt0"),H(eh)},className:"text-[10px] text-lm-orange hover:underline",children:"MAX"})]}),(0,r.jsx)(c.p,{value:V,onValueChange:e=>{Y("amt0"),H(e)},placeholder:"0.0"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:(null==ey?void 0:ey.symbol)||"Token B"}),ep&&Number(ep)>0&&(0,r.jsx)("button",{type:"button",onClick:()=>{Y("amt1"),J(ep)},className:"text-[10px] text-lm-orange hover:underline",children:"MAX"})]}),(0,r.jsx)(c.p,{value:X,onValueChange:e=>{Y("amt1"),J(e)},placeholder:"0.0"})]})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-[10px] text-lm-terminal-lightgray select-none",children:[(0,r.jsx)("input",{type:"checkbox",checked:D,onChange:e=>Q(e.target.checked),className:"accent-lm-orange"}),"Auto-adjust the other token to match the selected range"]}),D&&Z?(0,r.jsx)("div",{className:"text-[10px] text-lm-orange",children:Z}):null,(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Slippage Tolerance"}),(0,r.jsx)("div",{className:"flex gap-1",children:f.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>et(e.bps),className:"flex-1 text-xs py-1.5 border transition-colors ".concat(ee===e.bps?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.bps))})]}),eO&&(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-2.5 space-y-1.5 text-[10px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper font-bold tracking-wider",children:"Deposit Preview"}),"in"===eO.mode?(0,r.jsx)("span",{className:"lm-badge lm-badge-green",children:"In Range"}):"below"===eO.mode||"above"===eO.mode?(0,r.jsx)("span",{className:"lm-badge lm-badge-orange",children:"Single-Sided"}):null]}),eO.note?(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:eO.note}):(0,r.jsxs)("div",{className:"space-y-1",children:["below"===eO.mode&&ew&&ej?(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray",children:["Current price is below your range. This deposit uses ",ew.symbol," only."]}):null,"above"===eO.mode&&ew&&ej?(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray",children:["Current price is above your range. This deposit uses ",ej.symbol," only."]}):null,(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:null==ew?void 0:ew.symbol}),(0,r.jsxs)("span",{className:"text-white lm-mono font-bold",children:["Used ",ew?R((0,l.J)(eO.used0,ew.decimals)):"0",ew?" \xb7 Leftover ".concat(R((0,l.J)(eO.leftover0,ew.decimals))):""]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:null==ej?void 0:ej.symbol}),(0,r.jsxs)("span",{className:"text-white lm-mono font-bold",children:["Used ",ej?R((0,l.J)(eO.used1,ej.decimals)):"0",ej?" \xb7 Leftover ".concat(R((0,l.J)(eO.leftover1,ej.decimals))):""]})]})]})]}),(0,r.jsx)(o.$,{onClick:e?eH:k,loading:ex,disabled:ex||!!e&&(!e_||!eE&&!ez),variant:"primary",size:"lg",className:"w-full",children:ex?"Processing...":e?eE?"Add Liquidity":"Create + Add Liquidity":"Connect Wallet"})]}),eo&&(0,r.jsxs)("div",{className:"text-xs p-2.5 border bg-lm-black flex items-center gap-2 ".concat("success"===ed?"text-lm-green":"error"===ed?"text-lm-red":"text-lm-gray"," ").concat("success"===ed?"border-lm-green/20":"error"===ed?"border-lm-red/20":"border-lm-terminal-gray"),children:["info"===ed&&(0,r.jsx)("span",{className:"lm-spinner flex-shrink-0",style:{width:12,height:12,borderWidth:1.5}}),"success"===ed&&(0,r.jsx)("span",{className:"lm-dot lm-dot-green flex-shrink-0"}),"error"===ed&&(0,r.jsx)("span",{className:"lm-dot lm-dot-red flex-shrink-0"}),(0,r.jsx)("span",{children:eo})]})]})}},739:(e,t,a)=>{Promise.resolve().then(a.bind(a,330)),Promise.resolve().then(a.bind(a,5110)),Promise.resolve().then(a.bind(a,4383))},4383:(e,t,a)=>{"use strict";a.d(t,{ExchangeBootstrap:()=>y});var r=a(5155),n=a(2115),l=a(598),s=a(6594),i=a(8070),o=a(6630),c=a(9719),d=a(8839),m=a(2933),x=a(3376),u=a(8604);let h=2n**128n-1n;function g(e,t,a){return Math.pow(1.0001,e)*Math.pow(10,t-a)}function p(e){return 0!==e&&Number.isFinite(e)?e>=1e9?"".concat((e/1e9).toFixed(2),"B"):e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e>=1?e.toFixed(4):e>=1e-4?e.toFixed(6):e>=1e-7?e.toFixed(10):e.toExponential(2):"—"}function f(e){let t=Number(e);return isNaN(t)||0===t?"0":t>=1e6?"".concat((t/1e6).toFixed(2),"M"):t>=1e3?"".concat((t/1e3).toFixed(2),"K"):t>=1?t.toFixed(4):t>=1e-4?t.toFixed(6):t.toExponential(2)}function b(){let{address:e,walletClient:t}=(0,c.v)(),[a,s]=(0,n.useState)([]),[i,u]=(0,n.useState)(""),[b,y]=(0,n.useState)(!1),[v,N]=(0,n.useState)({}),[w,j]=(0,n.useState)({}),[k,C]=(0,n.useState)(null),E=m.$.positionManager;async function S(){if(!e||!E)return void s([]);y(!0),u("Loading positions...");try{let a=await d.R.readContract({address:E,abi:x.g4,functionName:"balanceOf",args:[e]}),r=a>50n?50:Number(a),n=[],l={};async function t(e){let t=e.toLowerCase();if(l[t])return l[t];let a=e.slice(0,6),r=18;try{a=await d.R.readContract({address:e,abi:x.Qi,functionName:"symbol"})}catch(e){}try{r=Number(await d.R.readContract({address:e,abi:x.Qi,functionName:"decimals"}))}catch(e){}return l[t]={sym:a,dec:r},l[t]}let i={};for(let a=0;a<r;a++){let r=await d.R.readContract({address:E,abi:x.g4,functionName:"tokenOfOwnerByIndex",args:[e,BigInt(a)]}),l=await d.R.readContract({address:E,abi:x.g4,functionName:"positions",args:[r]}),s=l.token0,o=l.token1,c=await t(s),u=await t(o),h=Number(l.fee),p=g(Number(l.tickLower),c.dec,u.dec),f=g(Number(l.tickUpper),c.dec,u.dec),b=0,y="".concat(s.toLowerCase(),"-").concat(o.toLowerCase(),"-").concat(h);if(void 0!==i[y])b=i[y];else if(m.$.uniFactory){try{let e=await d.R.readContract({address:m.$.uniFactory,abi:x.HB,functionName:"getPool",args:[s,o,h]});if(e&&"0x0000000000000000000000000000000000000000"!==e){let t=await d.R.readContract({address:e,abi:x.ld,functionName:"slot0"});b=g(t[1],c.dec,u.dec)}}catch(e){}i[y]=b}let v=b>=p&&b<=f;n.push({tokenId:r,token0:s,token1:o,fee:h,tickLower:Number(l.tickLower),tickUpper:Number(l.tickUpper),liquidity:l.liquidity,sym0:c.sym,sym1:u.sym,dec0:c.dec,dec1:u.dec,tokensOwed0:l.tokensOwed0,tokensOwed1:l.tokensOwed1,priceLower:p,priceUpper:f,currentPrice:b,inRange:v})}s(n),u("")}catch(e){u(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e))}finally{y(!1)}}async function M(a){if(!e||!t||!E)return;y(!0);let r=a.tokenId.toString();N(e=>({...e,[r]:"Collecting fees..."})),j(e=>({...e,[r]:"info"}));try{let n=await t.writeContract({address:E,abi:x.g4,functionName:"collect",args:[{tokenId:a.tokenId,recipient:e,amount0Max:h,amount1Max:h}],chain:t.chain,account:e});N(e=>({...e,[r]:"Confirming..."}));let l=await d.R.waitForTransactionReceipt({hash:n});"success"===l.status?(N(e=>({...e,[r]:"Fees collected!"})),j(e=>({...e,[r]:"success"}))):(N(e=>({...e,[r]:"Tx failed"})),j(e=>({...e,[r]:"error"}))),await S()}catch(e){N(t=>({...t,[r]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),j(e=>({...e,[r]:"error"}))}finally{y(!1)}}async function R(a){if(!e||!t||!E||a.liquidity<=0n)return;y(!0);let r=a.tokenId.toString();N(e=>({...e,[r]:"Removing liquidity..."})),j(e=>({...e,[r]:"info"}));try{let n=BigInt(Math.floor(Date.now()/1e3)+600),l=await t.writeContract({address:E,abi:x.g4,functionName:"decreaseLiquidity",args:[{tokenId:a.tokenId,liquidity:a.liquidity,amount0Min:0n,amount1Min:0n,deadline:n}],chain:t.chain,account:e});N(e=>({...e,[r]:"Removing... collecting tokens"})),await d.R.waitForTransactionReceipt({hash:l});let s=await t.writeContract({address:E,abi:x.g4,functionName:"collect",args:[{tokenId:a.tokenId,recipient:e,amount0Max:h,amount1Max:h}],chain:t.chain,account:e});await d.R.waitForTransactionReceipt({hash:s}),N(e=>({...e,[r]:"Liquidity removed!"})),j(e=>({...e,[r]:"success"})),await S()}catch(e){N(t=>({...t,[r]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),j(e=>({...e,[r]:"error"}))}finally{y(!1)}}if((0,n.useEffect)(()=>{S().catch(()=>{})},[e]),!e)return(0,r.jsxs)("div",{className:"text-lm-gray text-sm p-6 text-center",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-lg mb-1",children:"No Wallet Connected"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:"Connect your wallet to view and manage LP positions."})]});let L=a.filter(e=>e.liquidity>0n),F=a.filter(e=>e.liquidity<=0n);return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:a.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:[L.length," Active"]}),F.length>0&&(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-upper tracking-wider opacity-50",children:[F.length," Closed"]})]})}),(0,r.jsx)(o.$,{onClick:S,disabled:b,className:"text-lm-orange text-xs border border-lm-terminal-gray hover:border-lm-orange px-3 py-1 transition-colors",children:b?"Loading...":"Refresh"})]}),0===a.length?(0,r.jsxs)("div",{className:"text-center py-8 space-y-2",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:b?"Loading...":"No Positions"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:i||"Create an LP position in the Pools tab to start earning fees."})]}):(0,r.jsx)("div",{className:"space-y-2",children:a.map(e=>{let t=e.tokenId.toString(),a=e.liquidity>0n,n=e.tokensOwed0>0n||e.tokensOwed1>0n,s=v[t],i=w[t]||"info",c=k===t,d="".concat((e.fee/1e4).toFixed(e.fee<1e3?2:+(e.fee<1e4)),"%");return(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border transition-all lm-card-hover ".concat(a&&e.inRange?"border-lm-green/30 lm-in-range":a?"border-lm-orange/30 lm-out-of-range":"border-lm-terminal-gray"),children:[(0,r.jsxs)("button",{type:"button",onClick:()=>C(c?null:t),className:"w-full p-3 flex items-center justify-between text-left hover:bg-lm-black/20",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,r.jsx)("span",{className:"lm-dot ".concat(a?e.inRange?"lm-dot-green lm-dot-pulse":"lm-dot-red":"lm-dot-gray")}),(0,r.jsxs)("span",{className:"text-white font-bold text-sm",children:[e.sym0,"/",e.sym1]}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray text-[10px] bg-lm-black px-1.5 py-0.5 border border-lm-terminal-gray lm-mono",children:d}),(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono opacity-50",children:["#",e.tokenId.toString()]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[a?(0,r.jsx)("span",{className:"lm-badge font-bold ".concat(e.inRange?"lm-badge-filled-green":"lm-badge-filled-red"),children:e.inRange?"IN RANGE":"OUT OF RANGE"}):(0,r.jsx)("span",{className:"lm-badge lm-badge-gray",children:"CLOSED"}),n&&(0,r.jsx)("span",{className:"lm-badge lm-badge-filled-green",children:"FEES"}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-3 h-3 text-lm-terminal-lightgray transition-transform ".concat(c?"rotate-180":""),children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.22 6.22a.75.75 0 011.06 0L8 8.94l2.72-2.72a.75.75 0 111.06 1.06l-3.25 3.25a.75.75 0 01-1.06 0L4.22 7.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})]})]}),(0,r.jsxs)("div",{className:"px-3 pb-2 flex items-center gap-4 text-[10px] flex-wrap",children:[e.currentPrice>0&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Price:"}),(0,r.jsx)("span",{className:"text-white lm-mono font-bold",children:p(e.currentPrice)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Range:"}),(0,r.jsx)("span",{className:"text-white lm-mono",children:p(e.priceLower)}),(0,r.jsx)("span",{className:"text-lm-terminal-gray",children:"—"}),(0,r.jsx)("span",{className:"text-white lm-mono",children:p(e.priceUpper)})]})]}),a&&e.currentPrice>0&&(0,r.jsx)("div",{className:"px-3 pb-2",children:(0,r.jsxs)("div",{className:"relative h-1.5 bg-lm-black rounded-full overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-lm-orange/20 rounded-full",style:{left:"10%",right:"10%"}}),(()=>{let t=Math.min(e.priceLower,.5*e.currentPrice),a=Math.max(e.priceUpper,2*e.currentPrice)-t;if(a<=0)return null;let n=(e.priceLower-t)/a*100,l=(e.priceUpper-t)/a*100,s=(e.currentPrice-t)/a*100;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"absolute top-0 h-full ".concat(e.inRange?"bg-lm-green/40":"bg-lm-orange/40"),style:{left:"".concat(n,"%"),width:"".concat(l-n,"%")}}),(0,r.jsx)("div",{className:"absolute top-0 w-1 h-full bg-white rounded-full",style:{left:"".concat(s,"%"),transform:"translateX(-50%)"}})]})})()]})}),c&&(0,r.jsxs)("div",{className:"px-3 pb-3 space-y-2 border-t border-lm-terminal-gray",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 pt-2 text-[10px]",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:["Price Range (",e.sym1,"/",e.sym0,")"]}),(0,r.jsxs)("div",{className:"text-white lm-mono text-xs mt-0.5",children:[p(e.priceLower)," — ",p(e.priceUpper)]})]}),e.currentPrice>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Current Price"}),(0,r.jsxs)("div",{className:"text-white lm-mono text-xs mt-0.5",children:[p(e.currentPrice)," ",e.sym1,"/",e.sym0]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Fee Tier"}),(0,r.jsx)("div",{className:"text-white text-xs mt-0.5",children:d})]})]}),n&&(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-green/20 p-2 text-xs space-y-0.5",children:[(0,r.jsx)("div",{className:"text-lm-green text-[10px] font-bold lm-upper tracking-wider",children:"Uncollected Fees"}),(0,r.jsxs)("div",{className:"flex gap-4 text-white lm-mono",children:[e.tokensOwed0>0n&&(0,r.jsxs)("span",{children:[f((0,l.J)(e.tokensOwed0,e.dec0))," ",e.sym0]}),e.tokensOwed1>0n&&(0,r.jsxs)("span",{children:[f((0,l.J)(e.tokensOwed1,e.dec1))," ",e.sym1]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap pt-1",children:[(0,r.jsx)(o.$,{size:"sm",className:"bg-lm-green/10 text-lm-green border-lm-green/30 hover:bg-lm-green/20 hover:border-lm-green",onClick:()=>M(e),disabled:b,children:"Collect Fees"}),a&&(0,r.jsx)(o.$,{size:"sm",variant:"danger",onClick:()=>R(e),disabled:b,children:"Remove All Liquidity"}),s&&(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:["info"===i&&(0,r.jsx)("span",{className:"lm-spinner",style:{width:10,height:10,borderWidth:1}}),"success"===i&&(0,r.jsx)("span",{className:"lm-dot lm-dot-green"}),"error"===i&&(0,r.jsx)("span",{className:"lm-dot lm-dot-red"}),(0,r.jsx)("span",{className:"text-[10px] ".concat("success"===i?"text-lm-green":"error"===i?"text-lm-red":"text-lm-gray"),children:s})]})]})]})]},t)})}),i&&a.length>0&&(0,r.jsxs)("div",{className:"text-xs p-2.5 border border-lm-red/20 bg-lm-black flex items-center gap-2 text-lm-red",children:[(0,r.jsx)("span",{className:"lm-dot lm-dot-red flex-shrink-0"}),(0,r.jsx)("span",{children:i})]})]})}function y(e){let{SwapPanel:t,PoolsPanel:a}=e,l=(0,n.useMemo)(()=>[{id:"swap",label:"Swap",hint:"Quote + swap any token pair"},{id:"pools",label:"Pools",hint:"Create pools + add liquidity"},{id:"positions",label:"Positions",hint:"Manage your LP positions"}],[]),[o,c]=(0,n.useState)("swap"),d=(0,n.useCallback)(e=>{["swap","flip_tokens","max_balance","set_fee","set_slippage"].includes(e.type)?c("swap"):["add_liquidity","create_pool"].includes(e.type)?c("pools"):["collect_fees","remove_liquidity","refresh_positions"].includes(e.type)?c("positions"):"switch_tab"===e.type&&["swap","pools","positions"].includes(e.tab)&&c(e.tab)},[]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(u.jc,{context:"exchange",onIntent:d,placeholder:"swap 10 ETH for TSLA \xb7 add liquidity \xb7 create pool \xb7 collect fees \xb7 help"}),(0,r.jsxs)(s.Z,{title:"Exchange",hint:"Swap any token pair. Native ETH supported. Create and manage LP positions.",right:(0,r.jsx)(i.Z,{tabs:l,active:o,onChange:c}),children:["swap"===o?(0,r.jsx)(t,{}):null,"pools"===o?(0,r.jsx)(a,{}):null,"positions"===o?(0,r.jsx)(b,{}):null]})]})}},5110:(e,t,a)=>{"use strict";a.d(t,{SwapPanel:()=>w});var r=a(5155),n=a(2115),l=a(598),s=a(5028),i=a(931),o=a(6630),c=a(8590),d=a(7280),m=a(8839),x=a(2933),u=a(3376),h=a(9719),g=a(8604);let p=[{label:"0.05%",fee:500,hint:"Stables"},{label:"0.30%",fee:3e3,hint:"Standard"},{label:"1.00%",fee:1e4,hint:"Volatile"}],f=[{label:"0.5%",bps:50},{label:"1%",bps:100},{label:"3%",bps:300}],b={address:"0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",symbol:"ETH",decimals:18,logoURI:""};function y(e){return e.toLowerCase()===b.address.toLowerCase()}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,a=Number(e);return isNaN(a)||0===a?"0":a>=1e6?"".concat((a/1e6).toFixed(2),"M"):a>=1e3?"".concat((a/1e3).toFixed(2),"K"):a>=1?a.toFixed(Math.min(4,t)):a>=1e-4?a.toFixed(t):a.toExponential(2)}function N(e){var t;let{tokens:a,value:l,onChange:s,customAddr:i,onCustomAddr:o,customMeta:d,label:m,balance:x,symbol:u,onMax:h,amount:g,onAmountChange:p,amountReadonly:f,quoteDisplay:y,isNativeEth:N}=e,w="__custom__"===l,[j,k]=(0,n.useState)(!1),C=(0,n.useRef)(null);(0,n.useEffect)(()=>{function e(e){C.current&&!C.current.contains(e.target)&&k(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let E=[{addr:b.address,symbol:"ETH",hint:"Native",isEth:!0},...a.map(e=>({addr:e.address,symbol:e.symbol,hint:e.address.slice(0,6)+"...",isEth:!1})),{addr:"__custom__",symbol:"Custom",hint:"Paste address",isEth:!1}],S=w?(null==d?void 0:d.symbol)||"Custom":u||(null==(t=E.find(e=>e.addr===l))?void 0:t.symbol)||"Select";return(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:m}),void 0!==x&&(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-mono flex items-center gap-1",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-2.5 h-2.5 opacity-60",children:(0,r.jsx)("path",{d:"M8 1a7 7 0 100 14A7 7 0 008 1zm-.5 3h1v1h-1V4zm-1 2h3v1h-1v3h1v1h-3V10h1V7h-1V6z"})}),(0,r.jsx)("span",{className:"text-white",children:v(x)})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-shrink-0",ref:C,children:[(0,r.jsxs)("button",{type:"button",onClick:()=>k(!j),className:"flex items-center gap-1.5 h-10 px-3 bg-lm-black border border-lm-terminal-gray hover:border-lm-orange transition-colors min-w-[100px]",children:[(0,r.jsx)("span",{className:"text-white font-bold text-sm",children:S}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-3 h-3 text-lm-terminal-lightgray",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.22 6.22a.75.75 0 011.06 0L8 8.94l2.72-2.72a.75.75 0 111.06 1.06l-3.25 3.25a.75.75 0 01-1.06 0L4.22 7.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})]}),j&&(0,r.jsx)("div",{className:"absolute top-full left-0 mt-1 z-50 bg-lm-black border border-lm-orange w-56 max-h-60 overflow-y-auto shadow-lg",children:E.map(e=>{let t=l===e.addr;return(0,r.jsxs)("button",{type:"button",onClick:()=>{s(e.addr),k(!1)},className:"w-full text-left px-3 py-2 flex items-center justify-between transition-colors ".concat(t?"bg-lm-orange/10 text-lm-orange":"text-white hover:bg-lm-terminal-darkgray"),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-bold text-sm",children:e.symbol}),e.isEth&&(0,r.jsx)("span",{className:"text-lm-terminal-lightgray text-[10px] ml-1.5",children:"Native"})]}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono",children:e.hint})]},e.addr)})})]}),(0,r.jsx)("div",{className:"flex-1 relative",children:f&&void 0!==y?(0,r.jsx)("div",{className:"h-10 bg-lm-black border border-lm-terminal-gray px-3 flex items-center justify-end",children:(0,r.jsx)("span",{className:"lm-mono text-sm ".concat(y&&"No liquidity"!==y?"text-white font-bold":"text-lm-terminal-lightgray"),children:y||"—"})}):(0,r.jsx)(c.p,{value:g||"",onValueChange:p,placeholder:"0.0",className:"h-10 text-sm font-bold"})}),h&&x&&Number(x)>0&&(0,r.jsx)("button",{type:"button",onClick:h,className:"h-10 px-2 text-[10px] font-bold text-lm-orange border border-lm-orange/30 hover:border-lm-orange hover:bg-lm-orange/5 transition-colors lm-upper",children:"Max"})]}),w&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("input",{className:"lm-input text-left text-xs h-8",placeholder:"Paste token address (0x...)",value:i,onChange:e=>o(e.target.value)}),d?(0,r.jsxs)("div",{className:"text-lm-green text-[10px] flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-lm-green"}),"Detected: ",(0,r.jsx)("span",{className:"text-white font-bold",children:d.symbol})," (",d.decimals," decimals)"]}):42===i.length?(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] animate-pulse",children:"Detecting token..."}):null]}),N&&(0,r.jsxs)("div",{className:"text-[9px] text-lm-terminal-lightgray flex items-center gap-1",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-2.5 h-2.5",children:(0,r.jsx)("path",{d:"M8 1a7 7 0 100 14A7 7 0 008 1zm-.5 3h1v1h-1V4zm-1 2h3v1h-1v3h1v1h-3V10h1V7h-1V6z"})}),"Auto-wraps to WETH for the swap"]})]})}function w(){var e,t,a;let{address:c,walletClient:w,requireCorrectChain:j}=(0,h.v)(),[k,C]=(0,n.useState)([]),[E,S]=(0,n.useState)(""),[M,R]=(0,n.useState)(""),[L,F]=(0,n.useState)(""),[P,I]=(0,n.useState)(""),[T,A]=(0,n.useState)(null),[_,q]=(0,n.useState)(null),[$,B]=(0,n.useState)(3e3),[z,O]=(0,n.useState)(""),[U,W]=(0,n.useState)(0n),[V,H]=(0,n.useState)(""),[X,J]=(0,n.useState)(!1),[D,Q]=(0,n.useState)(100),[K,Y]=(0,n.useState)(!1),[Z,G]=(0,n.useState)(""),[ee,et]=(0,n.useState)("info"),[ea,er]=(0,n.useState)(!1),[en,el]=(0,n.useState)(""),[es,ei]=(0,n.useState)(""),[eo,ec]=(0,n.useState)(""),ed=(0,n.useRef)(null),em=(0,n.useMemo)(()=>{if(y(E))return{addr:x.$.weth,meta:{...b,address:x.$.weth},isNativeEth:!0};if("__custom__"===E&&T&&/^0x[0-9a-fA-F]{40}$/.test(L))return{addr:L,meta:T,isNativeEth:!1};let e=k.find(e=>e.address===E);return e?{addr:e.address,meta:e,isNativeEth:!1}:{addr:"",meta:null,isNativeEth:!1}},[E,L,T,k]),ex=(0,n.useMemo)(()=>{if(y(M))return{addr:x.$.weth,meta:{...b,address:x.$.weth},isNativeEth:!0};if("__custom__"===M&&_&&/^0x[0-9a-fA-F]{40}$/.test(P))return{addr:P,meta:_,isNativeEth:!1};let e=k.find(e=>e.address===M);return e?{addr:e.address,meta:e,isNativeEth:!1}:{addr:"",meta:null,isNativeEth:!1}},[M,P,_,k]);(0,n.useEffect)(()=>{if("__custom__"!==E||!/^0x[0-9a-fA-F]{40}$/.test(L))return void A(null);(async()=>{try{let[e,t]=await Promise.all([m.R.readContract({address:L,abi:u.Qi,functionName:"symbol"}),m.R.readContract({address:L,abi:u.Qi,functionName:"decimals"})]);A({address:L,symbol:e,decimals:Number(t),logoURI:""})}catch(e){A(null)}})()},[E,L]),(0,n.useEffect)(()=>{if("__custom__"!==M||!/^0x[0-9a-fA-F]{40}$/.test(P))return void q(null);(async()=>{try{let[e,t]=await Promise.all([m.R.readContract({address:P,abi:u.Qi,functionName:"symbol"}),m.R.readContract({address:P,abi:u.Qi,functionName:"decimals"})]);q({address:P,symbol:e,decimals:Number(t),logoURI:""})}catch(e){q(null)}})()},[M,P]),(0,n.useEffect)(()=>{(0,d.V)().then(e=>{C(e),E||S(b.address),!M&&e[0]&&R(e[0].address)}).catch(e=>{G(String((null==e?void 0:e.message)||e)),et("error")})},[]);let eu=(0,n.useRef)(k);eu.current=k;let eh=(0,n.useRef)(eN);eh.current=eN;let eg=(0,n.useRef)(en);eg.current=en,(0,g.SL)((0,n.useCallback)(e=>{if("swap"===e.type){let t=eu.current,a=e=>{if(!e)return;let a=e.toUpperCase();if("ETH"===a||"WETH"===a)return b.address;let r=t.find(e=>e.symbol.toUpperCase()===a);return null==r?void 0:r.address},r=a(e.tokenIn),n=a(e.tokenOut);r&&S(r),n&&R(n),e.amount&&O(e.amount),e.fee&&B(Number(e.fee)),e.slippage&&Q(Number(e.slippage))}else"flip_tokens"===e.type?eh.current():"max_balance"===e.type?eg.current&&O(eg.current):"set_fee"===e.type?B(Number(e.fee)):"set_slippage"===e.type&&Q(Number(e.bps))},[])),(0,n.useEffect)(()=>{if(!c){el(""),ei("");return}(async()=>{if(em.isNativeEth)try{el((0,l.J)(await m.R.getBalance({address:c}),18))}catch(e){el("?")}else if(em.addr&&em.meta)try{let e=await m.R.readContract({address:em.addr,abi:u.bx,functionName:"balanceOf",args:[c]});el((0,l.J)(e,em.meta.decimals))}catch(e){el("?")}else el("");if(ex.isNativeEth)try{ei((0,l.J)(await m.R.getBalance({address:c}),18))}catch(e){ei("?")}else if(ex.addr&&ex.meta)try{let e=await m.R.readContract({address:ex.addr,abi:u.bx,functionName:"balanceOf",args:[c]});ei((0,l.J)(e,ex.meta.decimals))}catch(e){ei("?")}else ei("")})()},[c,em.addr,em.isNativeEth,em.meta,ex.addr,ex.isNativeEth,ex.meta]);let ep=(0,n.useCallback)(async()=>{if(!x.$.quoterV2||!em.addr||!ex.addr||!em.meta||!ex.meta)return;let e=(z||"").trim();if(!e||"0"===e||"0."===e||"."===e){W(0n),H("");return}J(!0);try{let t=(0,s.X)(e,em.meta.decimals);if(0n===t){W(0n),H("");return}let a=await m.R.readContract({address:x.$.quoterV2,abi:u.D8,functionName:"quoteExactInputSingle",args:[{tokenIn:em.addr,tokenOut:ex.addr,amountIn:t,fee:$,sqrtPriceLimitX96:0n}]});W(a[0]),H((0,l.J)(a[0],ex.meta.decimals))}catch(e){W(0n),H("No liquidity")}finally{J(!1)}},[z,$,em.addr,em.meta,ex.addr,ex.meta]);(0,n.useEffect)(()=>(ed.current&&clearTimeout(ed.current),ed.current=setTimeout(()=>{ep().catch(()=>{})},400),()=>{ed.current&&clearTimeout(ed.current)}),[ep]);let ef=(0,n.useMemo)(()=>{if(!z||!V||"No liquidity"===V||!em.meta||!ex.meta)return null;let e=Number(z),t=Number(V);return e<=0||t<=0?null:{forward:t/e,inverse:e/t,inSymbol:em.isNativeEth?"ETH":em.meta.symbol,outSymbol:ex.isNativeEth?"ETH":ex.meta.symbol}},[z,V,em.meta,em.isNativeEth,ex.meta,ex.isNativeEth]),eb=(0,n.useMemo)(()=>U<=0n?0n:U*(10000n-BigInt(D))/10000n,[U,D]);async function ey(e,t,a,r,n){if(await m.R.readContract({address:a,abi:u.bx,functionName:"allowance",args:[e,t]})>=r)return;if(G("Approving ".concat(n,"...")),et("info"),!w)throw Error("No wallet client");let l=await w.writeContract({address:a,abi:u.bx,functionName:"approve",args:[t,r],chain:m.A,account:e});await m.R.waitForTransactionReceipt({hash:l})}async function ev(){if(!c){G("Connect wallet to swap."),et("error");return}if(!x.$.swapRouter||!em.addr||!ex.addr||!em.meta||!ex.meta){G("Select valid tokens."),et("error");return}let e=em.isNativeEth?"ETH":em.meta.symbol,t=ex.isNativeEth?"ETH":ex.meta.symbol;er(!0),ec("");try{let a,r=(z||"").trim(),n=(0,s.X)(r||"0",em.meta.decimals);if(0n===n)throw Error("Amount must be greater than 0");if(en){let t=(0,s.X)(en,em.meta.decimals);if(n>t){G("Insufficient ".concat(e," balance. You have ").concat(v(en)," but need ").concat(r,".")),et("error"),er(!1);return}}if(G("Preparing swap: ".concat(r," ").concat(e," → ").concat(t,"...")),et("info"),await j(),!w)throw Error("No wallet client");let l=BigInt(Math.floor(Date.now()/1e3)+600),o=BigInt(Math.max(0,Math.min(3e3,D))),d=0n;try{d=(await m.R.readContract({address:x.$.quoterV2,abi:u.D8,functionName:"quoteExactInputSingle",args:[{tokenIn:em.addr,tokenOut:ex.addr,amountIn:n,fee:$,sqrtPriceLimitX96:0n}]}))[0]*(10000n-o)/10000n}catch(e){G("Could not fetch quote. Pool may not have liquidity for this pair."),et("error"),er(!1);return}let h=em.isNativeEth;if(ex.isNativeEth){h||await ey(c,x.$.swapRouter,em.addr,n,e),G("Swapping ".concat(r," ").concat(e," → ~").concat(V?v(V):"?"," ").concat(t,"...")),et("info");let s=(0,i.p)({abi:u.zO,functionName:"exactInputSingle",args:[{tokenIn:em.addr,tokenOut:ex.addr,fee:$,recipient:x.$.swapRouter,deadline:l,amountIn:n,amountOutMinimum:d,sqrtPriceLimitX96:0n}]}),o=(0,i.p)({abi:u.zO,functionName:"unwrapWETH9",args:[d,c]});a=await w.writeContract({address:x.$.swapRouter,abi:u.zO,functionName:"multicall",args:[[s,o]],value:h?n:0n,chain:m.A,account:c})}else h||await ey(c,x.$.swapRouter,em.addr,n,e),G("Swapping ".concat(r," ").concat(e," → ~").concat(V?v(V):"?"," ").concat(t,"...")),et("info"),a=await w.writeContract({address:x.$.swapRouter,abi:u.zO,functionName:"exactInputSingle",args:[{tokenIn:em.addr,tokenOut:ex.addr,fee:$,recipient:c,deadline:l,amountIn:n,amountOutMinimum:d,sqrtPriceLimitX96:0n}],value:h?n:0n,chain:m.A,account:c});ec(a),G("Confirming on-chain..."),et("info");let g=await m.R.waitForTransactionReceipt({hash:a});"success"===g.status?(G("Swap confirmed! Received ~".concat(V?v(V):"?"," ").concat(t)),et("success"),O("")):(G("Transaction reverted. The price may have moved beyond your slippage tolerance."),et("error")),ep().catch(()=>{})}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?G("Transaction cancelled by user."):G("Swap failed: ".concat(e)),et("error")}finally{er(!1)}}function eN(){S(M),F(P),A(_),R(E),I(L),q(T),O(""),W(0n),H("")}let ew=em.isNativeEth?"ETH":(null==(e=em.meta)?void 0:e.symbol)||"",ej=ex.isNativeEth?"ETH":(null==(t=ex.meta)?void 0:t.symbol)||"",ek=X?"Quoting...":V&&"No liquidity"!==V?"".concat(v(V)," ").concat(ej):V,eC=em.addr&&ex.addr&&z&&Number(z)>0&&V&&"No liquidity"!==V;(0,n.useMemo)(()=>(!ef,null),[ef,V]);let eE=!!en&&!!z&&Number(z)>Number(en),eS=ea?"Processing...":c?em.addr&&ex.addr?!z||0>=Number(z)?"Enter Amount":"No liquidity"===V?"No Liquidity for This Pair":eE?"Insufficient ".concat(ew," Balance"):"Swap ".concat(ew," for ").concat(ej):"Select Tokens":"Connect Wallet",eM=!eC||ea||eE;return(0,r.jsxs)("div",{className:"lm-swap-card p-1",children:[(0,r.jsx)(N,{tokens:k,value:E,onChange:S,customAddr:L,onCustomAddr:F,customMeta:T,label:"You Pay",balance:en||void 0,symbol:ew,onMax:()=>{en&&O(en)},amount:z,onAmountChange:O,isNativeEth:em.isNativeEth}),(0,r.jsx)("div",{className:"flex justify-center -my-2 relative z-10",children:(0,r.jsx)("button",{type:"button",onClick:eN,disabled:ea,className:"w-10 h-10 flex items-center justify-center bg-lm-terminal-darkgray border-2 border-lm-terminal-gray hover:border-lm-orange hover:bg-lm-black text-lm-terminal-lightgray hover:text-lm-orange group disabled:opacity-40 disabled:pointer-events-none",title:"Flip tokens",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4 group-hover:rotate-180 transition-transform duration-300",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M2.24 6.8a.75.75 0 001.06-.04l1.95-2.1v8.59a.75.75 0 001.5 0V4.66l1.95 2.1a.75.75 0 101.1-1.02l-3.25-3.5a.75.75 0 00-1.1 0L2.2 5.74a.75.75 0 00.04 1.06zm8 6.4a.75.75 0 00-.04 1.06l3.25 3.5a.75.75 0 001.1 0l3.25-3.5a.75.75 0 10-1.1-1.02l-1.95 2.1V6.75a.75.75 0 00-1.5 0v8.59l-1.95-2.1a.75.75 0 00-1.06-.04z",clipRule:"evenodd"})})})}),(0,r.jsx)(N,{tokens:k,value:M,onChange:R,customAddr:P,onCustomAddr:I,customMeta:_,label:"You Receive",balance:es||void 0,symbol:ej,amountReadonly:!0,quoteDisplay:ek,isNativeEth:ex.isNativeEth}),(ef||eC)&&(0,r.jsxs)("div",{className:"mx-1 mt-2",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>Y(!K),className:"flex items-center justify-between w-full py-2 px-2 text-[10px] hover:bg-lm-terminal-darkgray/50 transition-colors",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 text-lm-terminal-lightgray",children:ef&&(0,r.jsxs)("span",{className:"text-white lm-mono",children:["1 ",ef.inSymbol," = ",0===(a=ef.forward)||isNaN(a)?"—":a>=1e6?"".concat((a/1e6).toFixed(2),"M"):a>=1e3?"".concat((a/1e3).toFixed(2),"K"):a>=1?a.toFixed(4):a>=1e-4?a.toFixed(6):a.toExponential(2)," ",ef.outSymbol]})}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5 text-lm-terminal-lightgray",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-3 h-3",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6.955 1.45A.5.5 0 017.452 1h1.096a.5.5 0 01.497.45l.17 1.699c.484.12.94.312 1.356.562l1.321-.916a.5.5 0 01.67.033l.774.775a.5.5 0 01.033.67l-.916 1.32c.25.417.443.873.563 1.357l1.699.17a.5.5 0 01.45.497v1.096a.5.5 0 01-.45.497l-1.699.17c-.12.484-.312.94-.562 1.356l.916 1.321a.5.5 0 01-.034.67l-.774.774a.5.5 0 01-.67.033l-1.32-.916c-.417.25-.873.443-1.357.563l-.17 1.699a.5.5 0 01-.497.45H7.452a.5.5 0 01-.497-.45l-.17-1.699a4.973 4.973 0 01-1.356-.562l-1.321.916a.5.5 0 01-.67-.034l-.774-.774a.5.5 0 01-.034-.67l.916-1.32a4.973 4.973 0 01-.562-1.357l-1.699-.17A.5.5 0 011 8.548V7.452a.5.5 0 01.45-.497l1.699-.17c.12-.484.312-.94.562-1.356l-.916-1.321a.5.5 0 01.034-.67l.774-.774a.5.5 0 01.67-.033l1.32.916c.417-.25.873-.443 1.357-.563l.17-1.699zM8 10a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-3 h-3 transition-transform ".concat(K?"rotate-180":""),children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.22 6.22a.75.75 0 011.06 0L8 8.94l2.72-2.72a.75.75 0 111.06 1.06l-3.25 3.25a.75.75 0 01-1.06 0L4.22 7.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})]})]}),K&&(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray/50 p-3 space-y-3 mt-1 lm-fade-in",children:[eC&&ex.meta&&(0,r.jsxs)("div",{className:"space-y-1.5 text-[10px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Minimum received"}),(0,r.jsxs)("span",{className:"text-white lm-mono font-bold",children:[v((0,l.J)(eb,ex.meta.decimals))," ",ej]})]}),(em.isNativeEth||ex.isNativeEth)&&(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Route"}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-white lm-mono",children:[(0,r.jsx)("span",{children:ew}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"→"}),em.isNativeEth&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"WETH"}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"→"})]}),ex.isNativeEth&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"WETH"}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"→"})]}),(0,r.jsx)("span",{children:ej})]})]}),(0,r.jsx)("div",{className:"h-px bg-lm-terminal-gray/30 my-1"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Fee Tier"}),(0,r.jsx)("div",{className:"flex gap-1",children:p.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>B(e.fee),className:"flex-1 py-2 border text-center ".concat($===e.fee?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{className:"text-xs font-bold",children:e.label}),(0,r.jsx)("div",{className:"text-[9px] opacity-60",children:e.hint})]},e.fee))})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Max Slippage"}),(0,r.jsx)("div",{className:"flex gap-1",children:f.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>Q(e.bps),className:"flex-1 text-xs py-2 border ".concat(D===e.bps?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.bps))}),(0,r.jsx)("div",{className:"text-[9px] text-lm-terminal-lightgray",children:"Swap reverts if price moves beyond this tolerance."})]})]})]}),eE&&(0,r.jsxs)("div",{className:"mx-1 mt-1.5 lm-callout lm-callout-red text-[10px] flex items-center gap-2",children:[(0,r.jsx)("span",{className:"lm-dot lm-dot-red"}),(0,r.jsxs)("span",{children:["Insufficient balance. You have ",(0,r.jsx)("span",{className:"text-white font-bold",children:v(en)})," ",ew," but need ",(0,r.jsx)("span",{className:"text-white font-bold",children:z}),"."]})]}),(0,r.jsx)("div",{className:"p-1 pt-2",children:(0,r.jsx)(o.$,{onClick:ev,loading:ea,disabled:eM,variant:eM?"default":"primary",size:"lg",className:"w-full ".concat(eM?"":"bg-lm-orange text-black"),children:eS})}),Z&&(0,r.jsxs)("div",{className:"mx-1 mb-1 text-xs p-2.5 border bg-lm-black flex items-center justify-between gap-2 ".concat("success"===ee?"text-lm-green":"error"===ee?"text-lm-red":"text-lm-gray"," ").concat("success"===ee?"border-lm-green/20":"error"===ee?"border-lm-red/20":"border-lm-terminal-gray"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:["info"===ee&&(0,r.jsx)("span",{className:"lm-spinner flex-shrink-0",style:{width:12,height:12,borderWidth:1.5}}),"success"===ee&&(0,r.jsx)("span",{className:"lm-dot lm-dot-green flex-shrink-0"}),"error"===ee&&(0,r.jsx)("span",{className:"lm-dot lm-dot-red flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:Z})]}),eo&&(0,r.jsx)("a",{href:"".concat(x.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/tx/").concat(eo),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline text-[10px] flex-shrink-0",children:"View Tx →"})]})]})}},7280:(e,t,a)=>{"use strict";a.d(t,{V:()=>s});var r=a(8839),n=a(2933),l=a(3376);async function s(){if(!n.$.tokenRegistry)return[];let e=await r.R.readContract({address:n.$.tokenRegistry,abi:l.wn,functionName:"tokenCount"}),t=[];for(let a=0n;a<e;a++){let e=await r.R.readContract({address:n.$.tokenRegistry,abi:l.wn,functionName:"tokenAt",args:[a]}),s=await r.R.readContract({address:n.$.tokenRegistry,abi:l.wn,functionName:"getToken",args:[e]});(null==s?void 0:s.whitelisted)&&t.push({address:e,symbol:s.symbol,decimals:Number(s.decimals),logoURI:s.logoURI||void 0,metadataURI:s.metadataURI||void 0})}return t}}},e=>{e.O(0,[462,476,668,918,441,255,358],()=>e(e.s=739)),_N_E=e.O()}]);