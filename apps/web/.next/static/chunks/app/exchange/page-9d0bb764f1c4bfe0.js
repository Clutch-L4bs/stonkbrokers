(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[806],{330:(e,t,a)=>{"use strict";a.d(t,{PoolsPanel:()=>F});var r=a(5155),l=a(2115),n=a(598),s=a(5028),i=a(931),o=a(6630),c=a(8590),d=a(7280),m=a(2933),u=a(3376),x=a(8839),h=a(9719),g=a(8604);let p=[{label:"0.05%",fee:500,tickSpacing:10,hint:"Stables"},{label:"0.30%",fee:3e3,tickSpacing:60,hint:"Standard"},{label:"1.00%",fee:1e4,tickSpacing:200,hint:"Volatile"}],f=[{label:"0.5%",bps:50},{label:"1%",bps:100},{label:"3%",bps:300}],b=2n**160n-1n;function y(e){return e<-887272?-887272:e>887272?887272:e}function v(e,t){let a=Math.trunc(e/t)*t;return e<0&&a>e&&(a-=t),y(a)}function N(e,t,a){return Math.pow(1.0001,e)*Math.pow(10,t-a)}function w(e){return 0!==e&&Number.isFinite(e)?e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e>=1?e.toFixed(4):e>=1e-4?e.toFixed(6):e>=1e-7?e.toFixed(10):e.toExponential(2):"—"}function j(e){return e<=0?1n:10n**BigInt(e)}function k(e){if(e<-887272||e>887272)throw Error("tick out of range");let t=e<0?-e:e,a=(1&t)!=0?0xfffcb933bd6fad37aa2d162d1a594001n:0x100000000000000000000000000000000n;(2&t)!=0&&(a=0xfff97272373d413259a46990580e213an*a>>128n),(4&t)!=0&&(a=0xfff2e50f5f656932ef12357cf3c7fdccn*a>>128n),(8&t)!=0&&(a=0xffe5caca7e10e4e61c3624eaa0941cd0n*a>>128n),(16&t)!=0&&(a=0xffcb9843d60f6159c9db58835c926644n*a>>128n),(32&t)!=0&&(a=0xff973b41fa98c081472e6896dfb254c0n*a>>128n),(64&t)!=0&&(a=0xff2ea16466c96a3843ec78b326b52861n*a>>128n),(128&t)!=0&&(a=0xfe5dee046a99a2a811c461f1969c3053n*a>>128n),(256&t)!=0&&(a=0xfcbe86c7900a88aedcffc83b479aa3a4n*a>>128n),(512&t)!=0&&(a=0xf987a7253ac413176f2b074cf7815e54n*a>>128n),(1024&t)!=0&&(a=0xf3392b0822b70005940c7a398e4b70f3n*a>>128n),(2048&t)!=0&&(a=0xe7159475a2c29b7443b29c7fa6e889d9n*a>>128n),(4096&t)!=0&&(a=0xd097f3bdfd2022b8845ad8f792aa5825n*a>>128n),(8192&t)!=0&&(a=0xa9f746462d870fdf8a65dc1f90e061e5n*a>>128n),(16384&t)!=0&&(a=0x70d869a156d2a1b890bb3df62baf32f7n*a>>128n),(32768&t)!=0&&(a=0x31be135f97d08fd981231505542fcfa6n*a>>128n),(65536&t)!=0&&(a=0x9aa508b5b7a84e1c677de54f3e99bc9n*a>>128n),(131072&t)!=0&&(a=0x5d6af8dedb81196699c329225ee604n*a>>128n),(262144&t)!=0&&(a=0x2216e584f5fa1ea926041bedfe98n*a>>128n),(524288&t)!=0&&(a=0x48a170391f7dc42444e8fa2n*a>>128n),e>0&&(a=((1n<<256n)-1n)/a);let r=(a&(1n<<32n)-1n)!==0n;return(a>>32n)+(r?1n:0n)}function C(e,t,a){if(0n===a)throw Error("div by zero");return e*t/a}function E(e,t,a){return e>t&&([e,t]=[t,e]),C(a,C(e,t,2n**96n),t-e)}function S(e,t,a){return e>t&&([e,t]=[t,e]),C(a,2n**96n,t-e)}function R(e,t,a,r){let l=2n**96n;return(t>a&&([t,a]=[a,t]),e<=t)?{amount0:C(r,(a-t)*l,t*a),amount1:0n}:e<a?{amount0:C(r,(a-e)*l,e*a),amount1:C(r,e-t,l)}:{amount0:0n,amount1:C(r,a-t,l)}}function M(e){let{mode:t,lower:a,upper:l,current:n,quoteLabel:s}=e;if(!n||!Number.isFinite(n)||n<=0)return null;if("full"===t||!a||!l||!Number.isFinite(a)||!Number.isFinite(l)||a<=0||l<=0||a>=l)return(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-2 space-y-1 text-[10px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray lm-upper font-bold tracking-wider",children:"Range"}),(0,r.jsx)("span",{className:"lm-badge lm-badge-gray",children:"Full Range"})]}),(0,r.jsxs)("svg",{viewBox:"0 0 320 90",className:"w-full h-[90px] border border-lm-terminal-gray bg-lm-terminal-darkgray",children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"320",height:"90",fill:"transparent"}),(0,r.jsx)("line",{x1:"40",y1:"65",x2:"308",y2:"65",stroke:"rgba(255,255,255,0.12)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:"40",y1:"20",x2:"308",y2:"20",stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:"40",y1:"42",x2:"308",y2:"42",stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:"174",y1:"18",x2:"174",y2:"68",stroke:"rgba(255,255,255,0.75)",strokeWidth:"2"}),(0,r.jsx)("text",{x:"40",y:"82",fill:"rgba(255,255,255,0.6)",fontSize:"10",children:"0"}),(0,r.jsxs)("text",{x:"174",y:"82",fill:"rgba(255,255,255,0.9)",fontSize:"10",textAnchor:"middle",children:[w(n)," ",s]}),(0,r.jsx)("text",{x:"308",y:"82",fill:"rgba(255,255,255,0.6)",fontSize:"10",textAnchor:"end",children:"∞"})]})]});let i=n>=a&&n<=l,o=Math.log(a),c=Math.log(l),d=40+268*Math.max(0,Math.min(1,(Math.log(n)-o)/(c-o)));return(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-2 space-y-1 text-[10px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray lm-upper font-bold tracking-wider",children:"Range"}),(0,r.jsx)("span",{className:i?"lm-badge lm-badge-green":"lm-badge lm-badge-orange",children:i?"In Range":"Out of Range"})]}),(0,r.jsxs)("svg",{viewBox:"0 0 ".concat(320," ").concat(90),className:"w-full h-[90px] border border-lm-terminal-gray bg-lm-terminal-darkgray",children:[(0,r.jsx)("rect",{x:"0",y:"0",width:320,height:90,fill:"transparent"}),(0,r.jsx)("line",{x1:40,y1:65,x2:308,y2:65,stroke:"rgba(255,255,255,0.12)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:40,y1:12,x2:308,y2:12,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:40,y1:38.5,x2:308,y2:38.5,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:107,y1:12,x2:107,y2:65,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:174,y1:12,x2:174,y2:65,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("line",{x1:241,y1:12,x2:241,y2:65,stroke:"rgba(255,255,255,0.06)",strokeWidth:"1"}),(0,r.jsx)("rect",{x:40,y:13,width:268,height:51,fill:i?"rgba(0,255,0,0.10)":"rgba(207,255,4,0.08)"}),(0,r.jsx)("line",{x1:d,y1:12,x2:d,y2:68,stroke:"rgba(255,255,255,0.85)",strokeWidth:"2"}),(0,r.jsx)("text",{x:40,y:80,fill:"rgba(255,255,255,0.65)",fontSize:"10",className:"lm-mono",children:w(a)}),(0,r.jsx)("text",{x:d,y:80,fill:"rgba(255,255,255,0.95)",fontSize:"10",textAnchor:"middle",className:"lm-mono",children:w(n)}),(0,r.jsx)("text",{x:308,y:80,fill:"rgba(255,255,255,0.65)",fontSize:"10",textAnchor:"end",className:"lm-mono",children:w(l)}),(0,r.jsx)("text",{x:308,y:12,fill:"rgba(255,255,255,0.45)",fontSize:"9",textAnchor:"end",children:s})]})]})}function L(e){let t=Number(e);return isNaN(t)||0===t?"0":t>=1e6?"".concat((t/1e6).toFixed(2),"M"):t>=1e3?"".concat((t/1e3).toFixed(2),"K"):t>=1?t.toFixed(4):t>=1e-4?t.toFixed(6):t.toExponential(2)}function F(){let{address:e,walletClient:t,requireCorrectChain:a,connect:C}=(0,h.v)(),[F,P]=(0,l.useState)([]),[I,T]=(0,l.useState)(""),[A,_]=(0,l.useState)(""),[q,$]=(0,l.useState)(3e3),[B,z]=(0,l.useState)(""),[O,U]=(0,l.useState)(!1),[V,W]=(0,l.useState)(""),[H,X]=(0,l.useState)(""),[J,D]=(0,l.useState)(""),[Q,K]=(0,l.useState)(!0),[Y,G]=(0,l.useState)("amt0"),[Z,ee]=(0,l.useState)(100),[et,ea]=(0,l.useState)("full"),[er,el]=(0,l.useState)(""),[en,es]=(0,l.useState)(""),[ei,eo]=(0,l.useState)(""),[ec,ed]=(0,l.useState)("info"),[em,eu]=(0,l.useState)(!1),[ex,eh]=(0,l.useState)(""),[eg,ep]=(0,l.useState)(""),ef=(0,l.useMemo)(()=>F.find(e=>e.address===I),[F,I]),eb=(0,l.useMemo)(()=>F.find(e=>e.address===A),[F,A]),ey=(0,l.useMemo)(()=>p.find(e=>e.fee===q),[q]),ev=(0,l.useMemo)(()=>I&&A&&I.toLowerCase()!==A.toLowerCase()?{token0:I.toLowerCase()<A.toLowerCase()?I:A,token1:I.toLowerCase()<A.toLowerCase()?A:I}:null,[I,A]),eN=(0,l.useMemo)(()=>ev?F.find(e=>e.address===ev.token0):void 0,[ev,F]),ew=(0,l.useMemo)(()=>ev?F.find(e=>e.address===ev.token1):void 0,[ev,F]),ej=(0,l.useMemo)(()=>{try{var e,t;if(!ev||!eN||!ew)return"";let a=(B||"").trim();if(!a||"0"===a)return"";let r=(0,s.X)(a,18);if(r<=0n)return"";let l=(e=eN.decimals,(t=ew.decimals)>e?r*j(t-e):e>t?r/j(e-t):r);if(l<=0n)return"";let n=2n**96n,i=n*n*l/10n**18n;if(i<=0n)return"";let o=function(e){if(e<0n)throw Error("sqrt of negative");if(e<2n)return e;let t=e,a=t+1n>>1n;for(;a<t;)t=a,a=a+e/a>>1n;return t}(i);if(o<=0n||o>b)return"";return o.toString()}catch(e){return""}},[B,eN,ew,ev]),ek=(0,l.useMemo)(()=>V.trim()?V.trim():ej,[ej,V]),[eC,eE]=(0,l.useState)(""),[eS,eR]=(0,l.useState)(null),[eM,eL]=(0,l.useState)(null),[eF,eP]=(0,l.useState)(""),eI=(0,l.useCallback)(async()=>{if(!m.$.uniFactory||!ev||!ey||!eN||!ew){eE(""),eR(null),eL(null),eP("");return}try{let e=await x.R.readContract({address:m.$.uniFactory,abi:u.HB,functionName:"getPool",args:[ev.token0,ev.token1,q]});if(!e||"0x0000000000000000000000000000000000000000"===e){eE(""),eR(null),eL(null),eP("");return}eE(e);let t=await x.R.readContract({address:e,abi:u.ld,functionName:"slot0"}),a=t[0],r=t[1];eL(a),eR(r);let l={num:a*a,den:2n**192n},n=BigInt(eN.decimals),s=BigInt(ew.decimals),i=l.num,o=l.den;n>s&&(i*=10n**(n-s)),s>n&&(o*=10n**(s-n)),eP(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;if(0n===t)return"0";let r=10n**BigInt(a),l=(e*r/t).toString().padStart(a+1,"0"),n=l.slice(0,-a),s=l.slice(-a);return"".concat(n,".").concat(s).replace(/\.?0+$/,e=>"")}(i,o,8))}catch(e){eE(""),eR(null),eL(null),eP("")}},[q,ey,eN,ew,ev]);(0,l.useEffect)(()=>{eI().catch(()=>{})},[eI]),(0,l.useEffect)(()=>{if(!e){eh(""),ep("");return}(async()=>{if(I&&ef)try{let t=await x.R.readContract({address:I,abi:u.bx,functionName:"balanceOf",args:[e]});eh((0,n.J)(t,ef.decimals))}catch(e){eh("?")}else eh("");if(A&&eb)try{let t=await x.R.readContract({address:A,abi:u.bx,functionName:"balanceOf",args:[e]});ep((0,n.J)(t,eb.decimals))}catch(e){ep("?")}else ep("")})()},[e,I,A,ef,eb]);let eT=(0,l.useMemo)(()=>{if(!ey)return{ticks:null,error:""};if("full"===et)return{ticks:function(e){let t=t=>{let a=Math.trunc(t/e)*e;return t<0&&a>t&&(a-=e),a};return{tickLower:t(-887272),tickUpper:t(887272)}}(ey.tickSpacing),error:""};if(!eN||!ew)return{ticks:null,error:"Select tokens first."};let e=(er||"").trim(),t=(en||"").trim();if(!e||!t)return{ticks:null,error:""};let a=Number(e),r=Number(t);if(!Number.isFinite(a)||!Number.isFinite(r))return{ticks:null,error:"Enter valid numbers for min/max price."};if(a<=0||r<=0)return{ticks:null,error:"Min/max price must be greater than 0."};if(a>=r)return{ticks:null,error:"Min price must be lower than max price."};let l=Math.pow(10,ew.decimals-eN.decimals);if(!Number.isFinite(l)||l<=0)return{ticks:null,error:"Price scaling overflow. Try a smaller range."};let n=a*l,s=r*l;if(!Number.isFinite(n)||!Number.isFinite(s)||n<=0||s<=0)return{ticks:null,error:"Price range is too large/small to compute ticks."};let i=Math.log(1.0001),o=Math.log(n)/i,c=Math.log(s)/i;if(!Number.isFinite(o)||!Number.isFinite(c))return{ticks:null,error:"Price range is out of tick bounds."};let d=Math.floor(c),m=v(Math.floor(o),ey.tickSpacing),u=function(e,t){let a=v(e,t);return a===e?a:y(a+t)}(d,ey.tickSpacing);return Number.isFinite(m)&&Number.isFinite(u)?m>=u?{ticks:null,error:"Range too narrow for this fee tier. Widen the range."}:{ticks:{tickLower:m,tickUpper:u},error:""}:{ticks:null,error:"Invalid tick calculation."}},[ey,en,er,et,eN,ew]),eA=eT.ticks,e_=eT.error,eq=(0,l.useMemo)(()=>eA&&eN&&ew?{lower:N(eA.tickLower,eN.decimals,ew.decimals),upper:N(eA.tickUpper,eN.decimals,ew.decimals)}:null,[eA,eN,ew]),e$=(0,l.useMemo)(()=>{try{if(null!==eS&&eN&&ew){let e=N(eS,eN.decimals,ew.decimals);return Number.isFinite(e)&&e>0?e:null}let e=Number((B||"").trim());return Number.isFinite(e)&&e>0?e:null}catch(e){return null}},[eS,B,eN,ew]),eB=(0,l.useMemo)(()=>{if(eC&&eM)return eM;try{let e=BigInt((ek||"").trim()||"0");if(e<=0n||e>b)return null;return e}catch(e){return null}},[eM,eC,ek]),ez=(0,l.useMemo)(()=>{if(!eA||!ef||!eb||!eN||!ew||!eB)return null;try{let e,t,a=k(eA.tickLower),r=k(eA.tickUpper),l=(0,s.X)(H||"0",ef.decimals),n=(0,s.X)(J||"0",eb.decimals);if(0n===l&&0n===n)return{used0:0n,used1:0n,desired0:0n,desired1:0n,leftover0:0n,leftover1:0n,mode:"unknown",note:"Enter amounts to see preview."};if(!ev)return null;let i=ev.token0.toLowerCase()===I.toLowerCase()?l:n,o=ev.token0.toLowerCase()===I.toLowerCase()?n:l,c=a<r?a:r,d=a>r?a:r;if(eB<=c)t="below",e=E(a,r,i);else if(eB>=d)t="above",e=S(a,r,o);else{t="in";let l=E(eB,r,i),n=S(a,eB,o);e=l<n?l:n}let{amount0:m,amount1:u}=R(eB,a,r,e),x=i>m?i-m:0n,h=o>u?o-u:0n;return{used0:m,used1:u,desired0:i,desired1:o,leftover0:x,leftover1:h,mode:t,note:""}}catch(e){return{used0:0n,used1:0n,desired0:0n,desired1:0n,leftover0:0n,leftover1:0n,mode:"unknown",note:String((null==e?void 0:e.message)||e)}}},[H,J,eB,eA,eN,ew,ev,ef,eb,I]);(0,l.useEffect)(()=>{let e;if(!Q||!ev||!ef||!eb||!eA||!eB)return;let t="amt0"===Y?(H||"").trim():(J||"").trim(),a="amt0"===Y?(J||"").trim():(H||"").trim(),r="amt0"===Y?I:A,l="amt0"===Y?A:I,i="amt0"===Y?ef:eb,o="amt0"===Y?eb:ef;if(!r||!l)return;if(!t){a&&("amt0"===Y?D(""):X(""));return}try{e=(0,s.X)(t,i.decimals)}catch(e){return}let c=k(eA.tickLower),d=k(eA.tickUpper),m=ev.token0.toLowerCase()===r.toLowerCase(),u=ev.token1.toLowerCase()===r.toLowerCase();if(!m&&!u)return;let x=c<d?c:d,h=c>d?c:d,g=0n;if(m)if(eB<=x)g=0n;else if(eB>=h)g=0n;else{let t=E(eB,d,e);g=R(eB,c,d,t).amount1}else if(u)if(eB>=h)g=0n;else if(eB<=x)g=0n;else{let t=S(c,eB,e);g=R(eB,c,d,t).amount0}let p=(()=>{var e=(ev.token0.toLowerCase()===l.toLowerCase(),g),t=o.decimals;let a=(0,n.J)(e,t);return a.includes(".")?a.replace(/(\.\d*?[1-9])0+$/,"$1").replace(/\.0+$/,""):a})();"amt0"===Y?p!==(J||"")&&D(p):p!==(H||"")&&X(p)},[Q,Y,H,J,ev,ef,eb,eA,eB]),(0,l.useEffect)(()=>{(0,d.V)().then(e=>{P(e),!I&&e[0]&&T(e[0].address),!A&&e[1]&&_(e[1].address)}).catch(e=>{eo(String((null==e?void 0:e.message)||e)),ed("error")})},[]);let eO=(0,l.useRef)(F);async function eU(e,a,r,l){var n;if(await x.R.readContract({address:r,abi:u.bx,functionName:"allowance",args:[e,a]})>=l)return;if(eo("Approving ".concat((null==(n=F.find(e=>e.address===r))?void 0:n.symbol)||"token","...")),ed("info"),!t)throw Error("No wallet client");let s=await t.writeContract({address:r,abi:u.bx,functionName:"approve",args:[a,l],chain:x.A,account:e});await x.R.waitForTransactionReceipt({hash:s})}async function eV(){if(!e){eo("Connect wallet."),ed("error");return}if(!m.$.positionManager||!ev)return;let r=(null==ef?void 0:ef.symbol)||"Token0",l=(null==eb?void 0:eb.symbol)||"Token1";eu(!0);try{let n;await a();try{n=BigInt((ek||"").trim()||"0")}catch(e){throw Error("Initial price is invalid. Enter a valid number.")}if(n<=0n)throw Error("Set an initial price first (enter a price in the field above).");if(n>b)throw Error("Initial price is out of range. Try a smaller price.");if(!t)throw Error("No wallet client");eo("Creating ".concat(r,"/").concat(l," pool (").concat(null==ey?void 0:ey.label," fee)...")),ed("info");let s=await t.writeContract({address:m.$.positionManager,abi:u.g4,functionName:"createAndInitializePoolIfNecessary",args:[ev.token0,ev.token1,q,n],value:0n,chain:x.A,account:e});eo("Confirming pool creation on-chain...");let i=await x.R.waitForTransactionReceipt({hash:s});"success"===i.status?(eo("Pool created! ".concat(r,"/").concat(l," (").concat(null==ey?void 0:ey.label,") is now live.")),ed("success")):(eo("Pool creation reverted. The pool may already exist for this pair + fee tier."),ed("error"))}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?eo("Transaction cancelled."):eo("Create pool failed: ".concat(e)),ed("error")}finally{eu(!1)}}async function eW(){if(!e){eo("Connect wallet."),ed("error");return}if(m.$.positionManager&&I&&A&&ef&&eb&&ey&&ev){if(!eA){eo("Invalid price range."),ed("error");return}eu(!0);try{let r;await a();let l=(0,s.X)(H||"0",ef.decimals),n=(0,s.X)(J||"0",eb.decimals);if(0n===l&&0n===n)throw Error("Enter amount for at least one token");if(!t)throw Error("No wallet client");let{tickLower:o,tickUpper:c}=eA,d=ev.token0.toLowerCase()===I.toLowerCase()?l:n,h=ev.token0.toLowerCase()===I.toLowerCase()?n:l;if(!eB){if(!eC)throw Error("No pool found. Set an initial price and create the pool first.");throw Error("Loading pool price. Try again in a moment.")}let g=k(o),p=k(c);if(eB<=(g<p?g:p))r=E(g,p,d);else if(eB>=(g>p?g:p))r=S(g,p,h);else{let e=E(eB,p,d),t=S(g,eB,h);r=e<t?e:t}let f=R(eB,g,p,r);await eU(e,m.$.positionManager,I,l),await eU(e,m.$.positionManager,A,n);let y=BigInt(Math.max(0,Math.min(3e3,Z))),v=f.amount0*(10000n-y)/10000n,N=f.amount1*(10000n-y)/10000n,w=BigInt(Math.floor(Date.now()/1e3)+600);if(eC){eo("Minting LP: ".concat(H||"0"," ").concat(ef.symbol," + ").concat(J||"0"," ").concat(eb.symbol,"...")),ed("info");let a=await t.writeContract({address:m.$.positionManager,abi:u.g4,functionName:"mint",args:[{token0:ev.token0,token1:ev.token1,fee:q,tickLower:o,tickUpper:c,amount0Desired:d,amount1Desired:h,amount0Min:v,amount1Min:N,recipient:e,deadline:w}],value:0n,chain:x.A,account:e});eo("Confirming on-chain...");let r=await x.R.waitForTransactionReceipt({hash:a});"success"===r.status?(eo("LP position minted! ".concat(ef.symbol,"/").concat(eb.symbol," liquidity added. Check the Positions tab.")),ed("success")):(eo("Mint transaction reverted. Check your balances and price range."),ed("error"))}else{let a;try{a=BigInt((ek||"").trim()||"0")}catch(e){throw Error("Set an initial price to create the pool first.")}if(a<=0n||a>b)throw Error("Initial price is invalid (sqrtPriceX96 out of range).");eo("Creating pool + minting LP..."),ed("info");let r=(0,i.p)({abi:u.g4,functionName:"createAndInitializePoolIfNecessary",args:[ev.token0,ev.token1,q,a]}),l=(0,i.p)({abi:u.g4,functionName:"mint",args:[{token0:ev.token0,token1:ev.token1,fee:q,tickLower:o,tickUpper:c,amount0Desired:d,amount1Desired:h,amount0Min:v,amount1Min:N,recipient:e,deadline:w}]}),n=await t.writeContract({address:m.$.positionManager,abi:u.g4,functionName:"multicall",args:[[r,l]],value:0n,chain:x.A,account:e});eo("Confirming on-chain...");let s=await x.R.waitForTransactionReceipt({hash:n});"success"===s.status?(eo("Pool created and LP position minted! Check the Positions tab."),ed("success"),await eI()):(eo("Transaction reverted. Check your balances, range, and initial price."),ed("error"))}}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?eo("Transaction cancelled."):eo("Add liquidity failed: ".concat(e)),ed("error")}finally{eu(!1)}}}eO.current=F,(0,g.SL)((0,l.useCallback)(e=>{if("add_liquidity"!==e.type&&"create_pool"!==e.type)return;let t=eO.current,a=e=>{if(!e)return"";let a=e.toUpperCase(),r=t.find(e=>e.symbol.toUpperCase()===a);return(null==r?void 0:r.address)||""},r=a(e.token0),l=a(e.token1);r&&T(r),l&&_(l),e.fee&&$(Number(e.fee)),"create_pool"===e.type&&e.price&&z(e.price),"add_liquidity"===e.type&&("full"===e.range?ea("full"):"custom"===e.range&&(ea("custom"),e.minPrice&&el(e.minPrice),e.maxPrice&&es(e.maxPrice)),e.amount0&&X(e.amount0),e.amount1&&D(e.amount1))},[]));let eH=I&&A&&I.toLowerCase()===A.toLowerCase();return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 space-y-3",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Select Token Pair"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:"Token A"}),(0,r.jsxs)("select",{className:"w-full bg-lm-black border border-lm-terminal-gray hover:border-lm-orange p-2 text-sm h-9 text-white font-bold transition-colors disabled:opacity-40",value:I,onChange:e=>T(e.target.value),disabled:em,children:[0===F.length&&(0,r.jsx)("option",{value:"",disabled:!0,children:"Loading tokens..."}),F.map(e=>(0,r.jsx)("option",{value:e.address,children:e.symbol},e.address))]}),ex&&(0,r.jsxs)("div",{className:"text-[10px] text-lm-terminal-lightgray lm-mono",children:["Balance: ",(0,r.jsx)("span",{className:"text-white",children:L(ex)})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:"Token B"}),(0,r.jsxs)("select",{className:"w-full bg-lm-black border border-lm-terminal-gray hover:border-lm-orange p-2 text-sm h-9 text-white font-bold transition-colors disabled:opacity-40",value:A,onChange:e=>_(e.target.value),disabled:em,children:[0===F.length&&(0,r.jsx)("option",{value:"",disabled:!0,children:"Loading tokens..."}),F.map(e=>(0,r.jsx)("option",{value:e.address,children:e.symbol},e.address))]}),eg&&(0,r.jsxs)("div",{className:"text-[10px] text-lm-terminal-lightgray lm-mono",children:["Balance: ",(0,r.jsx)("span",{className:"text-white",children:L(eg)})]})]})]}),eH&&(0,r.jsx)("div",{className:"text-lm-red text-xs",children:"Tokens must be different."}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Trading Fee"}),(0,r.jsx)("div",{className:"flex gap-1",children:p.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>$(e.fee),className:"flex-1 py-2 border transition-colors text-center ".concat(q===e.fee?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{className:"text-xs font-bold",children:e.label}),(0,r.jsx)("div",{className:"text-[9px] opacity-60",children:e.hint})]},e.fee))})]}),ev&&(0,r.jsxs)("div",{className:"text-xs bg-lm-black border p-3 space-y-1 ".concat(eC?"border-lm-green/20":"border-lm-red/20"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"lm-dot ".concat(eC?"lm-dot-green lm-dot-pulse":"lm-dot-red")}),(0,r.jsx)("span",{className:eC?"text-lm-green font-bold":"text-lm-red",children:eC?"Pool Active":"No Pool Found"})]}),eC&&(0,r.jsxs)("a",{href:"".concat(m.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/address/").concat(eC),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline lm-mono text-[10px]",children:[eC.slice(0,6)+"..."+eC.slice(-4)," →"]})]}),eF&&eN&&ew&&(0,r.jsxs)("div",{className:"text-[10px] lm-mono flex items-center gap-1.5 pt-0.5",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Current Price:"}),(0,r.jsx)("span",{className:"text-white font-bold",children:eF}),(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray",children:[ew.symbol,"/",eN.symbol]})]})]})]}),ev&&!eC&&(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 space-y-3",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Initialize New Pool"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px]",children:"This pair has no pool yet. Set an initial price to create one."}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-xs",children:["Initial Price (",(null==ew?void 0:ew.symbol)||"B"," per ",(null==eN?void 0:eN.symbol)||"A",")"]}),(0,r.jsx)(c.p,{value:B,onValueChange:z,placeholder:"e.g. 0.001"}),(B||"").trim()&&!ek?(0,r.jsx)("div",{className:"text-lm-red text-[10px]",children:"Invalid initial price. Enter a positive number."}):null]}),(0,r.jsx)("button",{type:"button",onClick:()=>U(!O),className:"text-lm-terminal-lightgray text-[10px] hover:text-lm-orange transition-colors",children:O?"▾ Hide developer settings":"▸ Developer settings"}),O&&(0,r.jsxs)("div",{className:"space-y-1 text-[10px]",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray",children:["sqrtPriceX96 (auto: ",(0,r.jsx)("span",{className:"lm-mono text-lm-gray",children:ej||"—"}),")"]}),(0,r.jsx)(c.p,{value:V,onValueChange:W,placeholder:"Leave blank for auto",className:"text-left text-xs",numeric:!1})]}),(0,r.jsx)(o.$,{onClick:e?eV:C,loading:em,disabled:em||!!e&&!ek,variant:"primary",size:"lg",className:"w-full",children:em?"Creating Pool...":e?"Create Pool":"Connect Wallet"})]}),(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 space-y-3",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Add Liquidity"}),eC?null:(0,r.jsx)("div",{className:"text-[10px] text-lm-terminal-lightgray",children:"No pool found for this pair + fee. Set an initial price above and we'll create + initialize + mint in one transaction."}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:"Price Range"}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>ea("full"),className:"flex-1 text-xs py-2 border transition-colors ".concat("full"===et?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{className:"font-bold",children:"Full Range"}),(0,r.jsx)("div",{className:"text-[9px] opacity-60",children:"Earn fees at any price"})]}),(0,r.jsxs)("button",{type:"button",onClick:()=>ea("custom"),className:"flex-1 text-xs py-2 border transition-colors ".concat("custom"===et?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{className:"font-bold",children:"Custom Range"}),(0,r.jsx)("div",{className:"text-[9px] opacity-60",children:"Concentrated liquidity"})]})]})]}),"custom"===et&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-xs",children:["Min Price (",(null==ew?void 0:ew.symbol)||"B","/",(null==eN?void 0:eN.symbol)||"A",")"]}),(0,r.jsx)(c.p,{value:er,onValueChange:el,placeholder:"0.0005"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-xs",children:["Max Price (",(null==ew?void 0:ew.symbol)||"B","/",(null==eN?void 0:eN.symbol)||"A",")"]}),(0,r.jsx)(c.p,{value:en,onValueChange:es,placeholder:"0.0020"})]})]}),e_?(0,r.jsx)("div",{className:"text-lm-red text-[10px]",children:e_}):null]}),eq&&eN&&ew&&(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-2 flex items-center justify-between text-[10px]",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Low: "}),(0,r.jsx)("span",{className:"text-white lm-mono font-bold",children:"full"===et?"0":w(eq.lower)})]}),(0,r.jsx)("span",{className:"text-lm-terminal-gray",children:"←→"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"High: "}),(0,r.jsx)("span",{className:"text-white lm-mono font-bold",children:"full"===et?"∞":w(eq.upper)})]}),(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray",children:[ew.symbol,"/",eN.symbol]})]}),eN&&ew?(0,r.jsx)(M,{mode:et,lower:"custom"===et&&eq?eq.lower:null,upper:"custom"===et&&eq?eq.upper:null,current:e$,quoteLabel:"".concat(ew.symbol,"/").concat(eN.symbol)}):null,(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:(null==ef?void 0:ef.symbol)||"Token A"}),ex&&Number(ex)>0&&(0,r.jsx)("button",{type:"button",onClick:()=>{G("amt0"),X(ex)},className:"text-[10px] text-lm-orange hover:underline",children:"MAX"})]}),(0,r.jsx)(c.p,{value:H,onValueChange:e=>{G("amt0"),X(e)},placeholder:"0.0"})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:(null==eb?void 0:eb.symbol)||"Token B"}),eg&&Number(eg)>0&&(0,r.jsx)("button",{type:"button",onClick:()=>{G("amt1"),D(eg)},className:"text-[10px] text-lm-orange hover:underline",children:"MAX"})]}),(0,r.jsx)(c.p,{value:J,onValueChange:e=>{G("amt1"),D(e)},placeholder:"0.0"})]})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2 text-[10px] text-lm-terminal-lightgray select-none",children:[(0,r.jsx)("input",{type:"checkbox",checked:Q,onChange:e=>K(e.target.checked),className:"accent-lm-orange"}),"Auto-adjust the other token to match the selected range"]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Slippage Tolerance"}),(0,r.jsx)("div",{className:"flex gap-1",children:f.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>ee(e.bps),className:"flex-1 text-xs py-1.5 border transition-colors ".concat(Z===e.bps?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.bps))})]}),ez&&(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray p-2.5 space-y-1.5 text-[10px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper font-bold tracking-wider",children:"Deposit Preview"}),"in"===ez.mode?(0,r.jsx)("span",{className:"lm-badge lm-badge-green",children:"In Range"}):"below"===ez.mode||"above"===ez.mode?(0,r.jsx)("span",{className:"lm-badge lm-badge-orange",children:"Single-Sided"}):null]}),ez.note?(0,r.jsx)("div",{className:"text-lm-terminal-lightgray",children:ez.note}):(0,r.jsxs)("div",{className:"space-y-1",children:["below"===ez.mode&&eN&&ew?(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray",children:["Current price is below your range. This deposit uses ",eN.symbol," only."]}):null,"above"===ez.mode&&eN&&ew?(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray",children:["Current price is above your range. This deposit uses ",ew.symbol," only."]}):null,(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:null==eN?void 0:eN.symbol}),(0,r.jsxs)("span",{className:"text-white lm-mono font-bold",children:["Used ",eN?L((0,n.J)(ez.used0,eN.decimals)):"0",eN?" \xb7 Leftover ".concat(L((0,n.J)(ez.leftover0,eN.decimals))):""]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:null==ew?void 0:ew.symbol}),(0,r.jsxs)("span",{className:"text-white lm-mono font-bold",children:["Used ",ew?L((0,n.J)(ez.used1,ew.decimals)):"0",ew?" \xb7 Leftover ".concat(L((0,n.J)(ez.leftover1,ew.decimals))):""]})]})]})]}),(0,r.jsx)(o.$,{onClick:e?eW:C,loading:em,disabled:em||!!e&&(!eA||!eC&&!eB),variant:"primary",size:"lg",className:"w-full",children:em?"Processing...":e?eC?"Add Liquidity":"Create + Add Liquidity":"Connect Wallet"})]}),ei&&(0,r.jsxs)("div",{className:"text-xs p-2.5 border bg-lm-black flex items-center gap-2 ".concat("success"===ec?"text-lm-green":"error"===ec?"text-lm-red":"text-lm-gray"," ").concat("success"===ec?"border-lm-green/20":"error"===ec?"border-lm-red/20":"border-lm-terminal-gray"),children:["info"===ec&&(0,r.jsx)("span",{className:"lm-spinner flex-shrink-0",style:{width:12,height:12,borderWidth:1.5}}),"success"===ec&&(0,r.jsx)("span",{className:"lm-dot lm-dot-green flex-shrink-0"}),"error"===ec&&(0,r.jsx)("span",{className:"lm-dot lm-dot-red flex-shrink-0"}),(0,r.jsx)("span",{children:ei})]})]})}},739:(e,t,a)=>{Promise.resolve().then(a.bind(a,330)),Promise.resolve().then(a.bind(a,5110)),Promise.resolve().then(a.bind(a,4383))},4383:(e,t,a)=>{"use strict";a.d(t,{ExchangeBootstrap:()=>y});var r=a(5155),l=a(2115),n=a(598),s=a(6594),i=a(8070),o=a(6630),c=a(9719),d=a(8839),m=a(2933),u=a(3376),x=a(8604);let h=2n**128n-1n;function g(e,t,a){return Math.pow(1.0001,e)*Math.pow(10,t-a)}function p(e){return 0!==e&&Number.isFinite(e)?e>=1e9?"".concat((e/1e9).toFixed(2),"B"):e>=1e6?"".concat((e/1e6).toFixed(2),"M"):e>=1e3?"".concat((e/1e3).toFixed(2),"K"):e>=1?e.toFixed(4):e>=1e-4?e.toFixed(6):e>=1e-7?e.toFixed(10):e.toExponential(2):"—"}function f(e){let t=Number(e);return isNaN(t)||0===t?"0":t>=1e6?"".concat((t/1e6).toFixed(2),"M"):t>=1e3?"".concat((t/1e3).toFixed(2),"K"):t>=1?t.toFixed(4):t>=1e-4?t.toFixed(6):t.toExponential(2)}function b(){let{address:e,walletClient:t}=(0,c.v)(),[a,s]=(0,l.useState)([]),[i,x]=(0,l.useState)(""),[b,y]=(0,l.useState)(!1),[v,N]=(0,l.useState)({}),[w,j]=(0,l.useState)({}),[k,C]=(0,l.useState)(null),E=m.$.positionManager;async function S(){if(!e||!E)return void s([]);y(!0),x("Loading positions...");try{let a=await d.R.readContract({address:E,abi:u.g4,functionName:"balanceOf",args:[e]}),r=a>50n?50:Number(a),l=[],n={};async function t(e){let t=e.toLowerCase();if(n[t])return n[t];let a=e.slice(0,6),r=18;try{a=await d.R.readContract({address:e,abi:u.Qi,functionName:"symbol"})}catch(e){}try{r=Number(await d.R.readContract({address:e,abi:u.Qi,functionName:"decimals"}))}catch(e){}return n[t]={sym:a,dec:r},n[t]}let i={};for(let a=0;a<r;a++){let r=await d.R.readContract({address:E,abi:u.g4,functionName:"tokenOfOwnerByIndex",args:[e,BigInt(a)]}),n=await d.R.readContract({address:E,abi:u.g4,functionName:"positions",args:[r]}),s=n.token0,o=n.token1,c=await t(s),x=await t(o),h=Number(n.fee),p=g(Number(n.tickLower),c.dec,x.dec),f=g(Number(n.tickUpper),c.dec,x.dec),b=0,y="".concat(s.toLowerCase(),"-").concat(o.toLowerCase(),"-").concat(h);if(void 0!==i[y])b=i[y];else if(m.$.uniFactory){try{let e=await d.R.readContract({address:m.$.uniFactory,abi:u.HB,functionName:"getPool",args:[s,o,h]});if(e&&"0x0000000000000000000000000000000000000000"!==e){let t=await d.R.readContract({address:e,abi:u.ld,functionName:"slot0"});b=g(t[1],c.dec,x.dec)}}catch(e){}i[y]=b}let v=b>=p&&b<=f;l.push({tokenId:r,token0:s,token1:o,fee:h,tickLower:Number(n.tickLower),tickUpper:Number(n.tickUpper),liquidity:n.liquidity,sym0:c.sym,sym1:x.sym,dec0:c.dec,dec1:x.dec,tokensOwed0:n.tokensOwed0,tokensOwed1:n.tokensOwed1,priceLower:p,priceUpper:f,currentPrice:b,inRange:v})}s(l),x("")}catch(e){x(String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e))}finally{y(!1)}}async function R(a){if(!e||!t||!E)return;y(!0);let r=a.tokenId.toString();N(e=>({...e,[r]:"Collecting fees..."})),j(e=>({...e,[r]:"info"}));try{let l=await t.writeContract({address:E,abi:u.g4,functionName:"collect",args:[{tokenId:a.tokenId,recipient:e,amount0Max:h,amount1Max:h}],chain:t.chain,account:e});N(e=>({...e,[r]:"Confirming..."}));let n=await d.R.waitForTransactionReceipt({hash:l});"success"===n.status?(N(e=>({...e,[r]:"Fees collected!"})),j(e=>({...e,[r]:"success"}))):(N(e=>({...e,[r]:"Tx failed"})),j(e=>({...e,[r]:"error"}))),await S()}catch(e){N(t=>({...t,[r]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),j(e=>({...e,[r]:"error"}))}finally{y(!1)}}async function M(a){if(!e||!t||!E||a.liquidity<=0n)return;y(!0);let r=a.tokenId.toString();N(e=>({...e,[r]:"Removing liquidity..."})),j(e=>({...e,[r]:"info"}));try{let l=BigInt(Math.floor(Date.now()/1e3)+600),n=await t.writeContract({address:E,abi:u.g4,functionName:"decreaseLiquidity",args:[{tokenId:a.tokenId,liquidity:a.liquidity,amount0Min:0n,amount1Min:0n,deadline:l}],chain:t.chain,account:e});N(e=>({...e,[r]:"Removing... collecting tokens"})),await d.R.waitForTransactionReceipt({hash:n});let s=await t.writeContract({address:E,abi:u.g4,functionName:"collect",args:[{tokenId:a.tokenId,recipient:e,amount0Max:h,amount1Max:h}],chain:t.chain,account:e});await d.R.waitForTransactionReceipt({hash:s}),N(e=>({...e,[r]:"Liquidity removed!"})),j(e=>({...e,[r]:"success"})),await S()}catch(e){N(t=>({...t,[r]:String((null==e?void 0:e.shortMessage)||(null==e?void 0:e.message)||e)})),j(e=>({...e,[r]:"error"}))}finally{y(!1)}}if((0,l.useEffect)(()=>{S().catch(()=>{})},[e]),!e)return(0,r.jsxs)("div",{className:"text-lm-gray text-sm p-6 text-center",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-lg mb-1",children:"No Wallet Connected"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs",children:"Connect your wallet to view and manage LP positions."})]});let L=a.filter(e=>e.liquidity>0n),F=a.filter(e=>e.liquidity<=0n);return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-3",children:a.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:[L.length," Active"]}),F.length>0&&(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-upper tracking-wider opacity-50",children:[F.length," Closed"]})]})}),(0,r.jsx)(o.$,{onClick:S,disabled:b,className:"text-lm-orange text-xs border border-lm-terminal-gray hover:border-lm-orange px-3 py-1 transition-colors",children:b?"Loading...":"Refresh"})]}),0===a.length?(0,r.jsxs)("div",{className:"text-center py-8 space-y-2",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-lg",children:b?"Loading...":"No Positions"}),(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-xs opacity-60",children:i||"Create an LP position in the Pools tab to start earning fees."})]}):(0,r.jsx)("div",{className:"space-y-2",children:a.map(e=>{let t=e.tokenId.toString(),a=e.liquidity>0n,l=e.tokensOwed0>0n||e.tokensOwed1>0n,s=v[t],i=w[t]||"info",c=k===t,d="".concat((e.fee/1e4).toFixed(e.fee<1e3?2:+(e.fee<1e4)),"%");return(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border transition-all lm-card-hover ".concat(a&&e.inRange?"border-lm-green/30 lm-in-range":a?"border-lm-orange/30 lm-out-of-range":"border-lm-terminal-gray"),children:[(0,r.jsxs)("button",{type:"button",onClick:()=>C(c?null:t),className:"w-full p-3 flex items-center justify-between text-left hover:bg-lm-black/20",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,r.jsx)("span",{className:"lm-dot ".concat(a?e.inRange?"lm-dot-green lm-dot-pulse":"lm-dot-red":"lm-dot-gray")}),(0,r.jsxs)("span",{className:"text-white font-bold text-sm",children:[e.sym0,"/",e.sym1]}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray text-[10px] bg-lm-black px-1.5 py-0.5 border border-lm-terminal-gray lm-mono",children:d}),(0,r.jsxs)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono opacity-50",children:["#",e.tokenId.toString()]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[a?(0,r.jsx)("span",{className:"lm-badge font-bold ".concat(e.inRange?"lm-badge-filled-green":"lm-badge-filled-red"),children:e.inRange?"IN RANGE":"OUT OF RANGE"}):(0,r.jsx)("span",{className:"lm-badge lm-badge-gray",children:"CLOSED"}),l&&(0,r.jsx)("span",{className:"lm-badge lm-badge-filled-green",children:"FEES"}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-3 h-3 text-lm-terminal-lightgray transition-transform ".concat(c?"rotate-180":""),children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.22 6.22a.75.75 0 011.06 0L8 8.94l2.72-2.72a.75.75 0 111.06 1.06l-3.25 3.25a.75.75 0 01-1.06 0L4.22 7.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})]})]}),(0,r.jsxs)("div",{className:"px-3 pb-2 flex items-center gap-4 text-[10px] flex-wrap",children:[e.currentPrice>0&&(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Price:"}),(0,r.jsx)("span",{className:"text-white lm-mono font-bold",children:p(e.currentPrice)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Range:"}),(0,r.jsx)("span",{className:"text-white lm-mono",children:p(e.priceLower)}),(0,r.jsx)("span",{className:"text-lm-terminal-gray",children:"—"}),(0,r.jsx)("span",{className:"text-white lm-mono",children:p(e.priceUpper)})]})]}),a&&e.currentPrice>0&&(0,r.jsx)("div",{className:"px-3 pb-2",children:(0,r.jsxs)("div",{className:"relative h-1.5 bg-lm-black rounded-full overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-lm-orange/20 rounded-full",style:{left:"10%",right:"10%"}}),(()=>{let t=Math.min(e.priceLower,.5*e.currentPrice),a=Math.max(e.priceUpper,2*e.currentPrice)-t;if(a<=0)return null;let l=(e.priceLower-t)/a*100,n=(e.priceUpper-t)/a*100,s=(e.currentPrice-t)/a*100;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"absolute top-0 h-full ".concat(e.inRange?"bg-lm-green/40":"bg-lm-orange/40"),style:{left:"".concat(l,"%"),width:"".concat(n-l,"%")}}),(0,r.jsx)("div",{className:"absolute top-0 w-1 h-full bg-white rounded-full",style:{left:"".concat(s,"%"),transform:"translateX(-50%)"}})]})})()]})}),c&&(0,r.jsxs)("div",{className:"px-3 pb-3 space-y-2 border-t border-lm-terminal-gray",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 pt-2 text-[10px]",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:["Price Range (",e.sym1,"/",e.sym0,")"]}),(0,r.jsxs)("div",{className:"text-white lm-mono text-xs mt-0.5",children:[p(e.priceLower)," — ",p(e.priceUpper)]})]}),e.currentPrice>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Current Price"}),(0,r.jsxs)("div",{className:"text-white lm-mono text-xs mt-0.5",children:[p(e.currentPrice)," ",e.sym1,"/",e.sym0]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray lm-upper tracking-wider",children:"Fee Tier"}),(0,r.jsx)("div",{className:"text-white text-xs mt-0.5",children:d})]})]}),l&&(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-green/20 p-2 text-xs space-y-0.5",children:[(0,r.jsx)("div",{className:"text-lm-green text-[10px] font-bold lm-upper tracking-wider",children:"Uncollected Fees"}),(0,r.jsxs)("div",{className:"flex gap-4 text-white lm-mono",children:[e.tokensOwed0>0n&&(0,r.jsxs)("span",{children:[f((0,n.J)(e.tokensOwed0,e.dec0))," ",e.sym0]}),e.tokensOwed1>0n&&(0,r.jsxs)("span",{children:[f((0,n.J)(e.tokensOwed1,e.dec1))," ",e.sym1]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap pt-1",children:[(0,r.jsx)(o.$,{size:"sm",className:"bg-lm-green/10 text-lm-green border-lm-green/30 hover:bg-lm-green/20 hover:border-lm-green",onClick:()=>R(e),disabled:b,children:"Collect Fees"}),a&&(0,r.jsx)(o.$,{size:"sm",variant:"danger",onClick:()=>M(e),disabled:b,children:"Remove All Liquidity"}),s&&(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:["info"===i&&(0,r.jsx)("span",{className:"lm-spinner",style:{width:10,height:10,borderWidth:1}}),"success"===i&&(0,r.jsx)("span",{className:"lm-dot lm-dot-green"}),"error"===i&&(0,r.jsx)("span",{className:"lm-dot lm-dot-red"}),(0,r.jsx)("span",{className:"text-[10px] ".concat("success"===i?"text-lm-green":"error"===i?"text-lm-red":"text-lm-gray"),children:s})]})]})]})]},t)})}),i&&a.length>0&&(0,r.jsxs)("div",{className:"text-xs p-2.5 border border-lm-red/20 bg-lm-black flex items-center gap-2 text-lm-red",children:[(0,r.jsx)("span",{className:"lm-dot lm-dot-red flex-shrink-0"}),(0,r.jsx)("span",{children:i})]})]})}function y(e){let{SwapPanel:t,PoolsPanel:a}=e,n=(0,l.useMemo)(()=>[{id:"swap",label:"Swap",hint:"Quote + swap any token pair"},{id:"pools",label:"Pools",hint:"Create pools + add liquidity"},{id:"positions",label:"Positions",hint:"Manage your LP positions"}],[]),[o,c]=(0,l.useState)("swap"),d=(0,l.useCallback)(e=>{["swap","flip_tokens","max_balance","set_fee","set_slippage"].includes(e.type)?c("swap"):["add_liquidity","create_pool"].includes(e.type)?c("pools"):["collect_fees","remove_liquidity","refresh_positions"].includes(e.type)?c("positions"):"switch_tab"===e.type&&["swap","pools","positions"].includes(e.tab)&&c(e.tab)},[]);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(x.jc,{context:"exchange",onIntent:d,placeholder:"swap 10 ETH for TSLA \xb7 add liquidity \xb7 create pool \xb7 collect fees \xb7 help"}),(0,r.jsxs)(s.Z,{title:"Exchange",hint:"Swap any token pair. Native ETH supported. Create and manage LP positions.",right:(0,r.jsx)(i.Z,{tabs:n,active:o,onChange:c}),children:["swap"===o?(0,r.jsx)(t,{}):null,"pools"===o?(0,r.jsx)(a,{}):null,"positions"===o?(0,r.jsx)(b,{}):null]})]})}},5110:(e,t,a)=>{"use strict";a.d(t,{SwapPanel:()=>w});var r=a(5155),l=a(2115),n=a(598),s=a(5028),i=a(931),o=a(6630),c=a(8590),d=a(7280),m=a(8839),u=a(2933),x=a(3376),h=a(9719),g=a(8604);let p=[{label:"0.05%",fee:500,hint:"Stables"},{label:"0.30%",fee:3e3,hint:"Standard"},{label:"1.00%",fee:1e4,hint:"Volatile"}],f=[{label:"0.5%",bps:50},{label:"1%",bps:100},{label:"3%",bps:300}],b={address:"0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",symbol:"ETH",decimals:18,logoURI:""};function y(e){return e.toLowerCase()===b.address.toLowerCase()}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,a=Number(e);return isNaN(a)||0===a?"0":a>=1e6?"".concat((a/1e6).toFixed(2),"M"):a>=1e3?"".concat((a/1e3).toFixed(2),"K"):a>=1?a.toFixed(Math.min(4,t)):a>=1e-4?a.toFixed(t):a.toExponential(2)}function N(e){var t;let{tokens:a,value:n,onChange:s,customAddr:i,onCustomAddr:o,customMeta:d,label:m,balance:u,symbol:x,onMax:h,amount:g,onAmountChange:p,amountReadonly:f,quoteDisplay:y,isNativeEth:N}=e,w="__custom__"===n,[j,k]=(0,l.useState)(!1),C=(0,l.useRef)(null);(0,l.useEffect)(()=>{function e(e){C.current&&!C.current.contains(e.target)&&k(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let E=[{addr:b.address,symbol:"ETH",hint:"Native",isEth:!0},...a.map(e=>({addr:e.address,symbol:e.symbol,hint:e.address.slice(0,6)+"...",isEth:!1})),{addr:"__custom__",symbol:"Custom",hint:"Paste address",isEth:!1}],S=w?(null==d?void 0:d.symbol)||"Custom":x||(null==(t=E.find(e=>e.addr===n))?void 0:t.symbol)||"Select";return(0,r.jsxs)("div",{className:"bg-lm-terminal-darkgray border border-lm-terminal-gray p-3 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:m}),void 0!==u&&(0,r.jsxs)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-mono flex items-center gap-1",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-2.5 h-2.5 opacity-60",children:(0,r.jsx)("path",{d:"M8 1a7 7 0 100 14A7 7 0 008 1zm-.5 3h1v1h-1V4zm-1 2h3v1h-1v3h1v1h-3V10h1V7h-1V6z"})}),(0,r.jsx)("span",{className:"text-white",children:v(u)})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-shrink-0",ref:C,children:[(0,r.jsxs)("button",{type:"button",onClick:()=>k(!j),className:"flex items-center gap-1.5 h-10 px-3 bg-lm-black border border-lm-terminal-gray hover:border-lm-orange transition-colors min-w-[100px]",children:[(0,r.jsx)("span",{className:"text-white font-bold text-sm",children:S}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-3 h-3 text-lm-terminal-lightgray",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.22 6.22a.75.75 0 011.06 0L8 8.94l2.72-2.72a.75.75 0 111.06 1.06l-3.25 3.25a.75.75 0 01-1.06 0L4.22 7.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})]}),j&&(0,r.jsx)("div",{className:"absolute top-full left-0 mt-1 z-50 bg-lm-black border border-lm-orange w-56 max-h-60 overflow-y-auto shadow-lg",children:E.map(e=>{let t=n===e.addr;return(0,r.jsxs)("button",{type:"button",onClick:()=>{s(e.addr),k(!1)},className:"w-full text-left px-3 py-2 flex items-center justify-between transition-colors ".concat(t?"bg-lm-orange/10 text-lm-orange":"text-white hover:bg-lm-terminal-darkgray"),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-bold text-sm",children:e.symbol}),e.isEth&&(0,r.jsx)("span",{className:"text-lm-terminal-lightgray text-[10px] ml-1.5",children:"Native"})]}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray text-[10px] lm-mono",children:e.hint})]},e.addr)})})]}),(0,r.jsx)("div",{className:"flex-1 relative",children:f&&void 0!==y?(0,r.jsx)("div",{className:"h-10 bg-lm-black border border-lm-terminal-gray px-3 flex items-center justify-end",children:(0,r.jsx)("span",{className:"lm-mono text-sm ".concat(y&&"No liquidity"!==y?"text-white font-bold":"text-lm-terminal-lightgray"),children:y||"—"})}):(0,r.jsx)(c.p,{value:g||"",onValueChange:p,placeholder:"0.0",className:"h-10 text-sm font-bold"})}),h&&u&&Number(u)>0&&(0,r.jsx)("button",{type:"button",onClick:h,className:"h-10 px-2 text-[10px] font-bold text-lm-orange border border-lm-orange/30 hover:border-lm-orange hover:bg-lm-orange/5 transition-colors lm-upper",children:"Max"})]}),w&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("input",{className:"lm-input text-left text-xs h-8",placeholder:"Paste token address (0x...)",value:i,onChange:e=>o(e.target.value)}),d?(0,r.jsxs)("div",{className:"text-lm-green text-[10px] flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-lm-green"}),"Detected: ",(0,r.jsx)("span",{className:"text-white font-bold",children:d.symbol})," (",d.decimals," decimals)"]}):42===i.length?(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] animate-pulse",children:"Detecting token..."}):null]}),N&&(0,r.jsxs)("div",{className:"text-[9px] text-lm-terminal-lightgray flex items-center gap-1",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-2.5 h-2.5",children:(0,r.jsx)("path",{d:"M8 1a7 7 0 100 14A7 7 0 008 1zm-.5 3h1v1h-1V4zm-1 2h3v1h-1v3h1v1h-3V10h1V7h-1V6z"})}),"Auto-wraps to WETH for the swap"]})]})}function w(){var e,t,a;let{address:c,walletClient:w,requireCorrectChain:j}=(0,h.v)(),[k,C]=(0,l.useState)([]),[E,S]=(0,l.useState)(""),[R,M]=(0,l.useState)(""),[L,F]=(0,l.useState)(""),[P,I]=(0,l.useState)(""),[T,A]=(0,l.useState)(null),[_,q]=(0,l.useState)(null),[$,B]=(0,l.useState)(3e3),[z,O]=(0,l.useState)(""),[U,V]=(0,l.useState)(0n),[W,H]=(0,l.useState)(""),[X,J]=(0,l.useState)(!1),[D,Q]=(0,l.useState)(100),[K,Y]=(0,l.useState)(!1),[G,Z]=(0,l.useState)(""),[ee,et]=(0,l.useState)("info"),[ea,er]=(0,l.useState)(!1),[el,en]=(0,l.useState)(""),[es,ei]=(0,l.useState)(""),[eo,ec]=(0,l.useState)(""),ed=(0,l.useRef)(null),em=(0,l.useMemo)(()=>{if(y(E))return{addr:u.$.weth,meta:{...b,address:u.$.weth},isNativeEth:!0};if("__custom__"===E&&T&&/^0x[0-9a-fA-F]{40}$/.test(L))return{addr:L,meta:T,isNativeEth:!1};let e=k.find(e=>e.address===E);return e?{addr:e.address,meta:e,isNativeEth:!1}:{addr:"",meta:null,isNativeEth:!1}},[E,L,T,k]),eu=(0,l.useMemo)(()=>{if(y(R))return{addr:u.$.weth,meta:{...b,address:u.$.weth},isNativeEth:!0};if("__custom__"===R&&_&&/^0x[0-9a-fA-F]{40}$/.test(P))return{addr:P,meta:_,isNativeEth:!1};let e=k.find(e=>e.address===R);return e?{addr:e.address,meta:e,isNativeEth:!1}:{addr:"",meta:null,isNativeEth:!1}},[R,P,_,k]);(0,l.useEffect)(()=>{if("__custom__"!==E||!/^0x[0-9a-fA-F]{40}$/.test(L))return void A(null);(async()=>{try{let[e,t]=await Promise.all([m.R.readContract({address:L,abi:x.Qi,functionName:"symbol"}),m.R.readContract({address:L,abi:x.Qi,functionName:"decimals"})]);A({address:L,symbol:e,decimals:Number(t),logoURI:""})}catch(e){A(null)}})()},[E,L]),(0,l.useEffect)(()=>{if("__custom__"!==R||!/^0x[0-9a-fA-F]{40}$/.test(P))return void q(null);(async()=>{try{let[e,t]=await Promise.all([m.R.readContract({address:P,abi:x.Qi,functionName:"symbol"}),m.R.readContract({address:P,abi:x.Qi,functionName:"decimals"})]);q({address:P,symbol:e,decimals:Number(t),logoURI:""})}catch(e){q(null)}})()},[R,P]),(0,l.useEffect)(()=>{(0,d.V)().then(e=>{C(e),E||S(b.address),!R&&e[0]&&M(e[0].address)}).catch(e=>{Z(String((null==e?void 0:e.message)||e)),et("error")})},[]);let ex=(0,l.useRef)(k);ex.current=k;let eh=(0,l.useRef)(eN);eh.current=eN;let eg=(0,l.useRef)(el);eg.current=el,(0,g.SL)((0,l.useCallback)(e=>{if("swap"===e.type){let t=ex.current,a=e=>{if(!e)return;let a=e.toUpperCase();if("ETH"===a||"WETH"===a)return b.address;let r=t.find(e=>e.symbol.toUpperCase()===a);return null==r?void 0:r.address},r=a(e.tokenIn),l=a(e.tokenOut);r&&S(r),l&&M(l),e.amount&&O(e.amount),e.fee&&B(Number(e.fee)),e.slippage&&Q(Number(e.slippage))}else"flip_tokens"===e.type?eh.current():"max_balance"===e.type?eg.current&&O(eg.current):"set_fee"===e.type?B(Number(e.fee)):"set_slippage"===e.type&&Q(Number(e.bps))},[])),(0,l.useEffect)(()=>{if(!c){en(""),ei("");return}(async()=>{if(em.isNativeEth)try{en((0,n.J)(await m.R.getBalance({address:c}),18))}catch(e){en("?")}else if(em.addr&&em.meta)try{let e=await m.R.readContract({address:em.addr,abi:x.bx,functionName:"balanceOf",args:[c]});en((0,n.J)(e,em.meta.decimals))}catch(e){en("?")}else en("");if(eu.isNativeEth)try{ei((0,n.J)(await m.R.getBalance({address:c}),18))}catch(e){ei("?")}else if(eu.addr&&eu.meta)try{let e=await m.R.readContract({address:eu.addr,abi:x.bx,functionName:"balanceOf",args:[c]});ei((0,n.J)(e,eu.meta.decimals))}catch(e){ei("?")}else ei("")})()},[c,em.addr,em.isNativeEth,em.meta,eu.addr,eu.isNativeEth,eu.meta]);let ep=(0,l.useCallback)(async()=>{if(!u.$.quoterV2||!em.addr||!eu.addr||!em.meta||!eu.meta)return;let e=(z||"").trim();if(!e||"0"===e||"0."===e||"."===e){V(0n),H("");return}J(!0);try{let t=(0,s.X)(e,em.meta.decimals);if(0n===t){V(0n),H("");return}let a=await m.R.readContract({address:u.$.quoterV2,abi:x.D8,functionName:"quoteExactInputSingle",args:[{tokenIn:em.addr,tokenOut:eu.addr,amountIn:t,fee:$,sqrtPriceLimitX96:0n}]});V(a[0]),H((0,n.J)(a[0],eu.meta.decimals))}catch(e){V(0n),H("No liquidity")}finally{J(!1)}},[z,$,em.addr,em.meta,eu.addr,eu.meta]);(0,l.useEffect)(()=>(ed.current&&clearTimeout(ed.current),ed.current=setTimeout(()=>{ep().catch(()=>{})},400),()=>{ed.current&&clearTimeout(ed.current)}),[ep]);let ef=(0,l.useMemo)(()=>{if(!z||!W||"No liquidity"===W||!em.meta||!eu.meta)return null;let e=Number(z),t=Number(W);return e<=0||t<=0?null:{forward:t/e,inverse:e/t,inSymbol:em.isNativeEth?"ETH":em.meta.symbol,outSymbol:eu.isNativeEth?"ETH":eu.meta.symbol}},[z,W,em.meta,em.isNativeEth,eu.meta,eu.isNativeEth]),eb=(0,l.useMemo)(()=>U<=0n?0n:U*(10000n-BigInt(D))/10000n,[U,D]);async function ey(e,t,a,r,l){if(await m.R.readContract({address:a,abi:x.bx,functionName:"allowance",args:[e,t]})>=r)return;if(Z("Approving ".concat(l,"...")),et("info"),!w)throw Error("No wallet client");let n=await w.writeContract({address:a,abi:x.bx,functionName:"approve",args:[t,r],chain:m.A,account:e});await m.R.waitForTransactionReceipt({hash:n})}async function ev(){if(!c){Z("Connect wallet to swap."),et("error");return}if(!u.$.swapRouter||!em.addr||!eu.addr||!em.meta||!eu.meta){Z("Select valid tokens."),et("error");return}let e=em.isNativeEth?"ETH":em.meta.symbol,t=eu.isNativeEth?"ETH":eu.meta.symbol;er(!0),ec("");try{let a,r=(z||"").trim(),l=(0,s.X)(r||"0",em.meta.decimals);if(0n===l)throw Error("Amount must be greater than 0");if(el){let t=(0,s.X)(el,em.meta.decimals);if(l>t){Z("Insufficient ".concat(e," balance. You have ").concat(v(el)," but need ").concat(r,".")),et("error"),er(!1);return}}if(Z("Preparing swap: ".concat(r," ").concat(e," → ").concat(t,"...")),et("info"),await j(),!w)throw Error("No wallet client");let n=BigInt(Math.floor(Date.now()/1e3)+600),o=BigInt(Math.max(0,Math.min(3e3,D))),d=0n;try{d=(await m.R.readContract({address:u.$.quoterV2,abi:x.D8,functionName:"quoteExactInputSingle",args:[{tokenIn:em.addr,tokenOut:eu.addr,amountIn:l,fee:$,sqrtPriceLimitX96:0n}]}))[0]*(10000n-o)/10000n}catch(e){Z("Could not fetch quote. Pool may not have liquidity for this pair."),et("error"),er(!1);return}let h=em.isNativeEth;if(eu.isNativeEth){h||await ey(c,u.$.swapRouter,em.addr,l,e),Z("Swapping ".concat(r," ").concat(e," → ~").concat(W?v(W):"?"," ").concat(t,"...")),et("info");let s=(0,i.p)({abi:x.zO,functionName:"exactInputSingle",args:[{tokenIn:em.addr,tokenOut:eu.addr,fee:$,recipient:u.$.swapRouter,deadline:n,amountIn:l,amountOutMinimum:d,sqrtPriceLimitX96:0n}]}),o=(0,i.p)({abi:x.zO,functionName:"unwrapWETH9",args:[d,c]});a=await w.writeContract({address:u.$.swapRouter,abi:x.zO,functionName:"multicall",args:[[s,o]],value:h?l:0n,chain:m.A,account:c})}else h||await ey(c,u.$.swapRouter,em.addr,l,e),Z("Swapping ".concat(r," ").concat(e," → ~").concat(W?v(W):"?"," ").concat(t,"...")),et("info"),a=await w.writeContract({address:u.$.swapRouter,abi:x.zO,functionName:"exactInputSingle",args:[{tokenIn:em.addr,tokenOut:eu.addr,fee:$,recipient:c,deadline:n,amountIn:l,amountOutMinimum:d,sqrtPriceLimitX96:0n}],value:h?l:0n,chain:m.A,account:c});ec(a),Z("Confirming on-chain..."),et("info");let g=await m.R.waitForTransactionReceipt({hash:a});"success"===g.status?(Z("Swap confirmed! Received ~".concat(W?v(W):"?"," ").concat(t)),et("success"),O("")):(Z("Transaction reverted. The price may have moved beyond your slippage tolerance."),et("error")),ep().catch(()=>{})}catch(t){let e=String((null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||t);e.includes("user rejected")||e.includes("User denied")?Z("Transaction cancelled by user."):Z("Swap failed: ".concat(e)),et("error")}finally{er(!1)}}function eN(){S(R),F(P),A(_),M(E),I(L),q(T),O(""),V(0n),H("")}let ew=em.isNativeEth?"ETH":(null==(e=em.meta)?void 0:e.symbol)||"",ej=eu.isNativeEth?"ETH":(null==(t=eu.meta)?void 0:t.symbol)||"",ek=X?"Quoting...":W&&"No liquidity"!==W?"".concat(v(W)," ").concat(ej):W,eC=em.addr&&eu.addr&&z&&Number(z)>0&&W&&"No liquidity"!==W;(0,l.useMemo)(()=>(!ef,null),[ef,W]);let eE=!!el&&!!z&&Number(z)>Number(el),eS=ea?"Processing...":c?em.addr&&eu.addr?!z||0>=Number(z)?"Enter Amount":"No liquidity"===W?"No Liquidity for This Pair":eE?"Insufficient ".concat(ew," Balance"):"Swap ".concat(ew," for ").concat(ej):"Select Tokens":"Connect Wallet",eR=!eC||ea||eE;return(0,r.jsxs)("div",{className:"lm-swap-card p-1",children:[(0,r.jsx)(N,{tokens:k,value:E,onChange:S,customAddr:L,onCustomAddr:F,customMeta:T,label:"You Pay",balance:el||void 0,symbol:ew,onMax:()=>{el&&O(el)},amount:z,onAmountChange:O,isNativeEth:em.isNativeEth}),(0,r.jsx)("div",{className:"flex justify-center -my-2 relative z-10",children:(0,r.jsx)("button",{type:"button",onClick:eN,disabled:ea,className:"w-10 h-10 flex items-center justify-center bg-lm-terminal-darkgray border-2 border-lm-terminal-gray hover:border-lm-orange hover:bg-lm-black text-lm-terminal-lightgray hover:text-lm-orange group disabled:opacity-40 disabled:pointer-events-none",title:"Flip tokens",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4 group-hover:rotate-180 transition-transform duration-300",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M2.24 6.8a.75.75 0 001.06-.04l1.95-2.1v8.59a.75.75 0 001.5 0V4.66l1.95 2.1a.75.75 0 101.1-1.02l-3.25-3.5a.75.75 0 00-1.1 0L2.2 5.74a.75.75 0 00.04 1.06zm8 6.4a.75.75 0 00-.04 1.06l3.25 3.5a.75.75 0 001.1 0l3.25-3.5a.75.75 0 10-1.1-1.02l-1.95 2.1V6.75a.75.75 0 00-1.5 0v8.59l-1.95-2.1a.75.75 0 00-1.06-.04z",clipRule:"evenodd"})})})}),(0,r.jsx)(N,{tokens:k,value:R,onChange:M,customAddr:P,onCustomAddr:I,customMeta:_,label:"You Receive",balance:es||void 0,symbol:ej,amountReadonly:!0,quoteDisplay:ek,isNativeEth:eu.isNativeEth}),(ef||eC)&&(0,r.jsxs)("div",{className:"mx-1 mt-2",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>Y(!K),className:"flex items-center justify-between w-full py-2 px-2 text-[10px] hover:bg-lm-terminal-darkgray/50 transition-colors",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 text-lm-terminal-lightgray",children:ef&&(0,r.jsxs)("span",{className:"text-white lm-mono",children:["1 ",ef.inSymbol," = ",0===(a=ef.forward)||isNaN(a)?"—":a>=1e6?"".concat((a/1e6).toFixed(2),"M"):a>=1e3?"".concat((a/1e3).toFixed(2),"K"):a>=1?a.toFixed(4):a>=1e-4?a.toFixed(6):a.toExponential(2)," ",ef.outSymbol]})}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5 text-lm-terminal-lightgray",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-3 h-3",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6.955 1.45A.5.5 0 017.452 1h1.096a.5.5 0 01.497.45l.17 1.699c.484.12.94.312 1.356.562l1.321-.916a.5.5 0 01.67.033l.774.775a.5.5 0 01.033.67l-.916 1.32c.25.417.443.873.563 1.357l1.699.17a.5.5 0 01.45.497v1.096a.5.5 0 01-.45.497l-1.699.17c-.12.484-.312.94-.562 1.356l.916 1.321a.5.5 0 01-.034.67l-.774.774a.5.5 0 01-.67.033l-1.32-.916c-.417.25-.873.443-1.357.563l-.17 1.699a.5.5 0 01-.497.45H7.452a.5.5 0 01-.497-.45l-.17-1.699a4.973 4.973 0 01-1.356-.562l-1.321.916a.5.5 0 01-.67-.034l-.774-.774a.5.5 0 01-.034-.67l.916-1.32a4.973 4.973 0 01-.562-1.357l-1.699-.17A.5.5 0 011 8.548V7.452a.5.5 0 01.45-.497l1.699-.17c.12-.484.312-.94.562-1.356l-.916-1.321a.5.5 0 01.034-.67l.774-.774a.5.5 0 01.67-.033l1.32.916c.417-.25.873-.443 1.357-.563l.17-1.699zM8 10a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",className:"w-3 h-3 transition-transform ".concat(K?"rotate-180":""),children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.22 6.22a.75.75 0 011.06 0L8 8.94l2.72-2.72a.75.75 0 111.06 1.06l-3.25 3.25a.75.75 0 01-1.06 0L4.22 7.28a.75.75 0 010-1.06z",clipRule:"evenodd"})})]})]}),K&&(0,r.jsxs)("div",{className:"bg-lm-black border border-lm-terminal-gray/50 p-3 space-y-3 mt-1 lm-fade-in",children:[eC&&eu.meta&&(0,r.jsxs)("div",{className:"space-y-1.5 text-[10px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Minimum received"}),(0,r.jsxs)("span",{className:"text-white lm-mono font-bold",children:[v((0,n.J)(eb,eu.meta.decimals))," ",ej]})]}),(em.isNativeEth||eu.isNativeEth)&&(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"Route"}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-white lm-mono",children:[(0,r.jsx)("span",{children:ew}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"→"}),em.isNativeEth&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"WETH"}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"→"})]}),eu.isNativeEth&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"WETH"}),(0,r.jsx)("span",{className:"text-lm-terminal-lightgray",children:"→"})]}),(0,r.jsx)("span",{children:ej})]})]}),(0,r.jsx)("div",{className:"h-px bg-lm-terminal-gray/30 my-1"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Fee Tier"}),(0,r.jsx)("div",{className:"flex gap-1",children:p.map(e=>(0,r.jsxs)("button",{type:"button",onClick:()=>B(e.fee),className:"flex-1 py-2 border text-center ".concat($===e.fee?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:[(0,r.jsx)("div",{className:"text-xs font-bold",children:e.label}),(0,r.jsx)("div",{className:"text-[9px] opacity-60",children:e.hint})]},e.fee))})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("div",{className:"text-lm-terminal-lightgray text-[10px] lm-upper font-bold tracking-wider",children:"Max Slippage"}),(0,r.jsx)("div",{className:"flex gap-1",children:f.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>Q(e.bps),className:"flex-1 text-xs py-2 border ".concat(D===e.bps?"border-lm-orange text-lm-orange bg-lm-orange/5":"border-lm-terminal-gray text-lm-gray hover:border-lm-gray"),children:e.label},e.bps))}),(0,r.jsx)("div",{className:"text-[9px] text-lm-terminal-lightgray",children:"Swap reverts if price moves beyond this tolerance."})]})]})]}),eE&&(0,r.jsxs)("div",{className:"mx-1 mt-1.5 lm-callout lm-callout-red text-[10px] flex items-center gap-2",children:[(0,r.jsx)("span",{className:"lm-dot lm-dot-red"}),(0,r.jsxs)("span",{children:["Insufficient balance. You have ",(0,r.jsx)("span",{className:"text-white font-bold",children:v(el)})," ",ew," but need ",(0,r.jsx)("span",{className:"text-white font-bold",children:z}),"."]})]}),(0,r.jsx)("div",{className:"p-1 pt-2",children:(0,r.jsx)(o.$,{onClick:ev,loading:ea,disabled:eR,variant:eR?"default":"primary",size:"lg",className:"w-full ".concat(eR?"":"bg-lm-orange text-black"),children:eS})}),G&&(0,r.jsxs)("div",{className:"mx-1 mb-1 text-xs p-2.5 border bg-lm-black flex items-center justify-between gap-2 ".concat("success"===ee?"text-lm-green":"error"===ee?"text-lm-red":"text-lm-gray"," ").concat("success"===ee?"border-lm-green/20":"error"===ee?"border-lm-red/20":"border-lm-terminal-gray"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:["info"===ee&&(0,r.jsx)("span",{className:"lm-spinner flex-shrink-0",style:{width:12,height:12,borderWidth:1.5}}),"success"===ee&&(0,r.jsx)("span",{className:"lm-dot lm-dot-green flex-shrink-0"}),"error"===ee&&(0,r.jsx)("span",{className:"lm-dot lm-dot-red flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate",children:G})]}),eo&&(0,r.jsx)("a",{href:"".concat(u.$.blockExplorerUrl||"https://explorer.testnet.chain.robinhood.com","/tx/").concat(eo),target:"_blank",rel:"noreferrer",className:"text-lm-orange hover:underline text-[10px] flex-shrink-0",children:"View Tx →"})]})]})}},7280:(e,t,a)=>{"use strict";a.d(t,{V:()=>s});var r=a(8839),l=a(2933),n=a(3376);async function s(){if(!l.$.tokenRegistry)return[];let e=await r.R.readContract({address:l.$.tokenRegistry,abi:n.wn,functionName:"tokenCount"}),t=[];for(let a=0n;a<e;a++){let e=await r.R.readContract({address:l.$.tokenRegistry,abi:n.wn,functionName:"tokenAt",args:[a]}),s=await r.R.readContract({address:l.$.tokenRegistry,abi:n.wn,functionName:"getToken",args:[e]});(null==s?void 0:s.whitelisted)&&t.push({address:e,symbol:s.symbol,decimals:Number(s.decimals),logoURI:s.logoURI||void 0,metadataURI:s.metadataURI||void 0})}return t}}},e=>{e.O(0,[462,476,668,918,441,255,358],()=>e(e.s=739)),_N_E=e.O()}]);